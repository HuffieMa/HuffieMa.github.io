<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HALFA博客</title>
  
  <subtitle>无限进步！！！</subtitle>
  <link href="https://www.mahaofei.com/atom.xml" rel="self"/>
  
  <link href="https://www.mahaofei.com/"/>
  <updated>2022-06-24T10:54:18.000Z</updated>
  <id>https://www.mahaofei.com/</id>
  
  <author>
    <name>Huffie</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RobotStudio实现喷漆、打磨等功能（曲面路径生成与仿真）</title>
    <link href="https://www.mahaofei.com/post/3feb0033.html"/>
    <id>https://www.mahaofei.com/post/3feb0033.html</id>
    <published>2022-06-24T10:54:18.000Z</published>
    <updated>2022-06-24T10:54:18.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="任务介绍"><a href="#任务介绍" class="headerlink" title="任务介绍"></a>任务介绍</h1><p>在Robotstudio中导入一个CAD模型，如汽车外壳等复杂曲面模型。使用Robotstudio进行路径规划，实现机械臂的汽车外壳的喷漆功能。</p><h1 id="所用环境"><a href="#所用环境" class="headerlink" title="所用环境"></a>所用环境</h1><p>实现本功能，使用到了ABB公司发布的<code>ABB Machining PowerPac</code>功能包。该功能包可以实现的功能包括打磨产品（规则的方形体）、涂胶、火焰切割、卫浴打磨、复杂的大型曲面体打磨、磨边等。</p><p>下载链接如下：<a href="https://robotapps.blob.core.windows.net/apps/d2d4e3fc-1810-4c05-937d-8154d31fca13machiningpowerpac6.04.zip">https://robotapps.blob.core.windows.net/apps/d2d4e3fc-1810-4c05-937d-8154d31fca13machiningpowerpac6.04.zip</a></p><p>如果链接失效，该插件下载方式如下图，找到插件后，在右侧点击链接下载。<br>（由于插件页面无法上下滚动，所以如果屏幕看不到下面的下载链接，还需要调高屏幕分辨率或者把缩放改成100%，下载后再改回来即可）</p><p><img src="https://img.mahaofei.com/img/2022-06-24-153954.png" alt=""></p><blockquote><p>下载后为压缩包格式，解压后运行其中exe再进行解压，注意这次解压不要选带中文的路径，找到解压后的exe运行即可安装。</p><p>该插件为6.04版本，支持<code>Robotstudio6.04</code>及以上版本使用，低于此版本的使用插件时可能会出现兼容性问题，建议使用Robotstudio 6.08，该版本对于大多数插件都有较好的兼容性。使用时双击插件即可加载，加载成功后在<code>Add-Ins</code>栏中即可看到<code>Machining 6.04</code>插件。</p></blockquote><h1 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h1><h2 id="1-创建工件坐标与工具"><a href="#1-创建工件坐标与工具" class="headerlink" title="1. 创建工件坐标与工具"></a>1. 创建工件坐标与工具</h2><p>（1）首先创建工件坐标。</p><p><img src="https://img.mahaofei.com/img/20220624161214.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220624172529.png" alt=""></p><p>（2）然后创建工具。</p><p><img src="https://img.mahaofei.com/img/20220624161651.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220624163115.png" alt=""></p><p>侧面加工与端面加工，在图中可以直观理解为，使用圆柱的侧面、底面端面加工。</p><p>工具的类型如下：</p><ul><li>T_Cutter：T型刀</li><li>Chamfger_Cutter：倒角铣刀</li><li>Flame_Cutter：火焰切割枪</li><li>Swallow_Cutter：燕尾槽铣刀</li><li>Ball_Cutter：球型铣刀</li><li>None：无形状</li></ul><p><strong>对于喷漆作业来说，选择端面加工；使用T型刀，调整接触圈高度为喷头到工件的距离。</strong></p><p>（3）新建一个空程序组</p><p><img src="https://img.mahaofei.com/img/20220624163500.png" alt=""></p><h2 id="2-提取加工曲面"><a href="#2-提取加工曲面" class="headerlink" title="2. 提取加工曲面"></a>2. 提取加工曲面</h2><p>（1）新建几何</p><p><img src="https://img.mahaofei.com/img/20220624163756.png" alt=""></p><p>（2）设置曲线类型</p><p><img src="https://img.mahaofei.com/img/20220624182636.png" alt=""></p><p>类型：</p><ul><li>Projection Geometry：投影几何</li><li>Intersection Geometry：交叉口几何</li><li>UV Curve：UV曲线</li><li>Edge Curve：边缘曲线</li><li>Customized Curve：自定义曲线</li></ul><p>对于喷漆来说，我们选择使用Intersection Geometry复杂曲线。</p><p>（3）选择加工区域</p><p><img src="https://img.mahaofei.com/img/20220624173012.png" alt=""></p><p>（4）指定切割平面</p><p><img src="https://img.mahaofei.com/img/20220624182535.png" alt=""></p><h2 id="4-新建操作"><a href="#4-新建操作" class="headerlink" title="4. 新建操作"></a>4. 新建操作</h2><p>（1）新建一个操作</p><p><img src="https://img.mahaofei.com/img/20220624180205.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220624183344.png" alt=""></p><p>（2）设置外轴移动模式为：<strong>固定距离模式</strong></p><p><img src="https://img.mahaofei.com/img/20220624180233.png" alt=""></p><p>（3）点击刀具插补设置，点击可达率，在图表中选择一个100%可达率的角度，然后点击应用。</p><p><img src="https://img.mahaofei.com/img/20220624180319.png" alt=""></p><h2 id="5-模拟仿真"><a href="#5-模拟仿真" class="headerlink" title="5. 模拟仿真"></a>5. 模拟仿真</h2><p><img src="https://img.mahaofei.com/img/20220624183434.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220624184458.png" alt=""></p>]]></content>
    
    
    <summary type="html">在Robotstudio中导入一个CAD模型，如汽车外壳等复杂曲面模型。使用Robotstudio进行路径规划，实现机械臂的汽车外壳的喷漆功能。</summary>
    
    
    
    <category term="机器人" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
    
    <category term="RobotStudio" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA/RobotStudio/"/>
    
    
    <category term="实验" scheme="https://www.mahaofei.com/tags/%E5%AE%9E%E9%AA%8C/"/>
    
    <category term="RobotStudio" scheme="https://www.mahaofei.com/tags/RobotStudio/"/>
    
  </entry>
  
  <entry>
    <title>深度学习遇到报错Bug解决方法（不定时更新）</title>
    <link href="https://www.mahaofei.com/post/f5eca7d2.html"/>
    <id>https://www.mahaofei.com/post/f5eca7d2.html</id>
    <published>2022-06-11T00:51:26.000Z</published>
    <updated>2022-06-15T08:27:14.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="No-module-named-‘pycocotools‘"><a href="#No-module-named-‘pycocotools‘" class="headerlink" title="No module named ‘pycocotools‘"></a>No module named ‘pycocotools‘</h1><p>参考博客：<a href="https://blog.csdn.net/weixin_42410915/article/details/109368497">超简单解决No module named ‘pycocotools‘</a></p><p><a href="https://pypi.tuna.tsinghua.edu.cn/simple/pycocotools-windows/">各版本pycocotools.whl文件</a></p><p>点击连接中任意一个版本，（我安装的是2.0.0），下载的时候一定要注意对应的python版本，cp36指的是python3.6，cp37和cp38同理。</p><p>下载之后，放入你喜欢的文件夹中，然后启动命令行，进入whl文件所在的目录，输入以下命令即可，注意install后面是你自己下载的whl文件全称</p><p><img src="https://img-blog.csdnimg.cn/20201029204744983.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">activate tensorflow</span><br><span class="line">E:</span><br><span class="line">cd E:/windows/Downloads</span><br><span class="line">pip install pycocotools_windows-2.0-cp36-cp36m-win_amd64.whl</span><br></pre></td></tr></table></figure><h1 id="使用Google-Colab时，将Tensorflow版本转换到1-x版本"><a href="#使用Google-Colab时，将Tensorflow版本转换到1-x版本" class="headerlink" title="使用Google Colab时，将Tensorflow版本转换到1.x版本"></a>使用Google Colab时，将Tensorflow版本转换到1.x版本</h1><p>参考博客：<a href="https://blog.csdn.net/qq_44262417/article/details/105222696">https://blog.csdn.net/qq_44262417/article/details/105222696</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">tensorflow_version 1.x</span></span><br></pre></td></tr></table></figure><h1 id="maskrcnn训练提示：FutureWarning-Input-image-dtype-is-bool"><a href="#maskrcnn训练提示：FutureWarning-Input-image-dtype-is-bool" class="headerlink" title="maskrcnn训练提示：FutureWarning: Input image dtype is bool"></a>maskrcnn训练提示：FutureWarning: Input image dtype is bool</h1><p>参考博客：<a href="https://blog.csdn.net/qq_39483453/article/details/118598535">https://blog.csdn.net/qq_39483453/article/details/118598535</a></p><p>scikit-image=0.17.2 的版本存在的问题，修改scikit-image包版本为0.16.2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U scikit-image==0.16.2</span><br></pre></td></tr></table></figure><h1 id="成功解决AttributeError-‘str‘-object-has-no-attribute-‘decode‘"><a href="#成功解决AttributeError-‘str‘-object-has-no-attribute-‘decode‘" class="headerlink" title="成功解决AttributeError: ‘str‘ object has no attribute ‘decode‘"></a>成功解决AttributeError: ‘str‘ object has no attribute ‘decode‘</h1><p>参考博客：<a href="https://blog.csdn.net/qq_41185868/article/details/82079079">https://blog.csdn.net/qq_41185868/article/details/82079079</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install &#x27;h5py&lt;3.0.0&#x27; -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><h1 id="TypeError-expected-str-bytes-or-os-PathLike-object-not-NoneType"><a href="#TypeError-expected-str-bytes-or-os-PathLike-object-not-NoneType" class="headerlink" title="TypeError: expected str, bytes or os.PathLike object, not NoneType"></a>TypeError: expected str, bytes or os.PathLike object, not NoneType</h1><p>出现这个问题多半是没有指定路径，上述问题翻译过来是，期望一个字符串或者字节路径，而不是默认值，出现这个问题需要把指定路径的变量赋值即可。这种错误多半出现在运行开源代码时出现。</p><p>检查代码中对应位置的字符串变量，是否传入了确定的值，而非None。</p>]]></content>
    
    
    <summary type="html">在跑深度学习代码，进行训练和预测过程中，肯定会遇到各种报错，本文总结了本人遇到的一些errors总结在这里，不定时更新。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="bugs" scheme="https://www.mahaofei.com/tags/bugs/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>经典实例分割模型Mask RCNN</title>
    <link href="https://www.mahaofei.com/post/ef73cea9.html"/>
    <id>https://www.mahaofei.com/post/ef73cea9.html</id>
    <published>2022-06-11T00:47:32.000Z</published>
    <updated>2022-06-11T00:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、Mask-RCNN简介"><a href="#一、Mask-RCNN简介" class="headerlink" title="一、Mask RCNN简介"></a>一、Mask RCNN简介</h1><p>区域卷积神经网络 RCNN（Region-Convolutional Neural Networks）为两阶段目标检测器。通过对图像生成候选区域，提取特征，判别特征类别并修正候选框位置。 RCNN系列目前包含两个代表模型：Faster RCNN，Mask RCNN。</p><p>Mask R-CNN是He Kaiming大神2017年的力作，其在进行目标检测的同时进行实例分割，取得了出色的效果。</p><p><img src="https://img.mahaofei.com/img/20220515154938.png" alt=""></p><p>Mask-RCNN使用Resnet101作为主干特征提取网络，也就是图中的CNN部分，其对输入的图像image要求其是正方形且宽高可以整除2的6次方，不足的将会在外侧添加灰色区域。</p><ol><li><strong>Resnet101主干特征提取（CNN）</strong></li></ol><p>一张图像image传入到 <strong>Resnet101(CNN)</strong> 之后，会对其进行特征提取，然后将图像长宽压缩两次、三次、四次、五次来构造特征金字塔，目的是为了实现特征多尺度融合。</p><p><img src="https://img.mahaofei.com/img/20220515161629.png" alt=""></p><p>也就是下图中的左侧部分，分别得到了C2、C3、C4、C5五种特征层（五种尺寸的图像）。</p><p><img src="https://img.mahaofei.com/img/20220515162541.png" alt=""></p><ul><li>P5：对最小的C5(32,32)图像进行二维卷积，然后再次卷积作为一个有效特征层P5(32,32)（下方绿色框）</li><li>P6：将P5(32,32)最大池化得到有效特征层P6(16,16)。</li><li>P4：将C5(32,32)一次卷积的结果上采样得到(64,64)图像，与C4(64,64)进行Add运算，然后再次卷积得到另一个有效特征层P4。</li><li>P3：将C4一次卷积结果上采样，并与C3进行Add运算，然后再次卷积得到有效特征层P3。</li><li>P2：将C3一次卷积结果上采样，并与C2进行Add运算，再次卷积得到有效特征层P2。</li></ul><p>提取到的P2、P3、P4、P5、P6五个有效特征层，就是Resent101的输出feature maps，可以用于接下来RPN建议网络获取建议框。</p><ol><li><strong>RPN区域建议网络（Region Proposal）</strong></li></ol><p>对有效特征层使用RPN建议网络（region proposal），获得许多建议框regions，这些建议框可能包含物体，可能没包含物体。不管包括没包括，接下来都会利用这些建议框截取P2~P5的图像，得到一个个可能存在目标的截取图像（P6不截取）。</p><ol><li><strong>ROI区域对齐（ROI Align）</strong></li></ol><p>对于所有建议框截取图像，RoI Align都会将其调整图像尺寸为一个正方形，便于后续特征的匹配操作。这样经过所有ROI Align后的建议框截取图像，</p><ol><li><strong>FC Layers</strong></li></ol><p>根据截取出的建议框图像，利用Classifier回归模型判断截取的区域是否有物体，然后利用Classifier预测框网络对有效特征层进行解码获得最终的预测框。</p><ol><li><strong>Mask语义分割网络</strong></li></ol><p>利用获取的最终预测框，再次在有效特征层P2~P5中截取目标图像（这次由于相当于进行了以便筛选，截取出的图像数量会少很多），将这次截取出的图像传给Mask语义分割网络进行语义分割。</p><h1 id="二、Mask-R-CNN实现过程"><a href="#二、Mask-R-CNN实现过程" class="headerlink" title="二、Mask R-CNN实现过程"></a>二、Mask R-CNN实现过程</h1><h2 id="2-1-Resnet101-主干特征提取网络"><a href="#2-1-Resnet101-主干特征提取网络" class="headerlink" title="2.1 Resnet101-主干特征提取网络"></a>2.1 Resnet101-主干特征提取网络</h2><p>ResNet101有两个基本的块，分别是<code>Conv Block</code>和<code>Identity Block</code>。其中<code>Conv Block</code>的输入和输出维度不同，不能持续串联，它的作用是改变网络的维度；<code>Identity Block</code>的输入维度和输出维度相同，可以串联，用于加深网络。</p><p><img src="https://img.mahaofei.com/img/20220515195957.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220515195949.png" alt=""></p><p>以coco数据集中输入的shape为例，输入的shape为1024x1024，shape变化如下：</p><p><img src="https://img.mahaofei.com/img/20220515200117.png" alt=""></p><p>我们取出长宽压缩了两次、三次、四次、五次的结果来进行下面特征金字塔结构的构造。</p><p>相关代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> ZeroPadding2D,Conv2D,MaxPooling2D,BatchNormalization,Activation,Add</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">identity_block</span>(<span class="params">input_tensor, kernel_size, filters, stage, block,</span></span><br><span class="line"><span class="params">                   use_bias=<span class="literal">True</span>, train_bn=<span class="literal">True</span></span>):</span><br><span class="line">    nb_filter1, nb_filter2, nb_filter3 = filters</span><br><span class="line">    conv_name_base = <span class="string">&#x27;res&#x27;</span> + <span class="built_in">str</span>(stage) + block + <span class="string">&#x27;_branch&#x27;</span></span><br><span class="line">    bn_name_base = <span class="string">&#x27;bn&#x27;</span> + <span class="built_in">str</span>(stage) + block + <span class="string">&#x27;_branch&#x27;</span></span><br><span class="line"></span><br><span class="line">    x = Conv2D(nb_filter1, (<span class="number">1</span>, <span class="number">1</span>), name=conv_name_base + <span class="string">&#x27;2a&#x27;</span>,</span><br><span class="line">                  use_bias=use_bias)(input_tensor)</span><br><span class="line">    x = BatchNormalization(name=bn_name_base + <span class="string">&#x27;2a&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    x = Conv2D(nb_filter2, (kernel_size, kernel_size), padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">                  name=conv_name_base + <span class="string">&#x27;2b&#x27;</span>, use_bias=use_bias)(x)</span><br><span class="line">    x = BatchNormalization(name=bn_name_base + <span class="string">&#x27;2b&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    x = Conv2D(nb_filter3, (<span class="number">1</span>, <span class="number">1</span>), name=conv_name_base + <span class="string">&#x27;2c&#x27;</span>,</span><br><span class="line">                  use_bias=use_bias)(x)</span><br><span class="line">    x = BatchNormalization(name=bn_name_base + <span class="string">&#x27;2c&#x27;</span>)(x, training=train_bn)</span><br><span class="line"></span><br><span class="line">    x = Add()([x, input_tensor])</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;res&#x27;</span> + <span class="built_in">str</span>(stage) + block + <span class="string">&#x27;_out&#x27;</span>)(x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">conv_block</span>(<span class="params">input_tensor, kernel_size, filters, stage, block,</span></span><br><span class="line"><span class="params">               strides=(<span class="params"><span class="number">2</span>, <span class="number">2</span></span>), use_bias=<span class="literal">True</span>, train_bn=<span class="literal">True</span></span>):</span><br><span class="line"></span><br><span class="line">    nb_filter1, nb_filter2, nb_filter3 = filters</span><br><span class="line">    conv_name_base = <span class="string">&#x27;res&#x27;</span> + <span class="built_in">str</span>(stage) + block + <span class="string">&#x27;_branch&#x27;</span></span><br><span class="line">    bn_name_base = <span class="string">&#x27;bn&#x27;</span> + <span class="built_in">str</span>(stage) + block + <span class="string">&#x27;_branch&#x27;</span></span><br><span class="line"></span><br><span class="line">    x = Conv2D(nb_filter1, (<span class="number">1</span>, <span class="number">1</span>), strides=strides,</span><br><span class="line">                  name=conv_name_base + <span class="string">&#x27;2a&#x27;</span>, use_bias=use_bias)(input_tensor)</span><br><span class="line">    x = BatchNormalization(name=bn_name_base + <span class="string">&#x27;2a&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    x = Conv2D(nb_filter2, (kernel_size, kernel_size), padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">                  name=conv_name_base + <span class="string">&#x27;2b&#x27;</span>, use_bias=use_bias)(x)</span><br><span class="line">    x = BatchNormalization(name=bn_name_base + <span class="string">&#x27;2b&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    x = Conv2D(nb_filter3, (<span class="number">1</span>, <span class="number">1</span>), name=conv_name_base +</span><br><span class="line">                  <span class="string">&#x27;2c&#x27;</span>, use_bias=use_bias)(x)</span><br><span class="line">    x = BatchNormalization(name=bn_name_base + <span class="string">&#x27;2c&#x27;</span>)(x, training=train_bn)</span><br><span class="line"></span><br><span class="line">    shortcut = Conv2D(nb_filter3, (<span class="number">1</span>, <span class="number">1</span>), strides=strides,</span><br><span class="line">                         name=conv_name_base + <span class="string">&#x27;1&#x27;</span>, use_bias=use_bias)(input_tensor)</span><br><span class="line">    shortcut = BatchNormalization(name=bn_name_base + <span class="string">&#x27;1&#x27;</span>)(shortcut, training=train_bn)</span><br><span class="line"></span><br><span class="line">    x = Add()([x, shortcut])</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;res&#x27;</span> + <span class="built_in">str</span>(stage) + block + <span class="string">&#x27;_out&#x27;</span>)(x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_resnet</span>(<span class="params">input_image,stage5=<span class="literal">False</span>, train_bn=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="comment"># Stage 1</span></span><br><span class="line">    x = ZeroPadding2D((<span class="number">3</span>, <span class="number">3</span>))(input_image)</span><br><span class="line">    x = Conv2D(<span class="number">64</span>, (<span class="number">7</span>, <span class="number">7</span>), strides=(<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;conv1&#x27;</span>, use_bias=<span class="literal">True</span>)(x)</span><br><span class="line">    x = BatchNormalization(name=<span class="string">&#x27;bn_conv1&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line">    <span class="comment"># Height/4,Width/4,64</span></span><br><span class="line">    C1 = x = MaxPooling2D((<span class="number">3</span>, <span class="number">3</span>), strides=(<span class="number">2</span>, <span class="number">2</span>), padding=<span class="string">&quot;same&quot;</span>)(x)</span><br><span class="line">    <span class="comment"># Stage 2</span></span><br><span class="line">    x = conv_block(x, <span class="number">3</span>, [<span class="number">64</span>, <span class="number">64</span>, <span class="number">256</span>], stage=<span class="number">2</span>, block=<span class="string">&#x27;a&#x27;</span>, strides=(<span class="number">1</span>, <span class="number">1</span>), train_bn=train_bn)</span><br><span class="line">    x = identity_block(x, <span class="number">3</span>, [<span class="number">64</span>, <span class="number">64</span>, <span class="number">256</span>], stage=<span class="number">2</span>, block=<span class="string">&#x27;b&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    <span class="comment"># Height/4,Width/4,256</span></span><br><span class="line">    C2 = x = identity_block(x, <span class="number">3</span>, [<span class="number">64</span>, <span class="number">64</span>, <span class="number">256</span>], stage=<span class="number">2</span>, block=<span class="string">&#x27;c&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    <span class="comment"># Stage 3</span></span><br><span class="line">    x = conv_block(x, <span class="number">3</span>, [<span class="number">128</span>, <span class="number">128</span>, <span class="number">512</span>], stage=<span class="number">3</span>, block=<span class="string">&#x27;a&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    x = identity_block(x, <span class="number">3</span>, [<span class="number">128</span>, <span class="number">128</span>, <span class="number">512</span>], stage=<span class="number">3</span>, block=<span class="string">&#x27;b&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    x = identity_block(x, <span class="number">3</span>, [<span class="number">128</span>, <span class="number">128</span>, <span class="number">512</span>], stage=<span class="number">3</span>, block=<span class="string">&#x27;c&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    <span class="comment"># Height/8,Width/8,512</span></span><br><span class="line">    C3 = x = identity_block(x, <span class="number">3</span>, [<span class="number">128</span>, <span class="number">128</span>, <span class="number">512</span>], stage=<span class="number">3</span>, block=<span class="string">&#x27;d&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    <span class="comment"># Stage 4</span></span><br><span class="line">    x = conv_block(x, <span class="number">3</span>, [<span class="number">256</span>, <span class="number">256</span>, <span class="number">1024</span>], stage=<span class="number">4</span>, block=<span class="string">&#x27;a&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    block_count = <span class="number">22</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_count):</span><br><span class="line">        x = identity_block(x, <span class="number">3</span>, [<span class="number">256</span>, <span class="number">256</span>, <span class="number">1024</span>], stage=<span class="number">4</span>, block=<span class="built_in">chr</span>(<span class="number">98</span> + i), train_bn=train_bn)</span><br><span class="line">    <span class="comment"># Height/16,Width/16,1024</span></span><br><span class="line">    C4 = x</span><br><span class="line">    <span class="comment"># Stage 5</span></span><br><span class="line">    <span class="keyword">if</span> stage5:</span><br><span class="line">        x = conv_block(x, <span class="number">3</span>, [<span class="number">512</span>, <span class="number">512</span>, <span class="number">2048</span>], stage=<span class="number">5</span>, block=<span class="string">&#x27;a&#x27;</span>, train_bn=train_bn)</span><br><span class="line">        x = identity_block(x, <span class="number">3</span>, [<span class="number">512</span>, <span class="number">512</span>, <span class="number">2048</span>], stage=<span class="number">5</span>, block=<span class="string">&#x27;b&#x27;</span>, train_bn=train_bn)</span><br><span class="line">        <span class="comment"># Height/32,Width/32,2048</span></span><br><span class="line">        C5 = x = identity_block(x, <span class="number">3</span>, [<span class="number">512</span>, <span class="number">512</span>, <span class="number">2048</span>], stage=<span class="number">5</span>, block=<span class="string">&#x27;c&#x27;</span>, train_bn=train_bn)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        C5 = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> [C1, C2, C3, C4, C5]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>关于残差神经网络，可以参考此文章：<a href="https://zhuanlan.zhihu.com/p/349717627">ResNet：残差神经网络</a></p><h2 id="2-2-Feature-Pyramid-FPN构建特征金字塔"><a href="#2-2-Feature-Pyramid-FPN构建特征金字塔" class="headerlink" title="2.2 Feature Pyramid-FPN构建特征金字塔"></a>2.2 Feature Pyramid-FPN构建特征金字塔</h2><p>上文经过主干特征提取后可以得到长宽压缩了两次C2、三次C3、四次C4、五次C5的结果，用这些结果进行特征金字塔的构造，主要是为了得到P2~P6五个有效特征层。</p><p><img src="https://img.mahaofei.com/img/20220515162541.png" alt=""></p><p>具体过程为：</p><ul><li>P5：对【C5】进行一次256通道的卷积，再进行一次256通道的卷积，得到P5。</li><li>P6：将P5进行最大池化得到P6。</li><li>P4：将【C5一次卷积的结果】进行上采样，再与【C4进行256通道卷积的结果】的进行Add运算，再进行一次256通道的卷积，得到P4。</li><li>P3、P2过程类似P4。</li></ul><p>提取到的P2、P3、P4、P5、P6可以作为RPN网络的有效特征层，利用RPN建议框网络对有效特征层进行下一步的操作，对先验框进行解码获得建议框。</p><p>提取到的P2、P3、P4、P5可以作为Classifier和Mask网络的有效特征层，利用Classifier预测框网络对有效特征层进行下一步的操作，对建议框解码获得最终预测框；利用Mask语义分割网络对有效特征层进行下一步的操作，获得每一个预测框内部的语义分割结果。</p><p>具体代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得Resnet里的压缩程度不同的一些层</span></span><br><span class="line">_, C2, C3, C4, C5 = get_resnet(input_image, stage5=<span class="literal">True</span>, train_bn=config.TRAIN_BN)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合成特征金字塔的结构</span></span><br><span class="line"><span class="comment"># P5长宽共压缩了5次</span></span><br><span class="line"><span class="comment"># Height/32,Width/32,256</span></span><br><span class="line">P5 = Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">1</span>, <span class="number">1</span>), name=<span class="string">&#x27;fpn_c5p5&#x27;</span>)(C5)</span><br><span class="line"><span class="comment"># P4长宽共压缩了4次</span></span><br><span class="line"><span class="comment"># Height/16,Width/16,256</span></span><br><span class="line">P4 = Add(name=<span class="string">&quot;fpn_p4add&quot;</span>)([</span><br><span class="line">    UpSampling2D(size=(<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&quot;fpn_p5upsampled&quot;</span>)(P5),</span><br><span class="line">    Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">1</span>, <span class="number">1</span>), name=<span class="string">&#x27;fpn_c4p4&#x27;</span>)(C4)])</span><br><span class="line"><span class="comment"># P4长宽共压缩了3次</span></span><br><span class="line"><span class="comment"># Height/8,Width/8,256</span></span><br><span class="line">P3 = Add(name=<span class="string">&quot;fpn_p3add&quot;</span>)([</span><br><span class="line">    UpSampling2D(size=(<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&quot;fpn_p4upsampled&quot;</span>)(P4),</span><br><span class="line">    Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">1</span>, <span class="number">1</span>), name=<span class="string">&#x27;fpn_c3p3&#x27;</span>)(C3)])</span><br><span class="line"><span class="comment"># P4长宽共压缩了2次</span></span><br><span class="line"><span class="comment"># Height/4,Width/4,256</span></span><br><span class="line">P2 = Add(name=<span class="string">&quot;fpn_p2add&quot;</span>)([</span><br><span class="line">    UpSampling2D(size=(<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&quot;fpn_p3upsampled&quot;</span>)(P3),</span><br><span class="line">    Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">1</span>, <span class="number">1</span>), name=<span class="string">&#x27;fpn_c2p2&#x27;</span>)(C2)])</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 各自进行一次256通道的卷积，此时P2、P3、P4、P5通道数相同</span></span><br><span class="line"><span class="comment"># Height/4,Width/4,256</span></span><br><span class="line">P2 = Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;SAME&quot;</span>, name=<span class="string">&quot;fpn_p2&quot;</span>)(P2)</span><br><span class="line"><span class="comment"># Height/8,Width/8,256</span></span><br><span class="line">P3 = Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;SAME&quot;</span>, name=<span class="string">&quot;fpn_p3&quot;</span>)(P3)</span><br><span class="line"><span class="comment"># Height/16,Width/16,256</span></span><br><span class="line">P4 = Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;SAME&quot;</span>, name=<span class="string">&quot;fpn_p4&quot;</span>)(P4)</span><br><span class="line"><span class="comment"># Height/32,Width/32,256</span></span><br><span class="line">P5 = Conv2D(config.TOP_DOWN_PYRAMID_SIZE, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;SAME&quot;</span>, name=<span class="string">&quot;fpn_p5&quot;</span>)(P5)</span><br><span class="line"><span class="comment"># 在建议框网络里面还有一个P6用于获取建议框</span></span><br><span class="line"><span class="comment"># Height/64,Width/64,256</span></span><br><span class="line">P6 = MaxPooling2D(pool_size=(<span class="number">1</span>, <span class="number">1</span>), strides=<span class="number">2</span>, name=<span class="string">&quot;fpn_p6&quot;</span>)(P5)</span><br><span class="line"></span><br><span class="line"><span class="comment"># P2, P3, P4, P5, P6可以用于获取建议框</span></span><br><span class="line">rpn_feature_maps = [P2, P3, P4, P5, P6]</span><br><span class="line"><span class="comment"># P2, P3, P4, P5用于获取mask信息</span></span><br><span class="line">mrcnn_feature_maps = [P2, P3, P4, P5]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-3-构建RPN建议网络模型"><a href="#2-3-构建RPN建议网络模型" class="headerlink" title="2.3 构建RPN建议网络模型"></a>2.3 构建RPN建议网络模型</h2><p>RPN建议网络的模型</p><ul><li>首先进行一次3x3的通道为512的卷积</li><li>然后分别进行一次<code>anchors_per_location x 2</code>的卷积和<code>anchors_per_location x 4</code>的卷积。<ul><li><code>anchors_per_location x 2</code>的卷积用于预测<strong>公共特征层上 每一个网格点上 每一个预测框</strong>内部是否包含物体。</li><li><code>anchors_per_location x 4</code>的卷积用于预测<strong>公共特征层上 每一个网格点上 每一个先验框</strong>的变化情况。</li></ul></li></ul><p>例如输入图片的shape是1024x1024x3时，公共特征层的shape就是256x256x256、128x128x256、64x64x256、32x32x256、16x16x256。这些公共特征层上的每一个点，映射到原始图片上就是间隔不同的网格点，每个网格默认存在3(anchors_per_location)个先验框，这些先验框有不同的大小。</p><p><img src="https://img.mahaofei.com/img/20220516162352.png" alt=""></p><p><strong>anchors_per_location x 4的卷积</strong>的结果会对这些先验框进行调整，获得一个新的框。<br><strong>anchors_per_location x 2的卷积</strong>会判断上述获得的新框是否包含物体。</p><p>到这里我们可以获得了一些有用的框，这些框会利用<strong>anchors_per_location x 2的卷积</strong>判断是否存在物体。</p><p>实现代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------------------#</span></span><br><span class="line"><span class="comment">#   五个不同大小的特征层会传入到</span></span><br><span class="line"><span class="comment">#   RPN当中，获得建议框</span></span><br><span class="line"><span class="comment">#------------------------------------#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rpn_graph</span>(<span class="params">feature_map, anchors_per_location</span>):</span><br><span class="line">    <span class="comment">#------------------------------------#</span></span><br><span class="line">    <span class="comment">#   利用一个3x3卷积进行特征整合，基础的层</span></span><br><span class="line">    <span class="comment">#------------------------------------#</span></span><br><span class="line">    shared = Conv2D(<span class="number">512</span>, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;rpn_conv_shared&#x27;</span>)(feature_map)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#------------------------------------#</span></span><br><span class="line">    <span class="comment">#   batch_size, num_anchors, 2</span></span><br><span class="line">    <span class="comment">#   代表这个先验框是否包含物体</span></span><br><span class="line">    <span class="comment">#   anchor_per_location的默认值是3</span></span><br><span class="line">    <span class="comment">#   意味着特征层对图像进行网格的划分后，每个网格上先验框的数量是3</span></span><br><span class="line">    <span class="comment">#------------------------------------#</span></span><br><span class="line">    x = Conv2D(anchors_per_location * <span class="number">2</span>, (<span class="number">1</span>, <span class="number">1</span>), padding=<span class="string">&#x27;valid&#x27;</span>, activation=<span class="string">&#x27;linear&#x27;</span>, name=<span class="string">&#x27;rpn_class_raw&#x27;</span>)(shared)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># reshape到最后一个维度是2的维度，是一个分类网络，有非常多先验框</span></span><br><span class="line">    rpn_class_logits = Reshape([-<span class="number">1</span>,<span class="number">2</span>])(x)</span><br><span class="line">    rpn_probs = Activation(<span class="string">&quot;softmax&quot;</span>, name=<span class="string">&quot;rpn_class_xxx&quot;</span>)(rpn_class_logits)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#------------------------------------#</span></span><br><span class="line">    <span class="comment">#   batch_size, num_anchors, 4</span></span><br><span class="line">    <span class="comment">#   这个先验框的调整参数</span></span><br><span class="line">    <span class="comment">#------------------------------------#</span></span><br><span class="line">    x = Conv2D(anchors_per_location * <span class="number">4</span>, (<span class="number">1</span>, <span class="number">1</span>), padding=<span class="string">&quot;valid&quot;</span>, activation=<span class="string">&#x27;linear&#x27;</span>, name=<span class="string">&#x27;rpn_bbox_pred&#x27;</span>)(shared)</span><br><span class="line">    rpn_bbox = Reshape([-<span class="number">1</span>, <span class="number">4</span>])(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出包括：</span></span><br><span class="line">    <span class="comment"># 先验框是否真实的包含物体</span></span><br><span class="line">    <span class="comment"># bbox先验框的调整参数</span></span><br><span class="line">    <span class="keyword">return</span> [rpn_class_logits, rpn_probs, rpn_bbox]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------#</span></span><br><span class="line"><span class="comment">#   建立建议框网络模型</span></span><br><span class="line"><span class="comment">#   RPN模型</span></span><br><span class="line"><span class="comment">#------------------------------------#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_rpn_model</span>(<span class="params">anchors_per_location, depth</span>):</span><br><span class="line">    <span class="comment"># 输入的长和宽都是None，代表输入的有效特征层大小是变化的，256、64等都可以</span></span><br><span class="line">    <span class="comment"># 输入的depth是256</span></span><br><span class="line">    input_feature_map = Input(shape=[<span class="literal">None</span>, <span class="literal">None</span>, depth], name=<span class="string">&quot;input_rpn_feature_map&quot;</span>)</span><br><span class="line">    <span class="comment"># 将输入的图像传入到rpn_graph中</span></span><br><span class="line">    outputs = rpn_graph(input_feature_map, anchors_per_location)</span><br><span class="line">    <span class="keyword">return</span> Model([input_feature_map], outputs, name=<span class="string">&quot;rpn_model&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="2-4-Anchors先验框的获取"><a href="#2-4-Anchors先验框的获取" class="headerlink" title="2.4 Anchors先验框的获取"></a>2.4 Anchors先验框的获取</h2><p><strong>先验框就是图像上的一定的区域，这些区域是人为规定好的</strong>，这些区域可能包含物体，可能不包含物体，我们网络的预测结果就会判断哪些先验框是包含物体的，然后对先验框进行调整。</p><p>在MaskRCNN中，建议框网络的预测结果就会对这些先验框进行调整，获得建议框，并判断哪些先验框是包含物体的。</p><p>本节介绍如何获得<strong>先验框</strong>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#  Anchors</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_anchors</span>(<span class="params">scales, ratios, shape, feature_stride, anchor_stride</span>):</span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   获得所有框的长度和比例的组合</span></span><br><span class="line">    <span class="comment">#   相当于在每一个网格点上获得了两个长方形(1:2)、(2:1)和一个正方形</span></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    scales, ratios = np.meshgrid(np.array(scales), np.array(ratios))</span><br><span class="line">    scales = scales.flatten()</span><br><span class="line">    ratios = ratios.flatten()</span><br><span class="line">    heights = scales / np.sqrt(ratios)</span><br><span class="line">    widths = scales * np.sqrt(ratios)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   生成网格中心</span></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    shifts_y = np.arange(<span class="number">0</span>, shape[<span class="number">0</span>], anchor_stride) * feature_stride</span><br><span class="line">    shifts_x = np.arange(<span class="number">0</span>, shape[<span class="number">1</span>], anchor_stride) * feature_stride</span><br><span class="line">    shifts_x, shifts_y = np.meshgrid(shifts_x, shifts_y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   获得先验框的中心和宽高</span></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    box_widths, box_centers_x = np.meshgrid(widths, shifts_x)</span><br><span class="line">    box_heights, box_centers_y = np.meshgrid(heights, shifts_y)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   更变格式</span></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    <span class="comment"># 对先验框的中心堆叠，然后reshape，reshape后的结果代表每一个先验框的中心坐标</span></span><br><span class="line">    box_centers = np.stack([box_centers_y, box_centers_x], axis=<span class="number">2</span>).reshape([-<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">    <span class="comment"># 对先验框的高和宽堆叠，然后reshape，reshape后的结果代表每一个先验框的高和宽</span></span><br><span class="line">    box_sizes = np.stack([box_heights, box_widths], axis=<span class="number">2</span>).reshape([-<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">  </span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   计算出(y1, x1, y2, x2)</span></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    boxes = np.concatenate([box_centers - <span class="number">0.5</span> * box_sizes, box_centers + <span class="number">0.5</span> * box_sizes], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> boxes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成特征金字塔先验框</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_pyramid_anchors</span>(<span class="params">scales, ratios, feature_shapes, feature_strides,  anchor_stride</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成不同特征层的anchors，并利用concatenate进行堆叠</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   Anchors</span></span><br><span class="line">    <span class="comment">#   [anchor_count, (y1, x1, y2, x2)]</span></span><br><span class="line">    <span class="comment">#   P2对应的scale是32</span></span><br><span class="line">    <span class="comment">#   P3对应的scale是64</span></span><br><span class="line">    <span class="comment">#   P4对应的scale是128</span></span><br><span class="line">    <span class="comment">#   P5对应的scale是256</span></span><br><span class="line">    <span class="comment">#   P6对应的scale是512</span></span><br><span class="line">    <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">    anchors = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 对scales进行for循环，是传入的anchor_scales，是32、64、128、256、512</span></span><br><span class="line">    <span class="comment"># 对应不同特征层上先验框的基础大小，再在此基础上获得调整，获得不同长宽大小的先验框</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(scales)):</span><br><span class="line">        <span class="comment"># ratio的值是0.5、1、2，对应每个网格点上三个先验框</span></span><br><span class="line">        <span class="comment"># feature_shapes就是获得的每一个有效特征层的大小，代表我们要将图片分割成多少网格</span></span><br><span class="line">        <span class="comment"># feature_strides对应backbone_strides，是4、8、16、32、64</span></span><br><span class="line">        <span class="comment"># anchor_stride的值为1</span></span><br><span class="line">        anchors.append(generate_anchors(scales[i], ratios, feature_shapes[i], feature_strides[i], anchor_stride))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> np.concatenate(anchors, axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_backbone_shapes</span>(<span class="params">config, image_shape</span>):</span><br><span class="line">    <span class="keyword">return</span> np.array( [[<span class="built_in">int</span>(math.ceil(image_shape[<span class="number">0</span>] / stride)), <span class="built_in">int</span>(math.ceil(image_shape[<span class="number">1</span>] / stride))] <span class="keyword">for</span> stride <span class="keyword">in</span> config.BACKBONE_STRIDES])</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用下面的函数获取先验框</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_anchors</span>(<span class="params">config, image_shape</span>):</span><br><span class="line">    <span class="comment"># 计算主干特征提取网络获得的有效特征层的shape</span></span><br><span class="line">    <span class="comment"># 为了事先放置先验框，我们需要知道网格大小，因此需要先获得有效特征层的shape</span></span><br><span class="line">    backbone_shapes = compute_backbone_shapes(config, image_shape)</span><br><span class="line">    anchor_cache = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">tuple</span>(image_shape) <span class="keyword">in</span> anchor_cache:</span><br><span class="line">        <span class="comment"># 将backbone_shapes传入下面的函数</span></span><br><span class="line">        <span class="comment"># 生成特征金字塔的先验框</span></span><br><span class="line">        a = generate_pyramid_anchors(</span><br><span class="line">            config.RPN_ANCHOR_SCALES,</span><br><span class="line">            config.RPN_ANCHOR_RATIOS,</span><br><span class="line">            backbone_shapes,</span><br><span class="line">            config.BACKBONE_STRIDES,</span><br><span class="line">            config.RPN_ANCHOR_STRIDE)</span><br><span class="line">        anchor_cache[<span class="built_in">tuple</span>(image_shape)] = norm_boxes(a, image_shape[:<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">return</span> anchor_cache[<span class="built_in">tuple</span>(image_shape)]</span><br></pre></td></tr></table></figure><h2 id="2-5-先验框调整获得建议框"><a href="#2-5-先验框调整获得建议框" class="headerlink" title="2.5 先验框调整获得建议框"></a>2.5 先验框调整获得建议框</h2><p>利用<code>ProposalLayer</code>对先验框解码获取建议框。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   对先验框进行解码，获得先验框解码后的建议框的坐标</span></span><br><span class="line">    <span class="comment">#   rpn_rois            : Batch_size, proposal_count, 4</span></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line"></span><br><span class="line">    proposal_count = config.POST_NMS_ROIS_TRAINING</span><br><span class="line">    rpn_rois = ProposalLayer(proposal_count=proposal_count, nms_threshold=config.RPN_NMS_THRESHOLD, name=<span class="string">&quot;ROI&quot;</span>, config=config)([rpn_class, rpn_bbox, anchors])</span><br><span class="line">    active_class_ids = Lambda(<span class="keyword">lambda</span> x: parse_image_meta_graph(x)[<span class="string">&quot;active_class_ids&quot;</span>])(input_image_meta)</span><br></pre></td></tr></table></figure><p>输入参数有三个分别是<code>rpn_class</code>、<code>rpn_bbox</code>、<code>anchors</code>，这里的<code>rpn_class</code>代表所有先验框是否包含物体的置信度，<code>rpn_bbox</code>代表所有先验框的调整参数，<code>anchors</code>之前获得的所有先验框。</p><p>其中<code>ProposalLayer</code>的具体代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#   Proposal Layer</span></span><br><span class="line"><span class="comment">#   该部分代码用于将先验框转化成建议框</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProposalLayer</span>(<span class="title class_ inherited__">Layer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, proposal_count, nms_threshold, config=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(ProposalLayer, self).__init__(**kwargs)</span><br><span class="line">        self.config = config</span><br><span class="line">        self.proposal_count = proposal_count</span><br><span class="line">        self.nms_threshold = nms_threshold</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   输入的inputs有三个内容</span></span><br><span class="line">        <span class="comment">#   inputs[0]   rpn_class   : Batch_size, num_anchors, 2</span></span><br><span class="line">        <span class="comment">#   inputs[1]   rpn_bbox    : Batch_size, num_anchors, 4</span></span><br><span class="line">        <span class="comment">#   inputs[2]   anchors     : Batch_size, num_anchors, 4</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得先验框内部是否有物体[Batch_size, num_anchors, 1]</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        scores = inputs[<span class="number">0</span>][:, :, <span class="number">1</span>]</span><br><span class="line">  </span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得先验框的调整参数[batch, num_rois, 4]</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        deltas = inputs[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得先验框的坐标</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        anchors = inputs[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   RPN_BBOX_STD_DEV[0.1 0.1 0.2 0.2] 改变数量级</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        deltas = deltas * np.reshape(self.config.RPN_BBOX_STD_DEV, [<span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   筛选出得分前6000个的框</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        pre_nms_limit = tf.minimum(self.config.PRE_NMS_LIMIT, tf.shape(anchors)[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得这些框的索引</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        ix = tf.nn.top_k(scores, pre_nms_limit, <span class="built_in">sorted</span>=<span class="literal">True</span>, name=<span class="string">&quot;top_anchors&quot;</span>).indices</span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得先验框、及其得分与调整参数</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        scores = batch_slice([scores, ix], <span class="keyword">lambda</span> x, y: tf.gather(x, y), self.config.IMAGES_PER_GPU)</span><br><span class="line">        deltas = batch_slice([deltas, ix], <span class="keyword">lambda</span> x, y: tf.gather(x, y), self.config.IMAGES_PER_GPU)</span><br><span class="line">        pre_nms_anchors = batch_slice([anchors, ix], <span class="keyword">lambda</span> a, x: tf.gather(a, x), self.config.IMAGES_PER_GPU, names=[<span class="string">&quot;pre_nms_anchors&quot;</span>])</span><br><span class="line">  </span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   [batch, pre_nms_limit, (y1, x1, y2, x2)]</span></span><br><span class="line">        <span class="comment">#   对先验框进行解码</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        boxes = batch_slice([pre_nms_anchors, deltas], <span class="keyword">lambda</span> x, y: apply_box_deltas_graph(x, y), self.config.IMAGES_PER_GPU, names=[<span class="string">&quot;refined_anchors&quot;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   [batch, pre_nms_limit, (y1, x1, y2, x2)]</span></span><br><span class="line">        <span class="comment">#   防止超出图片范围</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        window = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>], dtype=np.float32)</span><br><span class="line">        boxes = batch_slice(boxes, <span class="keyword">lambda</span> x: clip_boxes_graph(x, window), self.config.IMAGES_PER_GPU, names=[<span class="string">&quot;refined_anchors_clipped&quot;</span>])</span><br><span class="line">  </span><br><span class="line">        <span class="comment">#---------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   在非极大抑制后</span></span><br><span class="line">        <span class="comment">#   获得一个shape为[batch, NMS_ROIS, 4]的proposals</span></span><br><span class="line">        <span class="comment">#---------------------------------------------------------#</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">nms</span>(<span class="params">boxes, scores</span>):</span><br><span class="line">            indices = tf.image.non_max_suppression(boxes, scores, self.proposal_count, self.nms_threshold, name=<span class="string">&quot;rpn_non_max_suppression&quot;</span>)</span><br><span class="line">            proposals = tf.gather(boxes, indices)</span><br><span class="line">            padding = tf.maximum(self.proposal_count - tf.shape(proposals)[<span class="number">0</span>], <span class="number">0</span>)</span><br><span class="line">            proposals = tf.pad(proposals, [(<span class="number">0</span>, padding), (<span class="number">0</span>, <span class="number">0</span>)])</span><br><span class="line">            <span class="keyword">return</span> proposals</span><br><span class="line">        proposals = batch_slice([boxes, scores], nms, self.config.IMAGES_PER_GPU)</span><br><span class="line">        <span class="keyword">return</span> proposals</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute_output_shape</span>(<span class="params">self, input_shape</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="literal">None</span>, self.proposal_count, <span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>其中利用到了下面的函数对建议框的位置和长宽进行调整</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#   利用先验框调整参数调整先验框，获得建议框的坐标</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_box_deltas_graph</span>(<span class="params">boxes, deltas</span>):</span><br><span class="line">    <span class="comment">#---------------------------------------#</span></span><br><span class="line">    <span class="comment">#   计算先验框的中心和宽高</span></span><br><span class="line">    <span class="comment">#---------------------------------------#</span></span><br><span class="line">    height = boxes[:, <span class="number">2</span>] - boxes[:, <span class="number">0</span>]</span><br><span class="line">    width = boxes[:, <span class="number">3</span>] - boxes[:, <span class="number">1</span>]</span><br><span class="line">    center_y = boxes[:, <span class="number">0</span>] + <span class="number">0.5</span> * height</span><br><span class="line">    center_x = boxes[:, <span class="number">1</span>] + <span class="number">0.5</span> * width</span><br><span class="line"></span><br><span class="line">    <span class="comment">#---------------------------------------#</span></span><br><span class="line">    <span class="comment">#   计算出调整后的先验框的中心和宽高</span></span><br><span class="line">    <span class="comment">#---------------------------------------#</span></span><br><span class="line">    center_y += deltas[:, <span class="number">0</span>] * height</span><br><span class="line">    center_x += deltas[:, <span class="number">1</span>] * width</span><br><span class="line">    height *= tf.exp(deltas[:, <span class="number">2</span>])</span><br><span class="line">    width *= tf.exp(deltas[:, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">#---------------------------------------#</span></span><br><span class="line">    <span class="comment">#   计算左上角和右下角的点的坐标</span></span><br><span class="line">    <span class="comment">#---------------------------------------#</span></span><br><span class="line">    y1 = center_y - <span class="number">0.5</span> * height</span><br><span class="line">    x1 = center_x - <span class="number">0.5</span> * width</span><br><span class="line">    y2 = y1 + height</span><br><span class="line">    x2 = x1 + width</span><br><span class="line"></span><br><span class="line">    result = tf.stack([y1, x1, y2, x2], axis=<span class="number">1</span>, name=<span class="string">&quot;apply_box_deltas_out&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><h2 id="2-6-利用建议框对共享特征层进行截取"><a href="#2-6-利用建议框对共享特征层进行截取" class="headerlink" title="2.6 利用建议框对共享特征层进行截取"></a>2.6 利用建议框对共享特征层进行截取</h2><p>ROI Align层的作用就是根据建议框对不同的特征层进行截取。主要代码如下，其功能就是根据建议框的大小，判断建议框属于哪一个特征层，然后利用建议框对对应的特征层进行截取。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">#---------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   ROI Pooling，利用建议框在特征层上进行截取</span></span><br><span class="line">    <span class="comment">#   x   : [batch, num_rois, POOL_SIZE, POOL_SIZE, channels]</span></span><br><span class="line">    <span class="comment">#   pool_size 是对共享特征层截取后resize后的局部特征层的大小</span></span><br><span class="line">    <span class="comment">#   rois是初步筛选后的建议框</span></span><br><span class="line">    <span class="comment">#   image_meta是保存了图片的必要信息</span></span><br><span class="line">    <span class="comment">#   feature_maps共享特征层</span></span><br><span class="line">    <span class="comment">#---------------------------------------------------------------#</span></span><br><span class="line">    x = PyramidROIAlign([pool_size, pool_size], name=<span class="string">&quot;roi_align_classifier&quot;</span>)([rois, image_meta] + feature_maps)</span><br></pre></td></tr></table></figure><p>其中<code>PyramidROIAlign</code>函数的定义如下：</p><p>首先获取建议框的坐标、图片信息、特征层。然后根据建议框的大小，判断建议框属于哪一个特征层（较大的特征层比如256x256的，网格划分密集，每一个建议框大小比较小，以此判断）。利用循环对于P2~P5五个特征层进行截取。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#   ROIAlign Layer</span></span><br><span class="line"><span class="comment">#   利用建议框在特征层上截取内容</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyramidROIAlign</span>(<span class="title class_ inherited__">Layer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, pool_shape, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(PyramidROIAlign, self).__init__(**kwargs)</span><br><span class="line">        self.pool_shape = <span class="built_in">tuple</span>(pool_shape)</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得建议框的坐标</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        boxes = inputs[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   image_meta包含了一些必要的图片信息</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        image_meta = inputs[<span class="number">1</span>]</span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   取出所有的特征层[batch, height, width, channels]</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        feature_maps = inputs[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得建议框的宽高</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        y1, x1, y2, x2 = tf.split(boxes, <span class="number">4</span>, axis=<span class="number">2</span>)</span><br><span class="line">        h = y2 - y1</span><br><span class="line">        w = x2 - x1</span><br><span class="line">  </span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得输入进来的图像的大小，对image的内容进行分割</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        image_shape = parse_image_meta_graph(image_meta)[<span class="string">&#x27;image_shape&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   通过建议框的大小找到这个建议框属于哪个特征层，第一层256划分区域多建议框较小32</span></span><br><span class="line">        <span class="comment">#----------------------------------------------------------#</span></span><br><span class="line">        image_area = tf.cast(image_shape[<span class="number">0</span>] * image_shape[<span class="number">1</span>], tf.float32)</span><br><span class="line">        roi_level = log2_graph(tf.sqrt(h * w) / (<span class="number">224.0</span> / tf.sqrt(image_area)))</span><br><span class="line">        roi_level = tf.minimum(<span class="number">5</span>, tf.maximum(<span class="number">2</span>, <span class="number">4</span> + tf.cast(tf.<span class="built_in">round</span>(roi_level), tf.int32)))</span><br><span class="line">        <span class="comment"># roi_level是每张图片里每个建议框对应的特征层是哪个</span></span><br><span class="line">        roi_level = tf.squeeze(roi_level, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        pooled = []</span><br><span class="line">        box_to_level = []</span><br><span class="line">        <span class="comment"># 分别在P2-P5中进行截取</span></span><br><span class="line">        <span class="keyword">for</span> i, level <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">range</span>(<span class="number">2</span>, <span class="number">6</span>)):</span><br><span class="line">            <span class="comment">#-----------------------------------------------#</span></span><br><span class="line">            <span class="comment">#   找到每个特征层对应的建议框</span></span><br><span class="line">            <span class="comment">#   level_boxes存放所有属于该特征层的建议框</span></span><br><span class="line">            <span class="comment">#-----------------------------------------------#</span></span><br><span class="line">            ix = tf.where(tf.equal(roi_level, level))</span><br><span class="line">            level_boxes = tf.gather_nd(boxes, ix)</span><br><span class="line">            box_to_level.append(ix)</span><br><span class="line">  </span><br><span class="line">            <span class="comment">#-----------------------------------------------#</span></span><br><span class="line">            <span class="comment">#    获得这些建议框所属的图片</span></span><br><span class="line">            <span class="comment">#-----------------------------------------------#</span></span><br><span class="line">            box_indices = tf.cast(ix[:, <span class="number">0</span>], tf.int32)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 停止梯度下降</span></span><br><span class="line">            level_boxes = tf.stop_gradient(level_boxes)</span><br><span class="line">            box_indices = tf.stop_gradient(box_indices)</span><br><span class="line"></span><br><span class="line">            <span class="comment">#--------------------------------------------------------------------------#</span></span><br><span class="line">            <span class="comment">#   利用建议框对特征层进行截取  </span></span><br><span class="line">            <span class="comment">#   [batch * num_boxes, pool_height, pool_width, channels]</span></span><br><span class="line">            <span class="comment">#   box_indices表示是截取哪张图片里的特征层</span></span><br><span class="line">            <span class="comment">#--------------------------------------------------------------------------#</span></span><br><span class="line">            pooled.append(tf.image.crop_and_resize(</span><br><span class="line">                feature_maps[i], level_boxes, box_indices, self.pool_shape,</span><br><span class="line">                method=<span class="string">&quot;bilinear&quot;</span>))</span><br><span class="line"></span><br><span class="line">        pooled = tf.concat(pooled, axis=<span class="number">0</span>)</span><br><span class="line">        <span class="comment">#--------------------------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   将顺序和所属的图片进行堆叠</span></span><br><span class="line">        <span class="comment">#--------------------------------------------------------------------------#</span></span><br><span class="line">        box_to_level = tf.concat(box_to_level, axis=<span class="number">0</span>)</span><br><span class="line">        box_range = tf.expand_dims(tf.<span class="built_in">range</span>(tf.shape(box_to_level)[<span class="number">0</span>]), <span class="number">1</span>)</span><br><span class="line">        box_to_level = tf.concat([tf.cast(box_to_level, tf.int32), box_range], axis=<span class="number">1</span>)</span><br><span class="line">  </span><br><span class="line">        <span class="comment"># box_to_level[:, 0]表示第几张图</span></span><br><span class="line">        <span class="comment"># box_to_level[:, 1]表示第几张图里的第几个框</span></span><br><span class="line">        sorting_tensor = box_to_level[:, <span class="number">0</span>] * <span class="number">100000</span> + box_to_level[:, <span class="number">1</span>]</span><br><span class="line">        <span class="comment"># 进行排序，将同一张图里的某一些聚集在一起</span></span><br><span class="line">        ix = tf.nn.top_k(sorting_tensor, k=tf.shape(</span><br><span class="line">            box_to_level)[<span class="number">0</span>]).indices[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 按顺序获得图片的索引</span></span><br><span class="line">        ix = tf.gather(box_to_level[:, <span class="number">2</span>], ix)</span><br><span class="line">        pooled = tf.gather(pooled, ix)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#--------------------------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   重新reshape为如下</span></span><br><span class="line">        <span class="comment">#   [batch, num_rois, POOL_SIZE, POOL_SIZE, channels]</span></span><br><span class="line">        <span class="comment">#--------------------------------------------------------------------------#</span></span><br><span class="line">        shape = tf.concat([tf.shape(boxes)[:<span class="number">2</span>], tf.shape(pooled)[<span class="number">1</span>:]], axis=<span class="number">0</span>)</span><br><span class="line">        pooled = tf.reshape(pooled, shape)</span><br><span class="line">        <span class="keyword">return</span> pooled</span><br></pre></td></tr></table></figure><h2 id="2-7-局部公用特征层到预测结果"><a href="#2-7-局部公用特征层到预测结果" class="headerlink" title="2.7 局部公用特征层到预测结果"></a>2.7 局部公用特征层到预测结果</h2><p>如何利用调整后的局部特征层获得预测结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    mrcnn_class_logits, mrcnn_class, mrcnn_bbox =\</span><br><span class="line"></span><br><span class="line">        fpn_classifier_graph(rpn_rois, mrcnn_feature_maps, input_image_meta,</span><br><span class="line"></span><br><span class="line">                                config.POOL_SIZE, config.NUM_CLASSES,</span><br><span class="line"></span><br><span class="line">                                train_bn=config.TRAIN_BN,</span><br><span class="line"></span><br><span class="line">                                fc_layers_size=config.FPN_CLASSIF_FC_LAYERS_SIZE)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------------------#</span></span><br><span class="line"><span class="comment">#   建立classifier模型，该函数主要实现目标检测功能</span></span><br><span class="line"><span class="comment">#   这个模型的预测结果会调整建议框</span></span><br><span class="line"><span class="comment">#   获得最终的预测框</span></span><br><span class="line"><span class="comment">#------------------------------------#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fpn_classifier_graph</span>(<span class="params">rois, feature_maps, image_meta,</span></span><br><span class="line"><span class="params">                         pool_size, num_classes, train_bn=<span class="literal">True</span>,</span></span><br><span class="line"><span class="params">                         fc_layers_size=<span class="number">1024</span></span>):</span><br><span class="line">    <span class="comment">#---------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   ROI Pooling，利用建议框在特征层上进行截取</span></span><br><span class="line">    <span class="comment">#   x   : [batch, num_rois, POOL_SIZE, POOL_SIZE, channels]，调整后的局部特征层</span></span><br><span class="line">    <span class="comment">#   pool_size 是对共享特征层截取后resize后的局部特征层的大小</span></span><br><span class="line">    <span class="comment">#   rois是初步筛选后的建议框</span></span><br><span class="line">    <span class="comment">#   image_meta是保存了图片的必要信息</span></span><br><span class="line">    <span class="comment">#   feature_maps共享特征层</span></span><br><span class="line">    <span class="comment">#---------------------------------------------------------------#</span></span><br><span class="line">    x = PyramidROIAlign([pool_size, pool_size], name=<span class="string">&quot;roi_align_classifier&quot;</span>)([rois, image_meta] + feature_maps)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   利用卷积进行特征整合，首先进行7x7的卷积，相当于两次全连接</span></span><br><span class="line">    <span class="comment">#   x   : [batch, num_rois, 1, 1, fc_layers_size]</span></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2D(fc_layers_size, (pool_size, pool_size), padding=<span class="string">&quot;valid&quot;</span>),  name=<span class="string">&quot;mrcnn_class_conv1&quot;</span>)(x)</span><br><span class="line">    x = TimeDistributed(BatchNormalization(), name=<span class="string">&#x27;mrcnn_class_bn1&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   x   : [batch, num_rois, 1, 1, fc_layers_size]</span></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2D(fc_layers_size, (<span class="number">1</span>, <span class="number">1</span>)), name=<span class="string">&quot;mrcnn_class_conv2&quot;</span>)(x)</span><br><span class="line">    x = TimeDistributed(BatchNormalization(), name=<span class="string">&#x27;mrcnn_class_bn2&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   x   : [batch, num_rois, fc_layers_size]</span></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    shared = Lambda(<span class="keyword">lambda</span> x: K.squeeze(K.squeeze(x, <span class="number">3</span>), <span class="number">2</span>),  name=<span class="string">&quot;pool_squeeze&quot;</span>)(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   Classifier head</span></span><br><span class="line">    <span class="comment">#   这个的预测结果代表这个先验框内部的物体的种类</span></span><br><span class="line">    <span class="comment">#   mrcnn_probs   : [batch, num_rois, num_classes]，每一张图片里，每一个先验框里面，物体的种类</span></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    mrcnn_class_logits = TimeDistributed(Dense(num_classes), name=<span class="string">&#x27;mrcnn_class_logits&#x27;</span>)(shared)</span><br><span class="line">    mrcnn_probs = TimeDistributed(Activation(<span class="string">&quot;softmax&quot;</span>), name=<span class="string">&quot;mrcnn_class&quot;</span>)(mrcnn_class_logits)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   BBox head</span></span><br><span class="line">    <span class="comment">#   这个的预测结果会对先验框进行调整</span></span><br><span class="line">    <span class="comment">#   mrcnn_bbox : [batch, num_rois, num_classes, 4]</span></span><br><span class="line">    <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Dense(num_classes * <span class="number">4</span>, activation=<span class="string">&#x27;linear&#x27;</span>), name=<span class="string">&#x27;mrcnn_bbox_fc&#x27;</span>)(shared)</span><br><span class="line">    mrcnn_bbox = Reshape((-<span class="number">1</span>, num_classes, <span class="number">4</span>), name=<span class="string">&quot;mrcnn_bbox&quot;</span>)(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mrcnn_class_logits, mrcnn_probs, mrcnn_bbox</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------#</span></span><br><span class="line"><span class="comment">#   建立mask模型</span></span><br><span class="line"><span class="comment">#   这个模型会利用预测框对特征层进行ROIAlign</span></span><br><span class="line"><span class="comment">#   根据截取下来的特征层进行语义分割</span></span><br><span class="line"><span class="comment">#----------------------------------------------#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_fpn_mask_graph</span>(<span class="params">rois, feature_maps, image_meta,</span></span><br><span class="line"><span class="params">                         pool_size, num_classes, train_bn=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   ROI Pooling，利用预测框在特征层上进行截取</span></span><br><span class="line">    <span class="comment">#   x   : batch, num_rois, MASK_POOL_SIZE, MASK_POOL_SIZE, channels</span></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    x = PyramidROIAlign([pool_size, pool_size], name=<span class="string">&quot;roi_align_mask&quot;</span>)([rois, image_meta] + feature_maps)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   x   : batch, num_rois, MASK_POOL_SIZE, MASK_POOL_SIZE, 256</span></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2D(<span class="number">256</span>, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;same&quot;</span>), name=<span class="string">&quot;mrcnn_mask_conv1&quot;</span>)(x)</span><br><span class="line">    x = TimeDistributed(BatchNormalization(), name=<span class="string">&#x27;mrcnn_mask_bn1&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   x   : batch, num_rois, MASK_POOL_SIZE, MASK_POOL_SIZE, 256</span></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2D(<span class="number">256</span>, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;same&quot;</span>), name=<span class="string">&quot;mrcnn_mask_conv2&quot;</span>)(x)</span><br><span class="line">    x = TimeDistributed(BatchNormalization(), name=<span class="string">&#x27;mrcnn_mask_bn2&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   x   : batch, num_rois, MASK_POOL_SIZE, MASK_POOL_SIZE, 256</span></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2D(<span class="number">256</span>, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;same&quot;</span>), name=<span class="string">&quot;mrcnn_mask_conv3&quot;</span>)(x)</span><br><span class="line">    x = TimeDistributed(BatchNormalization(), name=<span class="string">&#x27;mrcnn_mask_bn3&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   x   : batch, num_rois, MASK_POOL_SIZE, MASK_POOL_SIZE, 256</span></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2D(<span class="number">256</span>, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&quot;same&quot;</span>), name=<span class="string">&quot;mrcnn_mask_conv4&quot;</span>)(x)</span><br><span class="line">    x = TimeDistributed(BatchNormalization(), name=<span class="string">&#x27;mrcnn_mask_bn4&#x27;</span>)(x, training=train_bn)</span><br><span class="line">    x = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   x   : batch, num_rois, 2xMASK_POOL_SIZE, 2xMASK_POOL_SIZE, 256</span></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2DTranspose(<span class="number">256</span>, (<span class="number">2</span>, <span class="number">2</span>), strides=<span class="number">2</span>, activation=<span class="string">&quot;relu&quot;</span>), name=<span class="string">&quot;mrcnn_mask_deconv&quot;</span>)(x)</span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    <span class="comment">#   反卷积后再次进行一个1x1卷积调整通道，</span></span><br><span class="line">    <span class="comment">#   使其最终数量为numclasses，代表分的类</span></span><br><span class="line">    <span class="comment">#   x   : batch, num_rois, 2xMASK_POOL_SIZE, 2xMASK_POOL_SIZE, numclasses</span></span><br><span class="line">    <span class="comment">#--------------------------------------------------------------------#</span></span><br><span class="line">    x = TimeDistributed(Conv2D(num_classes, (<span class="number">1</span>, <span class="number">1</span>), strides=<span class="number">1</span>, activation=<span class="string">&quot;sigmoid&quot;</span>), name=<span class="string">&quot;mrcnn_mask&quot;</span>)(x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h2 id="2-8-建议框调整获得预测框"><a href="#2-8-建议框调整获得预测框" class="headerlink" title="2.8 建议框调整获得预测框"></a>2.8 建议框调整获得预测框</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#------------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#   detections          : Batch_size, num_detections, 6</span></span><br><span class="line"><span class="comment">#   detection_boxes     : Batch_size, num_detections, 4</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------#</span></span><br><span class="line">detections = DetectionLayer(config, name=<span class="string">&quot;mrcnn_detection&quot;</span>)([rpn_rois, mrcnn_class, mrcnn_bbox, input_image_meta])</span><br><span class="line">detection_boxes = Lambda(<span class="keyword">lambda</span> x: x[..., :<span class="number">4</span>])(detections)</span><br></pre></td></tr></table></figure><p>我们的工作都发生在<code>DetectionLayer</code>四个参数分别是rpn_rois建议框、mrcnn_class建议内部物体的置信度、mrcnn_bbox建议框的调整参数、input_image_meta输入图片的基本信息。</p><p>其中<code>DetectionLayer</code>的定义如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"><span class="comment">#   Detection Layer</span></span><br><span class="line"><span class="comment">#   利用classifier的预测结果对建议框进行调整获得预测框</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------#</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DetectionLayer</span>(<span class="title class_ inherited__">Layer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(DetectionLayer, self).__init__(**kwargs)</span><br><span class="line">        self.config = config</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, inputs</span>):</span><br><span class="line">        <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   获得的inputs</span></span><br><span class="line">        <span class="comment">#   rpn_rois            : Batch_size, proposal_count, 4</span></span><br><span class="line">        <span class="comment">#   mrcnn_class         : Batch_size, num_rois, num_classes</span></span><br><span class="line">        <span class="comment">#   mrcnn_bbox          : Batch_size, num_rois, num_classes, </span></span><br><span class="line">        <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">        rois = inputs[<span class="number">0</span>]</span><br><span class="line">        mrcnn_class = inputs[<span class="number">1</span>]</span><br><span class="line">        mrcnn_bbox = inputs[<span class="number">2</span>]</span><br><span class="line">        image_meta = inputs[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   找到window的小数形式，指出原始的图片在调整后（加灰条）图片中的位置</span></span><br><span class="line">        <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">        m = parse_image_meta_graph(image_meta)</span><br><span class="line">        image_shape = m[<span class="string">&#x27;image_shape&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">        window = norm_boxes_graph(m[<span class="string">&#x27;window&#x27;</span>], image_shape[:<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   对每一张图的结果进行解码</span></span><br><span class="line">        <span class="comment">#------------------------------------------------------------------#</span></span><br><span class="line">        detections_batch = batch_slice(</span><br><span class="line">            [rois, mrcnn_class, mrcnn_bbox, window],</span><br><span class="line">            <span class="keyword">lambda</span> x, y, w, z: refine_detections_graph(x, y, w, z, self.config),</span><br><span class="line">            self.config.IMAGES_PER_GPU)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#------------------------------------------------------------#</span></span><br><span class="line">        <span class="comment">#   最终输出的shape为</span></span><br><span class="line">        <span class="comment">#   Batch_size, num_detections, 6] </span></span><br><span class="line">        <span class="comment">#------------------------------------------------------------#</span></span><br><span class="line">        <span class="keyword">return</span> tf.reshape(</span><br><span class="line">            detections_batch,</span><br><span class="line">            [self.config.BATCH_SIZE, self.config.DETECTION_MAX_INSTANCES, <span class="number">6</span>])</span><br></pre></td></tr></table></figure><h1 id="三、创建自己的数据集"><a href="#三、创建自己的数据集" class="headerlink" title="三、创建自己的数据集"></a>三、创建自己的数据集</h1><h2 id="3-1-安装labelme"><a href="#3-1-安装labelme" class="headerlink" title="3.1 安装labelme"></a>3.1 安装labelme</h2><p>打开cmd窗口，输入<code>activate tensorflow2</code>激活自己的anaconda环境。</p><p>然后安装labelme</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install labelme</span><br></pre></td></tr></table></figure><p>安装完成后直接在命令行输入<code>labelme</code>即可打开。</p><p>使用label进行标注</p><h2 id="3-2-开始训练"><a href="#3-2-开始训练" class="headerlink" title="3.2 开始训练"></a>3.2 开始训练</h2><p>运行<code>json_to_dataset.py</code>将标注的json图像转换为数据集。</p><p>在<code>dataset.py</code>中的<code>load_shapes</code>中添加自己的分类，同时在最后的循环中也添加自己的分类。</p><p>在<code>train.py</code>的<code>ShapesConfig</code>修改图片大小，<code>IMAGE_MIN_DIM</code>和<code>IMAGE_MAX_DIM</code>两个图片大小可以一样，<code>NUM_CLASSES</code>后面的数字是分的类</p>]]></content>
    
    
    <summary type="html">Mask R-CNN是He Kaiming大神2017年的力作，其在进行目标检测的同时进行实例分割，取得了出色的效果。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="实验" scheme="https://www.mahaofei.com/tags/%E5%AE%9E%E9%AA%8C/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>如何理解卷积神经网络中的通道channel</title>
    <link href="https://www.mahaofei.com/post/e8acb40e.html"/>
    <id>https://www.mahaofei.com/post/e8acb40e.html</id>
    <published>2022-05-16T08:28:07.000Z</published>
    <updated>2022-05-16T08:28:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是通道channel"><a href="#什么是通道channel" class="headerlink" title="什么是通道channel"></a>什么是通道channel</h2><blockquote><p><a href="https://blog.csdn.net/sscc_learning/article/details/79814146">【CNN】理解卷积神经网络中的通道 channel</a></p></blockquote><p>首先，是 <a href="https://www.tensorflow.org/tutorials/layers">tensorflow</a> 中给出的，对于输入样本中 <code>channels</code> 的含义。一般的RGB图片，<code>channels</code> 数量是 3 （红、绿、蓝）；而monochrome图片，<code>channels</code> 数量是 1 。</p><p>其次，<a href="http://mxnet.incubator.apache.org/api/python/gluon/nn.html#mxnet.gluon.nn.Conv2D">mxnet</a> 中提到的，一般 <code>channels</code> 的含义是，<strong>每个卷积层中卷积核的数量</strong>。</p><p>举例：假设现有一个为 6×6×3 的图片样本，使用 3×3×3 的卷积核（filter）进行卷积操作。此时输入图片的 channels 为 3 ，而卷积核中的 in_channels 与 需要进行卷积操作的数据的 channels 一致（这里就是图片样本，为3）。</p><p>接下来，进行卷积操作，卷积核中的27个数字与分别与样本对应相乘后，再进行求和，得到第一个结果。依次进行，最终得到 4×4 的结果。</p><p><img src="https://img.mahaofei.com/img/20220624185902.png" alt=""></p><p>上面步骤完成后，由于只有一个卷积核，所以最终得到的结果为 4×4×1 ， out_channels 为 1 。</p><p>在实际应用中，都会使用多个卷积核。这里如果再加一个卷积核，就会得到 4×4×2 的结果。</p><p><img src="https://img.mahaofei.com/img/20220624185923.png" alt=""></p><p><strong>总结</strong></p><ul><li>最初输入的图片样本的 <code>channels</code> ，取决于图片类型，比如RGB；</li><li>卷积操作完成后输出的 <code>out_channels</code> ，取决于卷积核的数量。此时的 <code>out_channels</code> 也会作为下一次卷积时的卷积核的 <code>in_channels</code>；</li><li>卷积核中的 <code>in_channels</code> ，就是上一次卷积的 <code>out_channels</code> ，如果是第一次做卷积，就是1中样本图片的 <code>channels</code> 。</li></ul>]]></content>
    
    
    <summary type="html">一般channels的含义是，每个卷积层中卷积核的数量。最初输入的图片样本的channels，取决于图片类型，比如RGB；卷积操作完成后输出的out_channels，取决于卷积核的数量。此时的out_channels也会作为下一次卷积时的卷积核的in_channels。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="笔记" scheme="https://www.mahaofei.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="基础知识" scheme="https://www.mahaofei.com/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>卷积是如何计算的</title>
    <link href="https://www.mahaofei.com/post/9c39ef87.html"/>
    <id>https://www.mahaofei.com/post/9c39ef87.html</id>
    <published>2022-05-16T08:26:41.000Z</published>
    <updated>2022-05-20T08:26:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-什么是多卷积核"><a href="#1-什么是多卷积核" class="headerlink" title="1 什么是多卷积核"></a>1 什么是多卷积核</h2><h3 id="1-1-卷积"><a href="#1-1-卷积" class="headerlink" title="1.1 卷积"></a>1.1 卷积</h3><p>从本质上讲，卷积的计算过程其实同全连接一样，也是各个神经元之间的线性组合。只是卷积操作在进行线性组合时选择的是特定位置上的神经元。下面我们首先通过一张动图来直观感受一下卷积的过程。</p><p><img src="https://pic2.zhimg.com/v2-5efbada1d4bb599e6195ce819aa7ebd9_b.webp" alt=""></p><p>如图所示，**卷积操作其实就是每次取一个特定大小的矩阵F（蓝色矩阵中的阴影部分），然后将其对输入X（图中蓝色矩阵）依次扫描并进行内积的运算过程。可以看到，阴影部分每移动一个位置就会计算得到一个卷积值（绿色矩阵中的阴影部分），当F扫描完成后就得到了整个卷积后的结果Y（绿色矩阵）。</p><p>同时，我们将这个特定大小的矩阵F称为<strong>卷积核</strong>，即convolutional kernel或kernel或filter或detector，它可以是一个也可以是多个；将卷积后的结果Y称为<strong>特征图</strong>，即feature map，并且每一个卷积核卷积后都会得到一个对应的特征图；最后，对于输入X)的形状，都会用三个维度来进行表示，即宽（width），高（high）和通道（channel）。例如图中输入X的形状为<code>[7,7,1]</code>。</p><h3 id="2-2-多卷积核"><a href="#2-2-多卷积核" class="headerlink" title="2.2 多卷积核"></a><strong>2.2 多卷积核</strong></h3><p>注意，在上面笔者提到了卷积核的个数还可以是多个，那我们为什么需要多个卷积核进行卷积呢？在<strong>上一篇文章</strong>中我们介绍到：<strong>对于一个卷积核，可以认为其具有识别某一类元素（特征）的能力</strong>；而对于一些复杂的数据来说，仅仅只是通过一类特征来进行辨识往往是不够的。因此，通常来说我们都会通过多个不同的卷积核来对输入进行特征提取得到多个特征图，然再输入到后续的网络中。</p><p><img src="https://vdn1.vzuu.com/SD/d64a45c6-ec4a-11ea-acfd-5ab503a75443.mp4?disable_local_cache=1&amp;bu=078babd7&amp;c=avc.0.0&amp;f=mp4&amp;expiration=1653035766&amp;auth_key=1653035766-0-0-efb78e5addfa03be68c1bf73f4a28bd9&amp;v=hw&amp;pu=078babd7" alt=""></p><p>对于同一个输入，通过两个不同的卷积核对其进行卷积特征提取，最后便能得到两个不同的特征图。从图右边的特征图可以发现，上面的特征图在锐利度方面明显会强于下面的特征图。当然，这也是使用多卷积核进行卷积的意义，探测到多种特征属性以有利于后续的下游任务。</p><h2 id="3-卷积的计算"><a href="#3-卷积的计算" class="headerlink" title="3 卷积的计算"></a><strong>3 卷积的计算</strong></h2><p>到此为止， 对于卷积的原理和意义就算是交待完了，并且通过这些动态图片的展示，我们也有了更为直观的了解。但所谓数无形时少直觉，形少数时难入微。因此，下面我们就以单通道（灰度图）和三通道的输入来实际计算一下整个卷积的过程。</p><h3 id="3-1-单通道单卷积核"><a href="#3-1-单通道单卷积核" class="headerlink" title="3.1 单通道单卷积核"></a><strong>3.1 单通道单卷积核</strong></h3><p>如下图所示，现在有一张形状为<code>[5,5,1]</code>的灰度图，我们需要用图3右边的卷积核对其进行卷积处理，同时再考虑到偏置的作用。那么其计算过程是怎么样的呢？</p><p><img src="https://pic3.zhimg.com/80/v2-41ea774397ab503144f2e410e3b91846_720w.jpg" alt=""></p><p>如下图所示，右边为卷积后的特征图（feature map），左边为卷积核对输入图片左上放进行卷积时的示意图。因此，对于这个部分的计算过程有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cunderbrace%7B1%5Ccdot0%2B2%5Ccdot0%2B0%5Ccdot1-1%5Ccdot0%2B1%5Ccdot1%2B0%5Ccdot1%2B2%5Ccdot1-1%5Ccdot0-2%5Ccdot1%7D_%7Bkernel%7D%5Cunderbrace%7B%5C%3B%5C%3B%2B1%5C%3B%5C%3B%7D_%7Bbias%7D%3D2%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%281%29+%5C%5C" alt=""></p><p><img src="https://pic1.zhimg.com/80/v2-f3cbc9092253d32f9faef27431094794_720w.jpg" alt=""></p><p>同理，对于最右下角部分卷积计算过程有：</p><p><img src="https://www.zhihu.com/equation?tex=2%5Ccdot0%2B1%5Ccdot0%2B0%5Ccdot1%2B0%5Ccdot0%2B0%5Ccdot1%2B0%5Ccdot1-1%5Ccdot1%2B0%5Ccdot0-0%5Ccdot1%2B1%3D0%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%282%29+%5C%5C" alt=""></p><p><img src="https://pic4.zhimg.com/80/v2-34b0159c662de8c287e47afa4e05351b_720w.jpg" alt=""></p><p>因此，对于最后卷积的结果，我们得到的将是一个如上图右边所示形状为<code>[3,3,1]</code>的特征图。到此我们就把单通道单卷积的计算过程介绍完了。下面我们再来看单通道多卷积核的例子。</p><h3 id="3-2-单通道多卷积核"><a href="#3-2-单通道多卷积核" class="headerlink" title="3.2 单通道多卷积核"></a><strong>3.2 单通道多卷积核</strong></h3><p>如下图所示，左边依旧为输入矩阵，我们现在要用右边所示的两个卷积核对其进行卷积处理。</p><p><img src="https://pic1.zhimg.com/80/v2-28512602aa1cc0d5cbbd3728f1b71bd0_720w.jpg" alt=""></p><p>以右侧的卷积核为例，其计算过程如下图所示：</p><p><img src="https://pic1.zhimg.com/80/v2-8d78e0ca38adc64c36aa4a8bb4c605b0_720w.jpg" alt=""></p><p>最后我们便能得到如下右边所示的，形状为<code>[3,3,2]</code>的卷积特征图，其中2表示两个特征通道。</p><p><img src="https://pic2.zhimg.com/80/v2-867e4addafd9d5146d7be731cd94a8d5_720w.jpg" alt=""></p><p>到此，对于单通道的卷积计算过程就介绍完了。但通常情况下，我们遇到得更多的就是对多通道的输入进行卷积处理，例如包含有RGB三个通道的彩色图片等。接下来，笔者就开始介绍多通道的卷积计算过程。</p><h3 id="3-3-多通道单卷积核"><a href="#3-3-多通道单卷积核" class="headerlink" title="3.3 多通道单卷积核"></a><strong>3.3 多通道单卷积核</strong></h3><p>对于多通道的卷积过程，总体上还是还是同之前的一样，都是每次选取特定位置上的神经元进行卷积，然后依次移动直到卷积结束。下面我们先来看看多通道单卷积核的计算过程。</p><p><img src="https://pic3.zhimg.com/80/v2-74b6e3cb4f6f1714e05325c068ece3e6_720w.jpg" alt=""></p><p>如图所示，左边为包含有三个通道的输入，右边为一个卷积核和一个偏置。<strong>注意，强调一下右边的仅仅只是一个卷积核，不是三个</strong>。笔者看到不少人在这个地方都会搞错。因为输入是三个通道，所以在进行卷积的时候，对应的每一个卷积核都必须要有三个通道才能进行卷积。下面我们就来看看具体的计算过程。</p><p><img src="https://pic1.zhimg.com/80/v2-b9b793a795f06aa1830a784ad82ccf14_720w.jpg" alt=""></p><p>如图所示，右边为卷积后的特征图（feature map），左边为一个三通道的卷积核对输入图片左上放进行卷积时的示意图。因此，对于这个部分的计算过程有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Baligned%7D+%26%5Cunderbrace%7B%280%5Ccdot2%2B2%5Ccdot0%2B0%5Ccdot0%2B0%5Ccdot1%2B2%5Ccdot0%2B0%5Ccdot1%2B2%5Ccdot0%2B1%5Ccdot3%2B2%5Ccdot0%29%7D_%7Bchannel+%5C%3B1%7D%5C%5C+%2B%26+%5Cunderbrace%7B%280%5Ccdot1%2B0%5Ccdot0%2B0%5Ccdot1%2B1%5Ccdot0%2B0%5Ccdot0%2B0%5Ccdot0%2B1%5Ccdot1%2B0%5Ccdot1%2B0%5Ccdot1%29%7D_%7Bchannel%5C%3B2%7D%5C%5C+%2B%26+%5Cunderbrace%7B%281%5Ccdot0%2B1%5Ccdot0%2B0%5Ccdot1%2B0%5Ccdot1%2B1%5Ccdot1%2B0%5Ccdot1%2B0%5Ccdot1%2B1%5Ccdot1%2B1%5Ccdot0%29%7D_%7Bchannel+3%7D%5C%5C+%2B%26%5Cunderbrace%7B%5C%3B%5C%3B1%5C%3B%5C%3B%7D_%7B%5C%3B%5C%3Bbias%5C%3B%5C%3B%7D%5C%5C+%3D%263%2B1%2B2%2B1%3D7+%5Cend%7Baligned%7D%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%5C%3B%283%29+%5C%5C" alt=""></p><p>同理，对于其它部分的卷积计算过程也类似于上述计算步骤。由此我们便能得到如图10右边所示卷积后的形状为<code>[3,3,1]</code>的特征图。</p><h3 id="3-4-多通道多卷积核"><a href="#3-4-多通道多卷积核" class="headerlink" title="3.4 多通道多卷积核"></a><strong>3.4 多通道多卷积核</strong></h3><p>在介绍完多通道单卷积核的计算过程后，我们再来看看多通道多卷积核的计算过程。</p><p><img src="https://pic2.zhimg.com/80/v2-a49ca8fccf9423b68350a2948c58df69_720w.jpg" alt=""></p><p>如图所示，左边依旧为输入矩阵，我们现在要用右边所示的<strong>两个卷积核</strong>对其进行卷积处理。对于第二个卷积核，其计算过程也和式子(3)类似，都是将每个通道上的卷积结果进行相加，最后再加上偏置。因此，最后我们便能得到如图12右边所示的，形状为<code>[3,3,2]</code>的卷积特征图，其中2表示两个特征通道。</p><p><img src="https://pic2.zhimg.com/80/v2-1ba1b27de724a353656802d32d41c891_720w.jpg" alt=""></p><p>同时，从上面单通道卷积核多通道卷积的计算过程可以发现：</p><p>（1）原始输入有多少个通道，其对应的<strong>一个卷积核</strong>就必须要有多少个通道，这样才能与输入进行匹配，也才能完成卷积操作。换句话说，如果输入数据的形状为<code>[n,n,c]</code>，那么对应每个卷积核的通道数也必须为<code>c</code>。</p><p>（2）用<code>k</code>个卷积核对输入进行卷积处理，那么最后得到的特征图一定就会包含有<code>k</code>个通道。例如，输入为<code>[n,n,c]</code>，且用<code>k</code>个卷积核对其进行卷积，则卷积核的形状必定为<code>[w1,w2,c,k]</code>，最终得到的特征图形状必定为<code>[h1,h2,k]</code>；其中<code>w1,w2</code>为卷积核的宽度，<code>h1,h2</code>为卷积后特征图的宽度。</p>]]></content>
    
    
    <summary type="html">卷积操作其实就是每次取一个特定大小的矩阵，然后将其对输入矩阵依次扫描并进行内积的运算过程。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="笔记" scheme="https://www.mahaofei.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="基础知识" scheme="https://www.mahaofei.com/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>深度学习环境配置CUDA+TensorFlow2+Keras</title>
    <link href="https://www.mahaofei.com/post/a858b698.html"/>
    <id>https://www.mahaofei.com/post/a858b698.html</id>
    <published>2022-05-16T03:03:16.000Z</published>
    <updated>2022-05-20T03:03:16.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h1><p>Anaconda是管理各个python包的工具，这里我们主要使用的是numpy，以及其他的一些常用包。</p><p>Anaconda官网链接：<a href="https://www.anaconda.com/">https://www.anaconda.com/</a></p><p>各个系统版本的Anaconda安装程序都可以直接下载安装即可，相关使用方法可以参考==该文章==</p><h1 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h1><ol><li>首先<strong>查看自己电脑GPU对应的cuda版本</strong>，如图所示<strong>打开 NVIDIA控制面板-&gt;帮助-&gt;系统信息-&gt;组件</strong>（可在控制中心或右下角通知栏打开），我这里GPU对应的cuda版本是11.6.106，所以安装的cuda不能超过这个版本。</li></ol><p><img src="https://img.mahaofei.com/img/20220515111335.png" alt=""></p><ol><li><strong>进入<a href="https://developer.nvidia.com/cuda-toolkit-archive">CUDA Toolkit Archive</a>网站</strong>选择低于刚才查到的版本的cudatoolkit，本文选择CUDA Toolkit 11.0 Update 3，<strong>下载安装包</strong>约2.7G。</li></ol><blockquote><p>注意：这里选择的cuda版本会决定后面安装cudnn和tensorflow-gpu的版本，三者是相关的，如果版本不匹配将无法使用，具体匹配版本参考<a href="https://tensorflow.google.cn/install/source_windows">https://tensorflow.google.cn/install/source_windows</a>，下表为节选。</p></blockquote><div class="table-container"><table><thead><tr><th style="text-align:left">版本</th><th style="text-align:left">Python 版本</th><th style="text-align:left">编译器</th><th style="text-align:left">构建工具</th><th style="text-align:left">cuDNN</th><th style="text-align:left">CUDA</th></tr></thead><tbody><tr><td style="text-align:left">tensorflow_gpu-2.6.0</td><td style="text-align:left">3.6-3.9</td><td style="text-align:left">MSVC 2019</td><td style="text-align:left">Bazel 3.7.2</td><td style="text-align:left">8.1</td><td style="text-align:left">11.2</td></tr><tr><td style="text-align:left">tensorflow_gpu-2.5.0</td><td style="text-align:left">3.6-3.9</td><td style="text-align:left">MSVC 2019</td><td style="text-align:left">Bazel 3.7.2</td><td style="text-align:left">8.1</td><td style="text-align:left">11.2</td></tr><tr><td style="text-align:left">tensorflow_gpu-2.4.0</td><td style="text-align:left">3.6-3.8</td><td style="text-align:left">MSVC 2019</td><td style="text-align:left">Bazel 3.1.0</td><td style="text-align:left">8.0</td><td style="text-align:left">11.0</td></tr><tr><td style="text-align:left">tensorflow_gpu-2.3.0</td><td style="text-align:left">3.5-3.8</td><td style="text-align:left">MSVC 2019</td><td style="text-align:left">Bazel 3.1.0</td><td style="text-align:left">7.6</td><td style="text-align:left">10.1</td></tr><tr><td style="text-align:left">tensorflow_gpu-2.2.0</td><td style="text-align:left">3.5-3.8</td><td style="text-align:left">MSVC 2019</td><td style="text-align:left">Bazel 2.0.0</td><td style="text-align:left">7.6</td><td style="text-align:left">10.1</td></tr><tr><td style="text-align:left">tensorflow_gpu-2.1.0</td><td style="text-align:left">3.5-3.7</td><td style="text-align:left">MSVC 2019</td><td style="text-align:left">Bazel 0.27.1-0.29.1</td><td style="text-align:left">7.6</td><td style="text-align:left">10.1</td></tr><tr><td style="text-align:left">tensorflow_gpu-2.0.0</td><td style="text-align:left">3.5-3.7</td><td style="text-align:left">MSVC 2017</td><td style="text-align:left">Bazel 0.26.1</td><td style="text-align:left">7.4</td><td style="text-align:left">10</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.15.0</td><td style="text-align:left">3.5-3.7</td><td style="text-align:left">MSVC 2017</td><td style="text-align:left">Bazel 0.26.1</td><td style="text-align:left">7.4</td><td style="text-align:left">10</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.14.0</td><td style="text-align:left">3.5-3.7</td><td style="text-align:left">MSVC 2017</td><td style="text-align:left">Bazel 0.24.1-0.25.2</td><td style="text-align:left">7.4</td><td style="text-align:left">10</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.13.0</td><td style="text-align:left">3.5-3.7</td><td style="text-align:left">MSVC 2015 update 3</td><td style="text-align:left">Bazel 0.19.0-0.21.0</td><td style="text-align:left">7.4</td><td style="text-align:left">10</td></tr></tbody></table></div><p><img src="https://img.mahaofei.com/img/20220515141105.png" alt=""></p><ol><li>双击下载的<strong>exe安装包</strong>，选择<strong>临时解压</strong>位置，然后点击ok，解压时间两分钟左右。</li></ol><p><img src="https://img.mahaofei.com/img/20220515140740.png" alt=""></p><ol><li><strong>同意许可协议</strong>，然后选择<strong>自定义安装</strong>选项，然后点击<strong>下一步</strong></li></ol><p><img src="https://img.mahaofei.com/img/20220515141240.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220515141310.png" alt=""></p><ol><li>选择驱动程序组件，一定要<strong>勾选CUDA</strong>，然后点击<strong>下一步</strong>。</li></ol><p><img src="https://img.mahaofei.com/img/20220515141348.png" alt=""></p><ol><li>选择自己电脑上的一个安装位置，然后<strong>开始安装</strong>。</li></ol><p><img src="https://img.mahaofei.com/img/20220515141701.png" alt=""></p><ol><li><p><strong>等待安装结束</strong>，本电脑18年笔记本机械硬盘安装<strong>耗时约5分钟</strong></p></li><li><p><strong>检查环境变量</strong>，一般安装完成后会自动配置好环境变量，打开<strong>设置-系统-系统信息-高级系统设置-环境变量</strong>进行检查，如果没有则需要自行添加（注意添加时修改成自己的安装路径）</p></li></ol><ul><li>系统变量中是否有<strong>CUDA</strong>和<strong>NVCUDASAMPLES</strong>两组环境变量。</li></ul><p><img src="https://img.mahaofei.com/img/20220515142616.png" alt=""></p><ul><li>打开系统变量的Path，查看是否有以下环境变量。</li></ul><p><img src="https://img.mahaofei.com/img/20220515142701.png" alt=""></p><ol><li>CUDA安装完成</li></ol><h1 id="cnDNN"><a href="#cnDNN" class="headerlink" title="cnDNN"></a>cnDNN</h1><ol><li>打开<a href="https://developer.nvidia.com/rdp/cudnn-archive">cudnn官网</a>，根据上面的表格查看自己应该下载的cuDNN版本，我的CUDA版本为11.0，对应cuDNN版本为8.0，注意看清cuDNN后面有对应的CUDA版本，一个cuDNN可能对应多个版本的CUDA，下载时会要求先注册NVIDIA账号。</li></ol><p><img src="https://img.mahaofei.com/img/20220515140956.png" alt=""></p><ol><li>解压文件，将解压后的文件移动到CUDA对应的安装目录中</li></ol><p><img src="https://img.mahaofei.com/img/20220515143854.png" alt=""></p><ol><li>cuDNN安装完成</li></ol><h1 id="安装TensorFlow"><a href="#安装TensorFlow" class="headerlink" title="安装TensorFlow"></a>安装TensorFlow</h1><ol><li>打开cmd命令行界面（建议以管理员身份打开），切换opentuna的pip镜像源</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip config set global.index-url https://opentuna.cn/pypi/web/simple</span><br></pre></td></tr></table></figure><ol><li>创建虚拟环境，后面跟的是电脑安装的python版本，注意是否与</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n tensorflow2 python=3.8</span><br></pre></td></tr></table></figure><ol><li>激活虚拟环境</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate tensorflow2</span><br></pre></td></tr></table></figure><ol><li>安装tensorflow，具体版本号根据上面的表格对应。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install tensorflow-gpu==2.3.0</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220515145711.png" alt=""></p><ol><li>验证安装是否成功，打开cmd界面，输入以下命令，查看输出是否Successfly</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">tf.config.list_physical_devices(<span class="string">&#x27;GPU&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220515154240.png" alt=""></p><p>如果出现<code>Could not load dynamic library &#39;cudart64_110.dll&#39;</code>不要慌，说明安装完成之后没有重启电脑，重启再运行就好了。</p><h1 id="Keras"><a href="#Keras" class="headerlink" title="Keras"></a>Keras</h1><ol><li>TensorFlow与Keras版本对应参考下表</li></ol><div class="table-container"><table><thead><tr><th>Tensorflow</th><th>Keras</th></tr></thead><tbody><tr><td>TensorFlow 2.0.0</td><td>Keras 2.3.1</td></tr><tr><td>TensorFlow 2.1.0</td><td>Keras 2.3.1</td></tr><tr><td>TensorFlow 2.2.0</td><td>Keras 2.3.1</td></tr><tr><td>TensorFlow 2.4.0</td><td>Keras 2.4.3</td></tr><tr><td>TensorFlow 2.6.0</td><td>Keras 2.6.0</td></tr></tbody></table></div><ol><li>运行仍然在Anaconda的<strong>tensorflow2环境中运行下面的指令</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install keras==2.4.3</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220515151729.png" alt=""></p>]]></content>
    
    
    <summary type="html">Anaconda + CUDA + TensorFlow2 + Keras的深度学习环境搭建过程。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="深度学习" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="深度学习" scheme="https://www.mahaofei.com/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="环境搭建" scheme="https://www.mahaofei.com/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>Latex基本语法</title>
    <link href="https://www.mahaofei.com/post/15b7fde1.html"/>
    <id>https://www.mahaofei.com/post/15b7fde1.html</id>
    <published>2022-04-26T07:27:12.000Z</published>
    <updated>2022-04-26T07:27:12.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-公式插入"><a href="#1-公式插入" class="headerlink" title="1. 公式插入"></a>1. 公式插入</h1><h2 id="行内公式"><a href="#行内公式" class="headerlink" title="行内公式"></a>行内公式</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span>f(x)=x<span class="built_in">$</span></span><br></pre></td></tr></table></figure><h2 id="行间公式"><a href="#行间公式" class="headerlink" title="行间公式"></a>行间公式</h2><p>$f(x)=x$</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span>f(x)=x<span class="built_in">$</span></span><br></pre></td></tr></table></figure><script type="math/tex; mode=display">f(x)=x</script><h1 id="2-数学运算符号"><a href="#2-数学运算符号" class="headerlink" title="2. 数学运算符号"></a>2. 数学运算符号</h1><h2 id="乘法除法"><a href="#乘法除法" class="headerlink" title="乘法除法"></a>乘法除法</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span>a <span class="keyword">\times</span> b<span class="built_in">$</span></span><br><span class="line"><span class="built_in">$</span>a <span class="keyword">\div</span> b<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$a \times b$<br>$a \div b$</p><h2 id="除法分式"><a href="#除法分式" class="headerlink" title="除法分式"></a>除法分式</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\frac</span>&#123;a&#125;&#123;b&#125;<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$\frac{a}{b}$</p><h2 id="根号开方"><a href="#根号开方" class="headerlink" title="根号开方"></a>根号开方</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\sqrt</span>&#123;&#125;<span class="built_in">$</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\sqrt</span>[m]&#123;n&#125;<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$\sqrt{3}$<br>$\sqrt[m]{n}$</p><h2 id="求导导数偏导"><a href="#求导导数偏导" class="headerlink" title="求导导数偏导"></a>求导导数偏导</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\frac</span>&#123;<span class="keyword">\mathrm</span>&#123;d&#125;y&#125;&#123;<span class="keyword">\mathrm</span>&#123;d&#125;x&#125;<span class="built_in">$</span> <span class="comment">%求导</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\frac</span>&#123;<span class="keyword">\partial</span> f&#125;&#123;<span class="keyword">\partial</span> x&#125;<span class="built_in">$</span>   <span class="comment">%偏导</span></span><br><span class="line"><span class="built_in">$</span>f<span class="built_in">^</span>&#123;&#x27;&#125;(x)<span class="built_in">$</span>     <span class="comment">%求导撇</span></span><br><span class="line"><span class="built_in">$</span>f<span class="built_in">^</span>&#123;&#x27;&#x27;&#125;(x)<span class="built_in">$</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\dot</span>&#123;y&#125;<span class="built_in">$</span>      <span class="comment">%求导点</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\ddot</span>&#123;y&#125;<span class="built_in">$</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\dddot</span>&#123;y&#125;<span class="built_in">$</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\nabla</span>&#123;f&#125;<span class="built_in">$</span>    <span class="comment">%全微分</span></span><br></pre></td></tr></table></figure><p>$\frac{\mathrm{d}y}{\mathrm{d}x}$</p><p>$\frac{\partial f}{\partial x}$</p><p>$f^{‘}(x)$<br>$f^{‘’}(x)$</p><p>$\dot{y}$<br>$\ddot{y}$<br>$\dddot{y}$</p><p>$\nabla{f}$</p><h2 id="绝对值"><a href="#绝对值" class="headerlink" title="绝对值"></a>绝对值</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span>|x<span class="built_in">_</span>n|<span class="built_in">$</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\lvert</span> x<span class="built_in">_</span>n<span class="keyword">\rvert</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$|x_n|$<br>$\lvert x_n\rvert$</p><h2 id="累计求和"><a href="#累计求和" class="headerlink" title="累计求和"></a>累计求和</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\sum</span><span class="built_in">_</span>&#123;i=1&#125;<span class="built_in">^</span>&#123;n&#125;<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$\sum_{i=1}^{n}$</p><h2 id="累计求积"><a href="#累计求积" class="headerlink" title="累计求积"></a>累计求积</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\prod</span><span class="built_in">_</span>&#123;i=1&#125;<span class="built_in">^</span>&#123;n&#125;<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$\prod_{i=1}^{n}$</p><h2 id="积分"><a href="#积分" class="headerlink" title="积分"></a>积分</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\int</span><span class="built_in">_</span>&#123;i=1&#125;<span class="built_in">^</span>&#123;n&#125;<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$\int_{i=1}^{n}$</p><h1 id="3-字母附加符号"><a href="#3-字母附加符号" class="headerlink" title="3. 字母附加符号"></a>3. 字母附加符号</h1><h2 id="上下标"><a href="#上下标" class="headerlink" title="上下标"></a>上下标</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">^</span>&#123;&#125; <span class="comment">%上标$x^&#123;2&#125;$</span></span><br><span class="line"><span class="built_in">_</span>&#123;&#125; <span class="comment">%下标$x_&#123;1&#125;$</span></span><br></pre></td></tr></table></figure><p>$x^{2}$<br>$x_{1}$</p><h2 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\vec</span>&#123;a&#125;<span class="built_in">$</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\overrightarrow</span>&#123;AB&#125;<span class="built_in">$</span></span><br></pre></td></tr></table></figure><p>$\vec{a}$<br>$\overrightarrow{AB}$</p><h2 id="省略号"><a href="#省略号" class="headerlink" title="省略号"></a>省略号</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\cdots</span><span class="built_in">$</span>   <span class="comment">%省略号...$1,2,3,\cdots,n$</span></span><br></pre></td></tr></table></figure><p>$1,2,3,\cdots,n$</p><h2 id="大括号"><a href="#大括号" class="headerlink" title="大括号"></a>大括号</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\underbrace</span>&#123;n&#125;<span class="built_in">_</span>&#123;m&#125;<span class="built_in">$</span> <span class="comment">% 大括号 \underbrace&#123;1,2,3,\cdots,n&#125;_&#123;m&#125;</span></span><br></pre></td></tr></table></figure><p>$\underbrace{1,2,3,\cdots,n}_{m}$</p><h2 id="横线"><a href="#横线" class="headerlink" title="横线"></a>横线</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\overline</span>&#123;m+n&#125;<span class="built_in">$</span> <span class="comment">%m+n公式上面加上横杠 </span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\underline</span>&#123;m+n&#125;<span class="built_in">$</span><span class="comment">%m+n公式下面加上横杠</span></span><br></pre></td></tr></table></figure><p>$\overline{m+n}$</p><p>$\underline{m+n}$</p><h1 id="4-特殊字母"><a href="#4-特殊字母" class="headerlink" title="4. 特殊字母"></a>4. 特殊字母</h1><h2 id="希腊字母表"><a href="#希腊字母表" class="headerlink" title="希腊字母表"></a>希腊字母表</h2><div class="table-container"><table><thead><tr><th>小写希腊字母</th><th>代码</th><th>大写希腊字母</th><th>代码</th></tr></thead><tbody><tr><td>$\alpha$</td><td>\alpha</td><td></td><td></td></tr><tr><td>$\beta$</td><td>\beta</td><td></td><td></td></tr><tr><td>$\gamma$</td><td>\gamma</td><td>$\Gamma$</td><td>\Gamma</td></tr><tr><td>$\delta$</td><td>\delta</td><td>$\Delta$</td><td>\Delta</td></tr><tr><td>$\epsilon$</td><td>\epsilon</td><td></td><td></td></tr><tr><td>$\varepsilon$</td><td>\varepsilon</td><td></td><td></td></tr><tr><td>$\zeta$</td><td>\zeta</td><td></td><td></td></tr><tr><td>$\eta$</td><td>\eta</td><td></td><td></td></tr><tr><td>$\theta$</td><td>\theta</td><td>$\Theta$</td><td>\Theta</td></tr><tr><td>$\vartheta$</td><td>\vartheta</td><td></td><td></td></tr><tr><td>$\iota$</td><td>\iota</td><td></td><td></td></tr><tr><td>$\kappa$</td><td>\kappa</td><td></td><td></td></tr><tr><td>$\lambda$</td><td>\lambda</td><td>$\Lambda$</td><td>\Lambda</td></tr><tr><td>$\mu$</td><td>\mu</td><td></td><td></td></tr><tr><td>$\nu$</td><td>\nu</td><td></td><td></td></tr><tr><td>$\xi$</td><td>\xi</td><td>$\Xi$</td><td>\Xi</td></tr><tr><td>$\pi$</td><td>\pi</td><td>$\Pi$</td><td>\Pi</td></tr><tr><td>$\varpi$</td><td>\varpi</td><td></td><td></td></tr><tr><td>$\rho$</td><td>\rho</td><td></td><td></td></tr><tr><td>$\varrho$</td><td>\varrho</td><td></td><td></td></tr><tr><td>$\sigma$</td><td>\sigma</td><td>$\Sigma$</td><td>\Sigma</td></tr><tr><td>$\varsigma$</td><td>\varsigma</td><td></td><td></td></tr><tr><td>$\tau$</td><td>\tau</td><td></td><td></td></tr><tr><td>$\upsilon$</td><td>\upsilon</td><td></td><td></td></tr><tr><td>$\phi$</td><td>\phi</td><td>$\Phi$</td><td>\Phi</td></tr><tr><td>$\varphi$</td><td>\varphi</td><td></td><td></td></tr><tr><td>$\chi$</td><td>\chi</td><td></td><td></td></tr><tr><td>$\psi$</td><td>\psi</td><td>$\Psi$</td><td>\Psi</td></tr><tr><td>$\omega$</td><td>\omega</td><td>$\Omega$</td><td>\Omega</td></tr></tbody></table></div><h2 id="常用关系符"><a href="#常用关系符" class="headerlink" title="常用关系符"></a>常用关系符</h2><p>关系符都可以前加<code>\not</code>表示否定形式</p><div class="table-container"><table><thead><tr><th>符号</th><th>代码</th></tr></thead><tbody><tr><td>$\neq$</td><td>\neq or \not=</td></tr><tr><td>$\leq$</td><td>\leq or \le</td></tr><tr><td>$\geq$</td><td>\geq or \ge</td></tr><tr><td>$\ll$</td><td>\ll</td></tr><tr><td>$\gg$</td><td>\gg</td></tr><tr><td>$\subset$</td><td>\subset</td></tr><tr><td>$\supset$</td><td>\supset</td></tr><tr><td>$\subseteq$</td><td>\subseteq</td></tr><tr><td>$\supseteq$</td><td>\supseteq</td></tr><tr><td>$\in$</td><td>\in</td></tr><tr><td>$\ni$</td><td>\ni</td></tr><tr><td>$\bigcup$</td><td>\bigcup</td></tr><tr><td>$\bigcap$</td><td>\bigcap</td></tr><tr><td>$\propto$</td><td>\propto</td></tr><tr><td>$\infty$</td><td>\infty</td></tr></tbody></table></div><h2 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h2><div class="table-container"><table><thead><tr><th>符号</th><th>代码</th></tr></thead><tbody><tr><td>$\leftarrow$</td><td>\leftarrow</td></tr><tr><td>$\Leftarrow$</td><td>\Leftarrow</td></tr><tr><td>$\rightarrow$</td><td>\rightarrow</td></tr><tr><td>$\Rightarrow$</td><td>\Rightarrow</td></tr><tr><td>$\leftrightarrow$</td><td>\leftrightarrow</td></tr><tr><td>$\Leftrightarrow$</td><td>\Leftrightarrow</td></tr><tr><td>$\leftharpoonup$</td><td>\leftharpoonup</td></tr><tr><td>$\leftharpoondown$</td><td>\leftharpoondown</td></tr><tr><td>$\rightharpoondown$</td><td>\rightharpoonup</td></tr><tr><td>$\rightharpoondown$</td><td>\rightharpoondown</td></tr><tr><td>$\leftrightharpoons$</td><td>\leftrightharpoons</td></tr></tbody></table></div><h2 id="特殊字体"><a href="#特殊字体" class="headerlink" title="特殊字体"></a>特殊字体</h2><div class="table-container"><table><thead><tr><th>字体样式</th><th>代码</th></tr></thead><tbody><tr><td>$\mathrm{ABCdef}$</td><td>\mathrm{ABCdef}</td></tr><tr><td>$\mathit{ABCdef}$</td><td>\mathit{ABCdef}</td></tr><tr><td>$\mathnormal{ABCdef}$</td><td>\mathnormal{ABCdef}</td></tr><tr><td>$\mathcal{ABC}$</td><td>\mathcal{ABC}</td></tr><tr><td>$\mathscr{ABC}$</td><td>\mathscr{ABC}</td></tr><tr><td>$\mathfrak{ABCdef}$</td><td>\mathfrak{ABCdef}</td></tr><tr><td>$\mathbb{ABC}$</td><td>\mathbb{ABC}</td></tr></tbody></table></div><h1 id="5-文字样式"><a href="#5-文字样式" class="headerlink" title="5. 文字样式"></a>5. 文字样式</h1><h2 id="文字颜色"><a href="#文字颜色" class="headerlink" title="文字颜色"></a>文字颜色</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\color</span>&#123;blue&#125;&#123;文字&#125;<span class="built_in">$</span>             <span class="comment">%文字颜色</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\color</span>[rgb]&#123;0.9,0.1,0.2&#125;&#123;文字&#125;<span class="built_in">$</span><span class="comment">%rgb三个参数取值[0,1]</span></span><br></pre></td></tr></table></figure><p>$\color{blue}{文字}$<br>$\color[rgb]{0.9,0.1,0.2}{文字}$</p><h2 id="文字高亮"><a href="#文字高亮" class="headerlink" title="文字高亮"></a>文字高亮</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="keyword">\colorbox</span>&#123;green&#125;&#123;文字&#125;<span class="built_in">$</span>              <span class="comment">%文字颜色</span></span><br><span class="line"><span class="built_in">$</span><span class="keyword">\colorbox</span>&#123;yellow&#125;&#123;<span class="keyword">\color</span>&#123;red&#125;&#123;文字&#125;&#125;<span class="built_in">$</span><span class="comment">%复合用法</span></span><br></pre></td></tr></table></figure><p>$\colorbox{green}{文字}$<br>$\colorbox{yellow}{\color{red}{文字}}$</p>]]></content>
    
    
    <summary type="html">由于在博客撰写中用到了许多公式的输入，每次遇到不会的Latex语法都要现查，很费劲，因此在这里总结一下。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="网站" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E7%BD%91%E7%AB%99/"/>
    
    
    <category term="Latex" scheme="https://www.mahaofei.com/tags/Latex/"/>
    
  </entry>
  
  <entry>
    <title>数据处理Numpy的基本使用方法</title>
    <link href="https://www.mahaofei.com/post/55ccd68.html"/>
    <id>https://www.mahaofei.com/post/55ccd68.html</id>
    <published>2022-04-24T01:47:13.000Z</published>
    <updated>2022-04-24T01:47:13.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Numpy的安装</strong></p><p>建议使用Anaconda管理这些包，Anaconda的具体教程参考上一篇笔记【Anaconda的基本使用与在Pycharm中调用】</p><p>安装好Anaconda后可以在Anaconda Prompt使用<code>activate 环境名</code>进入自己创建的环境。</p><p>使用下面指令安装Numpy和Pandas</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda install numpy</span><br><span class="line">conda install pandas</span><br></pre></td></tr></table></figure><p><strong>导入numpy</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><h1 id="1-数组创建"><a href="#1-数组创建" class="headerlink" title="1. 数组创建"></a>1. 数组创建</h1><h2 id="（1）从已有数据创建数组"><a href="#（1）从已有数据创建数组" class="headerlink" title="（1）从已有数据创建数组"></a>（1）从已有数据创建数组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">numpy.array(<span class="built_in">object</span>, dtype = <span class="literal">None</span>, copy = <span class="literal">True</span>, order = <span class="literal">None</span>, subok = <span class="literal">False</span>, ndmin = <span class="number">0</span>)</span><br><span class="line"><span class="comment"># object  数组或嵌套的数列</span></span><br><span class="line"><span class="comment"># dtype   数组元素的数据类型，可选</span></span><br><span class="line"><span class="comment"># copy    对象是否需要复制，可选</span></span><br><span class="line"><span class="comment"># order   创建数组的样式，C为行方向，F为列方向，A为任意方向（默认）</span></span><br><span class="line"><span class="comment"># subok   默认返回一个与基类类型一致的数组</span></span><br><span class="line"><span class="comment"># ndmin   指定生成数组的最小维度</span></span><br></pre></td></tr></table></figure><blockquote><p>例如：<br>a = np.array([[1, 2], [3, 4]])<br>print (a)<br>[ [1  2]<br>  [3  4] ]</p><p> a = np.array([1, 2, 3, 4, 5], ndmin = 2)<br> print (a)<br> [ [1 2 3 4 5] ]</p></blockquote><h2 id="（2）从数值范围创建数组"><a href="#（2）从数值范围创建数组" class="headerlink" title="（2）从数值范围创建数组"></a>（2）从数值范围创建数组</h2><p>numpy.arange：使用 arange 函数创建数值范围并返回 ndarray 对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numpy.arange(start, stop, step, dtype)</span><br></pre></td></tr></table></figure><p>numpy.linspace 函数用于创建一个一维数组，数组是一个等差数列构成的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">np.linspace(start, stop, num=<span class="number">50</span>, endpoint=<span class="literal">True</span>, retstep=<span class="literal">False</span>, dtype=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># num       要生成的等步长的样本数量，默认为50</span></span><br><span class="line"><span class="comment"># endpoint  该值为True时，数列中包含stop值，反之不包含，默认是True。</span></span><br><span class="line"><span class="comment"># retstep   如果为True时，生成的数组中会显示间距，反之不显示，默认是False</span></span><br></pre></td></tr></table></figure><p>numpy.logspace 函数用于创建一个于等比数列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.logspace(start, stop, num=<span class="number">50</span>, endpoint=<span class="literal">True</span>, base=<span class="number">10.0</span>, dtype=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># base  对数 log 的底数</span></span><br></pre></td></tr></table></figure><h2 id="（3）创建全0数组"><a href="#（3）创建全0数组" class="headerlink" title="（3）创建全0数组"></a>（3）创建全0数组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numpy.zeros(shape, dtype = <span class="built_in">float</span>, order = <span class="string">&#x27;C&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="（4）创建全1数组"><a href="#（4）创建全1数组" class="headerlink" title="（4）创建全1数组"></a>（4）创建全1数组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numpy.ones(shape, dtype = <span class="literal">None</span>, order = <span class="string">&#x27;C&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="（5）创建指定形状、指定数据类型、但未初始化的数组"><a href="#（5）创建指定形状、指定数据类型、但未初始化的数组" class="headerlink" title="（5）创建指定形状、指定数据类型、但未初始化的数组"></a>（5）创建指定形状、指定数据类型、但未初始化的数组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numpy.empty(shape, dtype = <span class="built_in">float</span>, order = <span class="string">&#x27;C&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="2-数组的基本属性"><a href="#2-数组的基本属性" class="headerlink" title="2. 数组的基本属性"></a>2. 数组的基本属性</h1><div class="table-container"><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">ndarray.ndim</td><td style="text-align:left">秩，即轴的数量或维度的数量</td></tr><tr><td style="text-align:left">ndarray.shape</td><td style="text-align:left">数组的维度，对于矩阵，n 行 m 列</td></tr><tr><td style="text-align:left">ndarray.reshape</td><td style="text-align:left">调整数组的大小</td></tr><tr><td style="text-align:left">ndarray.size</td><td style="text-align:left">数组元素的总个数，相当于 .shape 中 n·m 的值</td></tr><tr><td style="text-align:left">ndarray.dtype</td><td style="text-align:left">ndarray 对象的元素类型</td></tr><tr><td style="text-align:left">ndarray.itemsize</td><td style="text-align:left">ndarray 对象中每个元素的大小，以字节为单位</td></tr><tr><td style="text-align:left">ndarray.flags</td><td style="text-align:left">ndarray 对象的内存信息</td></tr><tr><td style="text-align:left">ndarray.real</td><td style="text-align:left">ndarray元素的实部</td></tr><tr><td style="text-align:left">ndarray.imag</td><td style="text-align:left">ndarray 元素的虚部</td></tr><tr><td style="text-align:left">ndarray.data</td><td style="text-align:left">包含实际数组元素的缓冲区，由于一般通过数组的索引获取元素，所以通常不需要使用这个属性。</td></tr></tbody></table></div><blockquote><p>例如：<br>a = np.array([[1,2,3],[4,5,6]])   # (2, 3)</p><p>a = np.array([[1,2,3],[4,5,6]])<br>b = a.reshape(3,2)<br>print (b)<br>[[1, 2]<br> [3, 4]<br> [5, 6]]</p></blockquote><h1 id="3-数组的切片与索引"><a href="#3-数组的切片与索引" class="headerlink" title="3. 数组的切片与索引"></a>3. 数组的切片与索引</h1><h2 id="（1）slice函数切片"><a href="#（1）slice函数切片" class="headerlink" title="（1）slice函数切片"></a>（1）slice函数切片</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">slice</span>(start, stop[, step])</span><br><span class="line"><span class="comment"># start  起始位置</span></span><br><span class="line"><span class="comment"># stop   结束位置</span></span><br><span class="line"><span class="comment"># step   间距</span></span><br></pre></td></tr></table></figure><h2 id="（2）冒号-分割切片-start-stop-step"><a href="#（2）冒号-分割切片-start-stop-step" class="headerlink" title="（2）冒号:分割切片[start:stop:step]"></a>（2）冒号<code>:</code>分割切片[start:stop:step]</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(10) # [0 1 2 3 4 5 6 7 8 9]</span><br><span class="line">b = a[2:7:2]</span><br><span class="line">b = a[5]</span><br><span class="line">b = a[2:]</span><br></pre></td></tr></table></figure><blockquote><p>冒号 : 的解释：如果只放置一个参数，如 <strong>[2]</strong>，将返回与该索引相对应的单个元素。如果为 <strong>[2:]</strong>，表示从该索引开始以后的所有项都将被提取。如果使用了两个参数，如 <strong>[2:7]</strong>，那么则提取两个索引(不包括停止索引)之间的项。</p></blockquote><h2 id="（3）split方法"><a href="#（3）split方法" class="headerlink" title="（3）split方法"></a>（3）split方法</h2><p>numpy.split 函数沿特定的轴将数组分割为子数组</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">numpy.split(ary, indices_or_sections, axis)</span><br><span class="line"><span class="comment"># ary：被分割的数组</span></span><br><span class="line"><span class="comment"># indices_or_sections：如果是一个整数，就用该数平均切分，如果是一个数组，为沿轴切分的位置（左开右闭）</span></span><br><span class="line"><span class="comment"># axis：设置沿着哪个方向进行切分，默认为 0，横向切分，即水平方向。为 1 时，纵向切分，即竖直方向</span></span><br></pre></td></tr></table></figure><h1 id="4-数组基本操作"><a href="#4-数组基本操作" class="headerlink" title="4. 数组基本操作"></a>4. 数组基本操作</h1><h2 id="（1）数组展开"><a href="#（1）数组展开" class="headerlink" title="（1）数组展开"></a>（1）数组展开</h2><p>numpy.ndarray.flatten 返回一份数组拷贝，对拷贝所做的修改不会影响原始数组。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">8</span>).reshape(<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">a.flatten()             <span class="comment"># [0 1 2 3 4 5 6 7]</span></span><br><span class="line">a.flatten(order = <span class="string">&#x27;F&#x27;</span>)  <span class="comment"># [0 4 1 5 2 6 3 7]</span></span><br><span class="line"><span class="comment"># order：&#x27;C&#x27;按行，&#x27;F&#x27;按列，&#x27;A&#x27;原顺序，&#x27;K&#x27;元素在内存中的出现顺序</span></span><br></pre></td></tr></table></figure><p>numpy.ravel() 展平的数组元素，顺序通常是”C风格”，返回的是数组视图（view，有点类似 C/C++引用reference的意味），修改会影响原始数组。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">8</span>).reshape(<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">a.ravel()              <span class="comment"># [0 1 2 3 4 5 6 7]</span></span><br><span class="line">a.ravel(order = <span class="string">&#x27;F&#x27;</span>)  <span class="comment"># [0 4 1 5 2 6 3 7]</span></span><br></pre></td></tr></table></figure><h2 id="（2）数组转置"><a href="#（2）数组转置" class="headerlink" title="（2）数组转置"></a>（2）数组转置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numpy.transpose(arr, axes)</span><br><span class="line"><span class="comment"># arr ：要操作的数组</span></span><br><span class="line"><span class="comment"># axes：整数列表，对应维度，通常所有维度都会对换</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">numpy.T</span><br><span class="line"><span class="comment"># 数组全部转置</span></span><br></pre></td></tr></table></figure><blockquote><p>例如：<br>a = np.arange(12).reshape(3,4)<br>print (np.transpose(a))<br>print (a.T)</p></blockquote><h2 id="（3）数组轴的移动与交换"><a href="#（3）数组轴的移动与交换" class="headerlink" title="（3）数组轴的移动与交换"></a>（3）数组轴的移动与交换</h2><p>numpy.rollaxis 函数移动特定的轴到一个特定位置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">numpy.rollaxis(arr, axis, start)</span><br><span class="line"><span class="comment"># arr   ：数组</span></span><br><span class="line"><span class="comment"># axis  ：要移动的轴，其它轴的相对位置不会改变</span></span><br><span class="line"><span class="comment"># start ：默认为零，表示完整的滚动。会滚动到特定位置</span></span><br></pre></td></tr></table></figure><p>numpy.swapaxes 函数用于交换数组的两个轴</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">numpy.swapaxes(arr, axis1, axis2)</span><br><span class="line"><span class="comment"># arr   ：数组</span></span><br><span class="line"><span class="comment"># axis1 ：对应第一个轴的整数</span></span><br><span class="line"><span class="comment"># axis2 ：对应第二个轴的整数</span></span><br></pre></td></tr></table></figure><h2 id="（4）连接数组"><a href="#（4）连接数组" class="headerlink" title="（4）连接数组"></a>（4）连接数组</h2><p><strong>数组连接</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numpy.concatenate((a1, a2, ...), axis)</span><br><span class="line"><span class="comment"># a1, a2, ... ：相同类型的数组</span></span><br><span class="line"><span class="comment"># axis：沿着它连接数组的轴，默认为 0</span></span><br></pre></td></tr></table></figure><blockquote><p>例如：<br>a = np.array([[1,2],[3,4]])<br>b = np.array([[5,6],[7,8]])<br>print (np.concatenate((a,b)))<br>[[1 2]<br>[3 4]<br>[5 6]<br>[7 8]]<br>print (np.concatenate((a,b),axis = 1))<br>[[1 2 5 6]<br>[3 4 7 8]]</p></blockquote><p><strong>数组堆叠</strong></p><p>numpy.stack 函数用于沿新轴连接数组序列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numpy.stack(arrays, axis)</span><br><span class="line"><span class="comment"># arrays : 相同形状的数组序列</span></span><br><span class="line"><span class="comment"># axis   : 返回数组中的轴，输入数组沿着它来堆叠</span></span><br></pre></td></tr></table></figure><blockquote><p>例如：<br>a = np.array([[1,2],[3,4]])<br>b = np.array([[5,6],[7,8]])<br>print (np.stack((a,b),0))<br>[[[1 2]<br> [3 4]]<br>[[5 6]<br> [7 8]]]<br>print (np.stack((a,b),1))<br>[[[1 2]<br> [5 6]]<br>[[3 4]<br> [7 8]]]</p></blockquote><p>具体的数组堆叠方式，参考此文章：<a href="https://blog.csdn.net/weixin_44330492/article/details/100126774">【Python中numpy.stack()函数最形象易懂的理解】</a></p><h2 id="（5）数组形状改变"><a href="#（5）数组形状改变" class="headerlink" title="（5）数组形状改变"></a>（5）数组形状改变</h2><p><strong>numpy.resize</strong></p><p>numpy.resize 函数返回指定大小的新数组。如果新数组大小大于原始大小，则包含原始数组中的元素的副本。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numpy.resize(arr, shape)</span><br><span class="line"><span class="comment"># arr   : 要修改大小的数组</span></span><br><span class="line"><span class="comment"># shape : 返回数组的新形状</span></span><br></pre></td></tr></table></figure><h2 id="（6）数组元素的操作"><a href="#（6）数组元素的操作" class="headerlink" title="（6）数组元素的操作"></a>（6）数组元素的操作</h2><p><strong>numpy.append</strong></p><p>numpy.append 函数在数组的末尾添加值。 追加操作会分配整个数组，并把原来的数组复制到新数组中。 此外，输入数组的维度必须匹配否则将生成ValueError。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">numpy.append(arr, values, axis=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># arr   ：输入数组</span></span><br><span class="line"><span class="comment"># values：要向arr添加的值，需要和arr形状相同（除了要添加的轴）</span></span><br><span class="line"><span class="comment"># axis  ：默认为 None。当axis无定义时，是横向加成，返回总是为一维数组！当axis有定义的时候，分别为0和1的时候。当axis有定义的时候，分别为0和1的时候（列数要相同）。当axis为1时，数组是加在右边（行数要相同）。</span></span><br></pre></td></tr></table></figure><p><strong>numpy.insert</strong></p><p>numpy.insert 函数在给定索引之前，沿给定轴在输入数组中插入值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">numpy.insert(arr, obj, values, axis)</span><br><span class="line"><span class="comment"># arr   ：输入数组</span></span><br><span class="line"><span class="comment"># obj   ：在其之前插入值的索引</span></span><br><span class="line"><span class="comment"># values：要插入的值</span></span><br><span class="line"><span class="comment"># axis  ：沿着它插入的轴，如果未提供，则输入数组会被展开</span></span><br></pre></td></tr></table></figure><p><strong>numpy.delete</strong></p><p>numpy.delete 函数返回从输入数组中删除指定子数组的新数组。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">numpy.delete(arr, obj, axis)</span><br><span class="line"><span class="comment"># arr ：输入数组</span></span><br><span class="line"><span class="comment"># obj ：可以被切片，整数或者整数数组，表明要从输入数组删除的子数组</span></span><br><span class="line"><span class="comment"># axis：沿着它删除给定子数组的轴，如果未提供，则输入数组会被展开</span></span><br></pre></td></tr></table></figure><p><strong>numpy.unique</strong></p><p>numpy.unique 函数用于去除数组中的重复元素。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">numpy.unique(arr, return_index, return_inverse, return_counts)</span><br><span class="line"><span class="comment"># arr：输入数组，如果不是一维数组则会展开</span></span><br><span class="line"><span class="comment"># return_index：如果为true，返回新列表元素在旧列表中的位置（下标），并以列表形式储</span></span><br><span class="line"><span class="comment"># return_inverse：如果为true，返回旧列表元素在新列表中的位置（下标），并以列表形式储</span></span><br><span class="line"><span class="comment"># return_counts：如果为true，返回去重数组中的元素在原数组中的出现次数</span></span><br></pre></td></tr></table></figure><h2 id="（7）数组排序"><a href="#（7）数组排序" class="headerlink" title="（7）数组排序"></a>（7）数组排序</h2><div class="table-container"><table><thead><tr><th style="text-align:left">种类</th><th style="text-align:left">速度</th><th style="text-align:left">最坏情况</th><th style="text-align:left">工作空间</th><th style="text-align:left">稳定性</th></tr></thead><tbody><tr><td style="text-align:left"><code>&#39;quicksort&#39;</code>（快速排序）</td><td style="text-align:left">1</td><td style="text-align:left"><code>O(n^2)</code></td><td style="text-align:left">0</td><td style="text-align:left">否</td></tr><tr><td style="text-align:left"><code>&#39;mergesort&#39;</code>（归并排序）</td><td style="text-align:left">2</td><td style="text-align:left"><code>O(n*log(n))</code></td><td style="text-align:left">~n/2</td><td style="text-align:left">是</td></tr><tr><td style="text-align:left"><code>&#39;heapsort&#39;</code>（堆排序）</td><td style="text-align:left">3</td><td style="text-align:left"><code>O(n*log(n))</code></td><td style="text-align:left">0</td><td style="text-align:left">否</td></tr></tbody></table></div><p><strong>numpy.sort()</strong></p><p>numpy.sort() 函数返回输入数组的排序副本。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">numpy.sort(a, axis, kind, order)</span><br><span class="line"><span class="comment"># a: 要排序的数组</span></span><br><span class="line"><span class="comment"># axis: 沿着它排序数组的轴，如果没有数组会被展开，沿着最后的轴排序， axis=0 按列排序，axis=1 按行排序</span></span><br><span class="line"><span class="comment"># kind: 默认为&#x27;quicksort&#x27;（快速排序）</span></span><br><span class="line"><span class="comment"># order: 如果数组包含字段，则是要排序的字段</span></span><br><span class="line"></span><br><span class="line">a = np.array([[<span class="number">3</span>,<span class="number">7</span>],[<span class="number">9</span>,<span class="number">1</span>]])</span><br><span class="line"><span class="built_in">print</span> (np.sort(a))  <span class="comment"># [[3 7],[1 9]]</span></span><br><span class="line"><span class="built_in">print</span> (np.sort(a, axis = <span class="number">0</span>))  <span class="comment"># [[3 1],[9 7]]</span></span><br></pre></td></tr></table></figure><p><strong>numpy.argsort()</strong></p><p>numpy.argsort() 函数返回的是数组值从小到大的索引值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.argsort([<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>])  <span class="comment"># [1 2 0]</span></span><br></pre></td></tr></table></figure><h3 id="（8）数组乘法"><a href="#（8）数组乘法" class="headerlink" title="（8）数组乘法"></a>（8）数组乘法</h3><p><strong>numpy.dot()</strong></p><p> numpy.dot(a, b, out=None)：对于二维数组，它相当于矩阵的乘法；对于一维数组，则是向量的内积；而对于n维，它是a的最后一个轴向和b的倒数第二个轴向的乘积和。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dot(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dot([<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">4</span>])</span><br><span class="line"><span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [[<span class="number">1</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [[<span class="number">4</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dot(a, b)</span><br><span class="line">array([[<span class="number">4</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>]])</span><br></pre></td></tr></table></figure><p><strong>numpy.outer()</strong></p><p>numpy.outer(a, b, out=None)：计算两个向量的外积。输入a,b如果不是一维数组，则先将其变成一维数组，即可得a(M,)和b(N,)这种形式，可得输出为(M,N)。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[a0*b0 a0*b1 ... a0*bN ]</span><br><span class="line"> [a1*b0 .               ]</span><br><span class="line"> [ ... .                ]</span><br><span class="line"> [aM*b0           aM*bN ]]</span><br></pre></td></tr></table></figure><p><strong>numpy.multiply()</strong></p><p>numpy.multiply(a, b)：为对应元素的乘积。维度相等时才能使用，当<strong>数组</strong>或者<strong>矩阵</strong>的维度不相同时，会根据一定的广播规则将维数扩充到一致的形式</p><p><strong>*</strong></p><p>*：当是两个数组相乘时和np.multiply用法相同，为对应元素的乘积；但是如果相乘的元素是矩阵时，则和np.dot用处相同，表示矩阵相乘。</p><h1 id="5-Broadcast广播规则"><a href="#5-Broadcast广播规则" class="headerlink" title="5. Broadcast广播规则"></a>5. Broadcast广播规则</h1><p>广播(Broadcast)是 numpy 对不同形状(shape)的数组进行数值计算的方式， 对数组的算术运算通常在相应的元素上进行。</p><p><strong>具体广播规则如下：</strong></p><ul><li>让所有输入数组都向其中形状最长的数组看齐，形状中不足的部分都通过在前面加 1 补齐。</li><li>输出数组的形状是输入数组形状的各个维度上的最大值。</li><li>如果输入数组的某个维度和输出数组的对应维度的长度相同或者其长度为 1 时，这个数组能够用来计算，否则出错。</li><li>当输入数组的某个维度的长度为 1 时，沿着此维度运算时都用此维度上的第一组值。</li></ul><p><strong>举例</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([[ <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">           [<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>],</span><br><span class="line">           [<span class="number">20</span>,<span class="number">20</span>,<span class="number">20</span>],</span><br><span class="line">           [<span class="number">30</span>,<span class="number">30</span>,<span class="number">30</span>]])</span><br><span class="line">b = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(a + b)</span><br></pre></td></tr></table></figure><p><img src="https://www.runoob.com/wp-content/uploads/2018/10/image0020619.gif" alt=""></p><h1 id="6-数组基本运算"><a href="#6-数组基本运算" class="headerlink" title="6. 数组基本运算"></a>6. 数组基本运算</h1><h2 id="（1）算数函数"><a href="#（1）算数函数" class="headerlink" title="（1）算数函数"></a>（1）算数函数</h2><p><strong>加减乘除</strong></p><p>NumPy 算术函数包含简单的加减乘除: <strong>add()</strong>，<strong>subtract()</strong>，<strong>multiply()</strong> 和 <strong>divide()</strong>。数组必须具有相同的形状或符合数组广播规则。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">9</span>, dtype = np.float_).reshape(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">b = np.array([<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>])</span><br><span class="line"><span class="built_in">print</span> (np.add(a,b))</span><br><span class="line"><span class="built_in">print</span> (np.subtract(a,b))</span><br><span class="line"><span class="built_in">print</span> (np.multiply(a,b))</span><br><span class="line"><span class="built_in">print</span> (np.divide(a,b))</span><br></pre></td></tr></table></figure><p><strong>倒数</strong></p><p>numpy.reciprocal() 函数返回参数逐元素的倒数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([<span class="number">0.25</span>, <span class="number">1.33</span>, <span class="number">1</span>, <span class="number">100</span>])</span><br><span class="line"><span class="built_in">print</span> (np.reciprocal(a))</span><br></pre></td></tr></table></figure><p><strong>指数</strong></p><p>numpy.power() 函数将第一个输入数组中的元素作为底数，计算它与第二个输入数组中相应元素的幂。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([<span class="number">10</span>,<span class="number">100</span>,<span class="number">1000</span>])</span><br><span class="line">b = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span> (np.power(a,b))</span><br></pre></td></tr></table></figure><p><strong>模与余数</strong></p><p>numpy.mod() 计算输入数组中相应元素的相除后的余数。 函数 numpy.remainder() 也产生相同的结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>])</span><br><span class="line">b = np.array([<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>])</span><br><span class="line"><span class="built_in">print</span> (np.mod(a,b))</span><br><span class="line"><span class="built_in">print</span> (np.remainder(a,b))</span><br></pre></td></tr></table></figure><h2 id="（2）统计函数"><a href="#（2）统计函数" class="headerlink" title="（2）统计函数"></a>（2）统计函数</h2><p><strong>最大值与最小值</strong></p><p>numpy.amin() 用于计算数组中的元素沿指定轴的最小值。<br>numpy.amax() 用于计算数组中的元素沿指定轴的最大值。<br>numpy.argmax() 和 numpy.argmin()函数分别沿给定轴返回最大和最小元素的索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([[<span class="number">3</span>,<span class="number">7</span>,<span class="number">5</span>],[<span class="number">8</span>,<span class="number">4</span>,<span class="number">3</span>],[<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>]])</span><br><span class="line"><span class="built_in">print</span> (np.amin(a,<span class="number">1</span>))    <span class="comment"># [3 3 2]</span></span><br><span class="line"><span class="built_in">print</span> (np.amin(a,<span class="number">0</span>))    <span class="comment"># [2 4 3]</span></span><br><span class="line"><span class="built_in">print</span> (np.amax(a))      <span class="comment"># 9</span></span><br><span class="line"><span class="built_in">print</span> (np.amax(a, axis = <span class="number">0</span>))   <span class="comment"># [8 7 9]</span></span><br><span class="line"><span class="built_in">print</span> (np.argmax(a))    <span class="comment"># 8</span></span><br><span class="line"><span class="built_in">print</span> (np.argmax(a, axis = <span class="number">0</span>)) <span class="comment"># [1 0 2]</span></span><br><span class="line"><span class="built_in">print</span> (np.argmin(a))    <span class="comment"># 6</span></span><br><span class="line"><span class="built_in">print</span> (np.argmin(a, axis = <span class="number">1</span>)) <span class="comment"># [0 2 0]</span></span><br></pre></td></tr></table></figure><p><strong>最值差（最大值-最小值）</strong></p><p>numpy.ptp()函数计算数组中元素最大值与最小值的差（最大值 - 最小值）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([[<span class="number">3</span>,<span class="number">7</span>,<span class="number">5</span>],[<span class="number">8</span>,<span class="number">4</span>,<span class="number">3</span>],[<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>]])</span><br><span class="line"><span class="built_in">print</span> (np.ptp(a))    <span class="comment"># 7</span></span><br><span class="line"><span class="built_in">print</span> (np.ptp(a, axis = <span class="number">1</span>))    <span class="comment"># [4 5 7]</span></span><br><span class="line"><span class="built_in">print</span> (np.ptp(a, axis = <span class="number">0</span>))    <span class="comment"># [6 3 6]</span></span><br></pre></td></tr></table></figure><p><strong>算数平均值</strong></p><p>numpy.mean() 函数返回数组中元素的算术平均值。 如果提供了轴，则沿其计算。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])</span><br><span class="line"><span class="built_in">print</span> (np.mean(a))    <span class="comment"># 3.6666666666666665</span></span><br><span class="line"><span class="built_in">print</span> (np.mean(a, axis = <span class="number">0</span>))  <span class="comment"># [2.66666667 3.66666667 4.66666667]</span></span><br><span class="line"><span class="built_in">print</span> (np.mean(a, axis = <span class="number">1</span>))  <span class="comment"># [2. 4. 5.]</span></span><br></pre></td></tr></table></figure><p><strong>加权平均值</strong></p><p>numpy.average() 函数根据在另一个数组中给出的各自的权重计算数组中元素的加权平均值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span> (np.average(a))  <span class="comment"># 2.5</span></span><br><span class="line">wts = np.array([<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span> (np.average(a,weights = wts))  <span class="comment"># 2.0</span></span><br></pre></td></tr></table></figure><p><strong>中位数</strong></p><p>numpy.median() 函数用于计算数组 a 中元素的中位数（中值）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([[<span class="number">30</span>,<span class="number">65</span>,<span class="number">70</span>],[<span class="number">80</span>,<span class="number">95</span>,<span class="number">10</span>],[<span class="number">50</span>,<span class="number">90</span>,<span class="number">60</span>]])</span><br><span class="line"><span class="built_in">print</span> (np.median(a))  <span class="comment"># 65.0</span></span><br><span class="line"><span class="built_in">print</span> (np.median(a, axis = <span class="number">0</span>))  <span class="comment"># [50. 90. 60.]</span></span><br><span class="line"><span class="built_in">print</span> (np.median(a, axis = <span class="number">1</span>))  <span class="comment"># [65. 80. 60.]</span></span><br></pre></td></tr></table></figure><p><strong>方差</strong></p><p>统计中的方差（样本方差）是每个样本值与全体样本值的平均数之差的平方值的平均数，即 mean((x - x.mean())** 2)。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.var([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])  <span class="comment"># 1.25</span></span><br></pre></td></tr></table></figure><p><strong>标准差</strong></p><p>标准差是一组数据平均值分散程度的一种度量，是方差的算术平方根。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.std([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])  <span class="comment"># 1.1180339887498949</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">关于使用Numpy进行一些数组操作的函数方法记录与部分例程，包括数组的创建、切片索引、数组的基本操作（转置、连接、排序、展开等），以及数组运算的一些基本函数的使用方法。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Python" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/Python/"/>
    
    
    <category term="笔记" scheme="https://www.mahaofei.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="Python" scheme="https://www.mahaofei.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Anaconda的基本使用与在Pycharm中调用</title>
    <link href="https://www.mahaofei.com/post/8543c9d.html"/>
    <id>https://www.mahaofei.com/post/8543c9d.html</id>
    <published>2022-04-22T09:00:27.000Z</published>
    <updated>2022-04-22T09:00:27.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="关于Anaconda"><a href="#关于Anaconda" class="headerlink" title="关于Anaconda"></a>关于Anaconda</h1><p>环境 = “好比一栋楼，在楼里面分配一间屋给各种‘包’放，每间房里面的‘包’互不影响”</p><p>激活环境 = “告诉电脑，我现在要用这个屋子里面的‘包’来做东西了所以要进这间屋子”</p><p>移除环境 = “现在这个屋子里面我原来要用的东西现在不需要了把它赶出去节省电脑空间”</p><p>Conda创建环境相当于创建一个虚拟的空间将这些包都装在这个位置，我不需要了可以直接打包放入垃圾箱，同时也可以针对不同程序的运行环境选择不同的conda虚拟环境进行运行。</p><p>例如：</p><p>我的某个程序需要使用python3.8以及一堆其他的包，另一个程序需要python2.7加其它的一些包，这就需要我为这两个程序分别创建虚拟环境。</p><p>这样就可以在一台电脑上实现<strong>多个版本的python程序编写</strong>，同时想<strong>打包程序为exe</strong>的时候，也不会打包进其它没用到的包。</p><h1 id="Anaconda的安装"><a href="#Anaconda的安装" class="headerlink" title="Anaconda的安装"></a>Anaconda的安装</h1><p>Anaconda官网链接：<a href="https://www.anaconda.com/">https://www.anaconda.com/</a></p><p>各个系统版本的Anaconda安装程序都可以直接下载安装即可。</p><h1 id="Anaconda的使用"><a href="#Anaconda的使用" class="headerlink" title="Anaconda的使用"></a>Anaconda的使用</h1><h2 id="配置Anaconda源"><a href="#配置Anaconda源" class="headerlink" title="配置Anaconda源"></a>配置Anaconda源</h2><p>通常anaconda的默认源在境外，下载速度会非常慢甚至导致网络错误下载包失败，打开<code>Anaconda Prompt</code>使用以下方法将清华镜像添加到<code>Anaconda</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ </span><br><span class="line">conda config --set show_channel_urls yes</span><br></pre></td></tr></table></figure><p>使用如下命令查看当前channel</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda info</span><br></pre></td></tr></table></figure><h2 id="Anaconda-Prompt"><a href="#Anaconda-Prompt" class="headerlink" title="Anaconda Prompt"></a>Anaconda Prompt</h2><p><strong>conda版本</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda --version</span><br></pre></td></tr></table></figure><p><strong>列出所有虚拟环境</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda env list</span><br><span class="line">conda info --envs</span><br></pre></td></tr></table></figure><p><strong>创建虚拟环境</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda create -n 环境名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">conda create --name python39 python=3.9</span></span><br></pre></td></tr></table></figure><p><strong>删除已有的环境及其安装包</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove --name 环境名 --all</span><br></pre></td></tr></table></figure></p><p><strong>克隆环境</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create --name 新环境名 --clone 原环境名</span><br></pre></td></tr></table></figure><p><strong>激活某个环境</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">activate 环境名</span><br></pre></td></tr></table></figure><p><strong>退出当前环境</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda deactivate</span><br></pre></td></tr></table></figure><p><strong>查看环境中现有的包</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda list</span><br></pre></td></tr></table></figure><p><strong>用conda或者pip安装包到当前环境</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install 包名称</span><br></pre></td></tr></table></figure><p><strong>包更新</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update numpy</span><br></pre></td></tr></table></figure><h2 id="Anaconda-Navigtor"><a href="#Anaconda-Navigtor" class="headerlink" title="Anaconda Navigtor"></a>Anaconda Navigtor</h2><p>用于管理工具包和环境的图形用户界面，后续涉及的众多管理命令也可以在 Navigator 中手工实现。</p><h1 id="Pycharm中使用"><a href="#Pycharm中使用" class="headerlink" title="Pycharm中使用"></a>Pycharm中使用</h1><p><strong>1. 新建工程后，选择使用现有的解释器</strong></p><p><img src="https://img.mahaofei.com/img/20220422191328.png" alt=""></p><p><strong>2. 选择自己新建的虚拟环境</strong></p><p><img src="https://img.mahaofei.com/img/20220422191623.png" alt=""></p>]]></content>
    
    
    <summary type="html">我想要在电脑上安装许多不同版本的python，或者想要让python环境中只存在用到的包方便对程序打包发布，这些情况都需要我们创建python虚拟环境，Anaconda就是一个这样管理python环境的工具。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Python" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/Python/"/>
    
    
    <category term="笔记" scheme="https://www.mahaofei.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="Python" scheme="https://www.mahaofei.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>毕业设计论文写作格式规范</title>
    <link href="https://www.mahaofei.com/post/16785ea7.html"/>
    <id>https://www.mahaofei.com/post/16785ea7.html</id>
    <published>2022-04-20T07:13:46.000Z</published>
    <updated>2022-04-20T07:13:46.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://pan.baidu.com/s/1n-1xqn3rarwiLiwlTYCNLA?pwd=p5tg">河北工业大学毕业设计中期报告模板.docx</a></p></blockquote><h1 id="重要要求"><a href="#重要要求" class="headerlink" title="重要要求"></a>重要要求</h1><p><strong>文档内所有文字（标题、正文、图、表、参考文献等）都应该使用模板规定的样式</strong></p><h1 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h1><ol><li><p>每个一级标题（一、二、三……）前应空一行。</p></li><li><p>一级、二级、三级标题不应该作为某页的最后一行（即所谓孤行控制）</p></li><li><p>页面最后由于插图导致的空白行最多允许1~2行的宽度。</p></li><li><p>正文多级标题格式顺序</p></li></ol><blockquote><p><strong>（1）这个可以加粗</strong><br>1）再下级的都与正文同格式<br>a. </p></blockquote><h1 id="图、表"><a href="#图、表" class="headerlink" title="图、表"></a>图、表</h1><h2 id="图片插图"><a href="#图片插图" class="headerlink" title="图片插图"></a>图片插图</h2><ol><li><p>表格和插图不能直接出现在正文段落的首行，必须先有文字说明。</p></li><li><p>图题、表头的编制要简洁明了，具有自明性，不能太笼统：图的序号编制只允许到二级，例如图1.1，图1.2，图4.5这样的二级图号，禁止出现图2.1.1这样的三级图号。</p></li><li><p>图片与图题、表头与表格，必须保证在同一页上。</p></li><li><p>图片尺寸尽量调小，能表达清楚图片内容即可。</p></li><li><p>图片中的上下空白尽可能小，通过裁剪剪去图片中的上下空白部分。</p></li><li><p>图中所标注文字大小，要比正文字号小1号。</p></li><li><p>流程图、框图等尽量使用Visio绘制，Visio打开状态下，可直接将visio文件插入word中。</p></li><li><p>图片标注格式</p></li></ol><p><img src="https://img.mahaofei.com/img/20220412112135.png" alt=""></p><p align="center" >图1.1 Web of Science网站图标（图题在下）<p align="center" >Fig.1.1 Web of Science favicon</p>## 表格1. 表格一律采用三线表：表的序号编制只允许到二级，例如表1.1，表1.2，表4.5这样的二级图号，禁止出现表2.1.1这样的三级表号2. 表格标注格式<p align="center" >表1.1 表格的标题（表头在上）<p align="center" >Table.1.1 Title of the table</p><p><img src="https://img.mahaofei.com/img/20220412112135.png" alt=""></p><h1 id="公式编辑"><a href="#公式编辑" class="headerlink" title="公式编辑"></a>公式编辑</h1><ol><li>公式使用word中的公式插件（alt =），符号使用斜体、单位使用正体</li></ol><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1]     袁庆龙, 候文义. Ni-P合金镀层组织形貌及显微硬度研究[J]. 太原理工大学学报, 2001, (1): 51-53.（期刊类）</p><p>[2]     金显贺, 王昌长, 王忠东, 等. 一种用于在线检测局部放电的数字滤波技术[J]. 清华大学学报（自然科学版）, 1993, 33(4): 62–67.</p><p>[3]     Khorasani K. Adaptive control of flexible joint robot[J]. IEEE Trans on Robotics and Automation, 1992, 8(2): 250-267.</p><p>[4]     刘国钧, 陈绍业, 王凤翥. 图书馆目录[M]. 北京: 高等教育出版社, 1957.（专著-参考书）</p><p>[5]     辛希孟. 信息技术与信息服务国际研讨会论文集: A集[C]. 北京: 中国社会科学出版社, 1994.（专著-会议论文集）</p><p>[6]     张筑生. 微分半动力系统的不变集[D]. 北京: 北京大学数学系数学研究所, 1983. （专著-博硕士论文）</p><p>[7]     冯西桥. 核反应堆压力管道与压力容器的LBB分析[R]. 北京: 清华大学核能技术设计研究院, 1997. （报告）</p><p>[8]     GB/T 16159-1996, 汉语拼音正词法基本规则[S]. （标准类）</p><p>[9]     姜锡洲. 一种温热外敷药制备方案[P]. 中国: 881056073,1989-07-26. （专利）</p><p>[10]  王明亮. 关于中国学术期刊标准化数据库系统工程的进展[EB/OL]. http: //www.cajcd.edu.cn/pub/wml.txt/980810–2.html, 1998-08-16/1998-10-04.  （电子文献）</p><p>[11]  Aytekin Çaʇlar, Rezaeitabar Yousef, Dogru Sedat, et al. Railway fastener inspection by real-time machine vision[J]. IEEE Transactions on Systems Man and Cybernetics: Systems, 2015, 45(7): 1101-1107.</p><p>[12]  Stivanello Maurício Edgar, Marcellino Kleber Juan. A Machine Vision System for Online Metal Can-End Rivet Inspection[J]. Journal of Physics: Conference Series, 2019, 1335(1)</p><p>[13]  Zhang Hui, Li Xuanlun, Zhong Hang, et al. Automated machine vision system for liquid particle inspection of pharmaceutical injection[J]. IEEE Transactions on Instrumentation and Measurement, 2018, 67(6): 1278-1297.</p><h1 id="附录：各样式信息"><a href="#附录：各样式信息" class="headerlink" title="附录：各样式信息"></a>附录：各样式信息</h1><div class="table-container"><table><thead><tr><th>样式</th><th>中文字体</th><th>英文字体</th><th>字号</th><th>格式</th><th>行距</th><th>段距</th><th>缩进</th><th>换行与分页</th><th>示例</th></tr></thead><tbody><tr><td>报告标题</td><td>黑体</td><td>Times New Roman</td><td>丝毫</td><td>居中加粗</td><td>1.5倍行距</td><td>段前段后12磅</td><td>无</td><td>孤行控制</td><td>HalfA博客毕业设计论文写作规范</td></tr><tr><td>一级标题</td><td>黑体</td><td>Times New Roman</td><td>小四</td><td></td><td>1.5倍行距</td><td>段前段后6磅</td><td>无</td><td>孤行控制</td><td>一、标题</td></tr><tr><td>二级标题</td><td>黑体</td><td>Times New Roman</td><td>五号</td><td>无</td><td>1.5倍行距</td><td>段前段后3磅</td><td>无</td><td>孤行控制</td><td>1.1 标题</td></tr><tr><td>三级标题</td><td>黑体</td><td>Times New Roman</td><td>五号</td><td>无</td><td>1.5倍行距</td><td>段前段后3磅</td><td>无</td><td>孤行控制</td><td>1.1.1 标题</td></tr><tr><td>正文</td><td>宋体</td><td>Times New Roman</td><td>五号</td><td>无</td><td>1.5倍行距</td><td>无</td><td>首行缩进2字符</td><td>无</td><td>正文</td></tr><tr><td>图题</td><td>宋体</td><td>Times New Roman</td><td>小五</td><td>居中</td><td>1.5倍行距</td><td>无</td><td>无</td><td>无</td><td>图1.1 图题 Fig.1.1 Figure title</td></tr><tr><td>表头</td><td>宋体</td><td>Times New Roman</td><td>小五</td><td>居中</td><td>1.5倍行距</td><td>无</td><td>无</td><td>无</td><td>表1.1 表头 Table.1.1 Table title</td></tr><tr><td>表格标题</td><td>宋体</td><td>Times New Roman</td><td>小五</td><td>居中加粗</td><td>1.25倍行距</td><td>无</td><td>无</td><td>无</td><td>标题</td></tr><tr><td>表格内容</td><td>宋体</td><td>Times New Roman</td><td>小五</td><td>居中</td><td>1.5倍行距</td><td>无</td><td>无</td><td>无</td><td>表格内容</td></tr><tr><td>参考标题</td><td>黑体</td><td>Times New Roman</td><td>五号</td><td>居中</td><td>1.5倍行距</td><td>段前段后0.5行</td><td>无</td><td>无</td><td>参考文献</td></tr><tr><td>参考文献</td><td>宋体</td><td>Times New Roman</td><td>小五</td><td>无</td><td>1.5倍行距</td><td>无</td><td>悬挂缩进2字符、首行缩进-2字符</td><td>无</td><td>[1] 马浩飞. 毕业设计论文写作规范[J]. HalfA博客. 2022.</td></tr></tbody></table></div>]]></content>
    
    
    <summary type="html">博主在写毕业设计过程中遇到过的格式问题汇总，仅供参考。</summary>
    
    
    
    <category term="随笔" scheme="https://www.mahaofei.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="经验" scheme="https://www.mahaofei.com/categories/%E9%9A%8F%E7%AC%94/%E7%BB%8F%E9%AA%8C/"/>
    
    
  </entry>
  
  <entry>
    <title>Solidworks装配体常见问题汇总（随时更新）</title>
    <link href="https://www.mahaofei.com/post/bc899151.html"/>
    <id>https://www.mahaofei.com/post/bc899151.html</id>
    <published>2022-04-15T12:23:20.000Z</published>
    <updated>2022-04-16T01:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>问题目录<br>电脑端：左侧列表<br>手机端：右下角【三】按钮</p><h2 id="【置顶】各种标准件和非标件的模型如何下载"><a href="#【置顶】各种标准件和非标件的模型如何下载" class="headerlink" title="【置顶】各种标准件和非标件的模型如何下载"></a>【置顶】各种标准件和非标件的模型如何下载</h2><p>大部分模型都可以在ToolBox里面下载到。没有的话，如果是标准件，推荐以下两个工具。</p><p><strong>推荐一个软件【今日制造】</strong>（<a href="http://www.maidiyun.com/download/softInfo.aspx?id=1">http://www.maidiyun.com/download/softInfo.aspx?id=1</a>）</p><p><img src="https://img.mahaofei.com/img/20220510161027.png" alt=""></p><p><strong>推荐一个网站【三益精密】</strong>（<a href="http://www.3g-es.com/">http://www.3g-es.com/</a>）</p><p>可以在官网右侧找到2D/3D模型，然后下载电子相册和模型库。也可以直接使用下面的百度网盘。</p><blockquote><p>链接: <a href="https://pan.baidu.com/s/1Wby8zvjswjeNZNGwqe_0Gw">https://pan.baidu.com/s/1Wby8zvjswjeNZNGwqe_0Gw</a><br>提取码: xwsk</p></blockquote><p>下载好后，打开cdstart.exe</p><p><img src="https://img.mahaofei.com/img/20220510161120.png" alt=""></p><p>点击【2D/3D CAD】</p><p><img src="https://img.mahaofei.com/img/20220510161141.png" alt=""></p><p>打开后可以看到有非常多的模型，包括常用机械零部件、电机、传感器等等。</p><p><img src="https://img.mahaofei.com/img/20220510161341.png" alt=""></p><p>下载方式，打开一个想要的零件，点击上面的输出成档，然后选择3D，就可以下载STEP格式了</p><p><img src="https://img.mahaofei.com/img/20220510161536.png" alt=""></p><h2 id="1-修改的标准件在装配体保存后又会还原"><a href="#1-修改的标准件在装配体保存后又会还原" class="headerlink" title="1. 修改的标准件在装配体保存后又会还原"></a>1. 修改的标准件在装配体保存后又会还原</h2><p><strong>问题描述：</strong></p><p>修改标准件后插入装配体中，可是当我们保存退出装配体后，再打开时发现修改好的标准件自动被替换成原来的那个标准件。</p><p><strong>解决方法：</strong></p><p>打开【<strong>工具-选项</strong>】，找到【<strong>异性孔向导/Toolbox</strong>】，<strong>取消</strong>勾选【<strong>将此文件夹设为Toolbox零部件的默认搜索位置</strong>】，重新打开装配体，可以看到修改后的零件被正确的装配好了</p><p><img src="https://img.mahaofei.com/img/20220415203208.png" alt=""></p><h2 id="2-调出Toolbox标准件后如何再对其尺寸修改"><a href="#2-调出Toolbox标准件后如何再对其尺寸修改" class="headerlink" title="2. 调出Toolbox标准件后如何再对其尺寸修改"></a>2. 调出Toolbox标准件后如何再对其尺寸修改</h2><p><strong>问题描述：</strong></p><p>在Solidworks画装配体中，经常会调用标准件，但有的时候装配时会发现标准件尺寸不合适需要修改，不想重新生成零件再重新配合，想要直接修改现有零件。</p><p><strong>解决方法：</strong></p><p>在装配体中，【<strong>右键</strong>】需要修改的标准件，选择【<strong>编辑Toolbox零部件</strong>】即可修改其参数。（需要提前加载Toolbox插件）</p><p><img src="https://img.mahaofei.com/img/20220415203738.png" alt=""></p><h2 id="3-装配体模型灰色-无法修改零件外观-无法调整透明度"><a href="#3-装配体模型灰色-无法修改零件外观-无法调整透明度" class="headerlink" title="3. 装配体模型灰色/无法修改零件外观/无法调整透明度"></a>3. 装配体模型灰色/无法修改零件外观/无法调整透明度</h2><p><strong>问题描述：</strong></p><p>遇到了一个新bug，当我将装配体导出为工程图后，再回到装配体界面，发现模型颜色全部丢失，整体外观变成灰色，并且无论如何修改模型外观、修改模型透明度，都不起作用。</p><p><strong>解决方法：</strong></p><p>我的问题出在<strong>装配体莫名其妙增加了几十个白色外观</strong>。</p><p>打开界面左侧【DisplayManager -&gt; 外观】，可以看到外观下面有几十个白色（这里我已经全部删除了）。选中第一个，按住shift，再选中最后一个，然后按下delete键，将颜色全部删除，这个时候就就可以更改外观了。</p><p><img src="https://img.mahaofei.com/img/20220504162346.png" alt=""></p><p>如果觉得颜色还是发灰，可以到【布景、光源与相机】中，右键各个光源 选择在solidworks中打开，将所有光源打开后一般颜色就会恢复正常了。</p><p><img src="https://img.mahaofei.com/img/20220504162704.png" alt=""></p><h2 id="4-如何加载Q235等其它材质材料"><a href="#4-如何加载Q235等其它材质材料" class="headerlink" title="4. 如何加载Q235等其它材质材料"></a>4. 如何加载Q235等其它材质材料</h2><p><strong>问题描述：</strong></p><p>solidworks中配置零件的指定材质时，会发现有些材料比如Q235，在solidworks标准材质库中找不到。</p><p><strong>解决方法：</strong></p><p>需要我们自己加载GB材质库。下载下面的文件，将文件解压，放在任意一个目录下（建议放在Solidworks安装目录下，方便管理）</p><blockquote><p>链接: <a href="https://pan.baidu.com/s/124gGXvUhpHX3hxiElPC-rw?pwd=ysjp">https://pan.baidu.com/s/124gGXvUhpHX3hxiElPC-rw?pwd=ysjp</a><br>提取码: ysjp</p></blockquote><p><img src="https://img.mahaofei.com/img/20220510160149.png" alt=""></p><p>打开Solidworks选项，找到【文件位置】，添加材质数据库的位置为刚才解压的文件夹。</p><p><img src="https://img.mahaofei.com/img/20220510160254.png" alt=""></p><p>再次打开材料列表，就可以看到新的材质了。</p><p><img src="https://img.mahaofei.com/img/20220510160400.png" alt=""></p><h2 id="5-装配体如何替换零件"><a href="#5-装配体如何替换零件" class="headerlink" title="5. 装配体如何替换零件"></a>5. 装配体如何替换零件</h2><p><img src="https://img.mahaofei.com/img/20220510162046.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220510162120.png" alt=""></p><p><img src="https://img.mahaofei.com/img/20220510162014.png" alt=""></p>]]></content>
    
    
    <summary type="html">在使用Solidworks的过程中遇到很多奇怪的错误比如修改的标准件装配好后重新打开装配体会还原默认形状等，在这里记录遇到的各种问题以及对应的解决方法，供各位参考。</summary>
    
    
    
    <category term="机械" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E6%A2%B0/"/>
    
    <category term="Solidworks" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E6%A2%B0/Solidworks/"/>
    
    
    <category term="bugs" scheme="https://www.mahaofei.com/tags/bugs/"/>
    
    <category term="Solirworks" scheme="https://www.mahaofei.com/tags/Solirworks/"/>
    
  </entry>
  
  <entry>
    <title>各大视频音频网站资源下载</title>
    <link href="https://www.mahaofei.com/post/2c340937.html"/>
    <id>https://www.mahaofei.com/post/2c340937.html</id>
    <published>2022-04-08T11:34:53.000Z</published>
    <updated>2022-04-08T11:34:53.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>使用<a href="https://github.com/soimort/you-get">You-get工具</a>，这是Github上的一个项目，可以下载大多数主流网站的视频，图片、音频。</p><p>支持的网站包括YouTube、Twitter、Facebook、bilibili、AcFun、niconico、网易云音乐、酷狗音乐、qq音乐、爱奇艺、腾讯视频、抖音、快手、知乎等等。</p><blockquote><p>详细文档参见：<a href="https://github.com/soimort/you-get">https://github.com/soimort/you-get</a></p></blockquote><h1 id="工具准备"><a href="#工具准备" class="headerlink" title="工具准备"></a>工具准备</h1><h2 id="1-下载安装python3"><a href="#1-下载安装python3" class="headerlink" title="1. 下载安装python3"></a>1. 下载安装python3</h2><p>网上有很多教程，按照教程安装最新版的python即可。</p><h2 id="2-安装you-get"><a href="#2-安装you-get" class="headerlink" title="2. 安装you-get"></a>2. 安装you-get</h2><p>按下<code>win+R</code>输入<code>cmd</code>，打开命令行窗口，使用如下指令安装you-get工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install you-get</span><br></pre></td></tr></table></figure><p>然后输入下方代码，升级you-get工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade pip</span><br><span class="line">pip3 install --upgrade you-get</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220407190404.png" alt=""></p><h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><h2 id="1-查看可以下载的质量和格式"><a href="#1-查看可以下载的质量和格式" class="headerlink" title="1. 查看可以下载的质量和格式"></a>1. 查看可以下载的质量和格式</h2><p>复制想要下载的视频或音频的网页链接。</p><p>使用<code>--info</code>/<code>-i</code>指令即可查看所有可以下载的文件质量和格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you-get -i https://www.bilibili.com/video/BV1Ni4y1k7rv</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220407191446.png" alt=""></p><h2 id="2-下载视频-音频-图片"><a href="#2-下载视频-音频-图片" class="headerlink" title="2. 下载视频/音频/图片"></a>2. 下载视频/音频/图片</h2><p>直接使用<code>you-get</code>指令会下载defalut下面的第一种格式，并下载到命令行当前所在目录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you-get -i https://www.bilibili.com/video/BV1Ni4y1k7rv</span><br></pre></td></tr></table></figure><p>如果想要下载特定的格式，找到对应格式下面提示的下载指令，使用下载指令下载就行，例如我要下载此视频的mp4版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you-get --format=dash-flv https://www.bilibili.com/video/BV1Ni4y1k7rv</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220407193145.png" alt=""></p><p>可以看到速度还是蛮快的。</p><h2 id="3-设置输出文件夹与文件名"><a href="#3-设置输出文件夹与文件名" class="headerlink" title="3. 设置输出文件夹与文件名"></a>3. 设置输出文件夹与文件名</h2><p>使用<code>--output-dir</code>/<code>-o</code>选项设置路径，使用<code>--output-filename</code>/<code>-O</code>设置下载文件的名称：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you-get --format=dash-flv -o E:/Windows/VIDEOS -O 夏天 https://www.bilibili.com/video/BV1Ni4y1k7rv</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220407193428.png" alt=""></p>]]></content>
    
    
    <summary type="html">使用You-get工具，Github上的一个项目，可以下载大多数主流网站的视频，图片、音频。支持的网站包括YouTube、Twitter、Facebook、bilibili、AcFun、niconico、网易云音乐、酷狗音乐、qq音乐、爱奇艺、腾讯视频、抖音、快手、知乎等等。</summary>
    
    
    
    <category term="技巧" scheme="https://www.mahaofei.com/categories/%E6%8A%80%E5%B7%A7/"/>
    
    <category term="破解方法" scheme="https://www.mahaofei.com/categories/%E6%8A%80%E5%B7%A7/%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95/"/>
    
    
    <category term="破解" scheme="https://www.mahaofei.com/tags/%E7%A0%B4%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>Staple目标跟踪算法C++代码测试</title>
    <link href="https://www.mahaofei.com/post/1a6f38d3.html"/>
    <id>https://www.mahaofei.com/post/1a6f38d3.html</id>
    <published>2022-04-05T01:55:07.000Z</published>
    <updated>2022-04-05T01:55:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><p>Staple综合了局部特征HOG和全局特征颜色直方图用于目标跟踪的算法。</p><p>首先作者发现颜色分布不足以将目标和背景区分开来。局部特征这样的模板在应对剧烈形变的时候效果往往很差。</p><p>作者针对这两个问题做了一些相关工作得到以下结论。</p><ol><li>卷积滤波器对剧烈形变不鲁棒。</li><li>在线学习可能会带来模型漂移，也就是算法是将预测作为正样本来训练，更新模型。如果一旦预测不对，后面也跟着错。</li><li>颜色直方图是不考虑像素位置的，这在一定程度上可以减少形变的影响。</li><li>相关滤波CF的鲁棒性比较强，在目标颜色和背景颜色区分力度不够时可以发挥作用。</li></ol><p>因此作者结合了这些实现目标跟踪。</p><h2 id="二、理论方法"><a href="#二、理论方法" class="headerlink" title="二、理论方法"></a>二、理论方法</h2><h3 id="2-1-总体方法"><a href="#2-1-总体方法" class="headerlink" title="2.1 总体方法"></a>2.1 总体方法</h3><p>$p_t=argmax_{p{\in}S_t} f(T(x_t,p);{\theta}_{t-1})$</p><p>对于$t$帧，可以通过矩形$p_t$在图像$x_t$中选择一个目标，并令得分函数的值最大。<br>（$f$是矩形窗口$p$的得分函数，得分函数$T$是一种图像变换，$\theta$是模型参数）</p><p>$\theta_t=argmin_{\theta \in Q}\{L(\theta;X_t+\lambda R(\theta)\}$</p><p>$X_t=\{(x_i,p_i)\}^t_{i=1}$</p><p>可以取一组$\theta$使得整个损失函数最小。<br>（$L$是和前面帧的目标位置有关的函数，$R$是正则项）</p><h3 id="2-2-得分函数"><a href="#2-2-得分函数" class="headerlink" title="2.2 得分函数"></a>2.2 得分函数</h3><p>$f(x)={\gamma}_{tmpl}f_{tmpl}(x)+{\gamma}_{hist}f_{hist}(x)$</p><p>$f_{tmpl}(x;h)=\sum_{u\in{\tau}}h[u]^T\phi_x[u]$</p><p>$\phi_x:\tau\rightarrow\mathbb{R}^K$<br>$\tau:\subset\mathbb{Z}^2$</p><p>f函数是由两项组成，一项是模板的得分，第二项是直方图得分。这个公式代表，假设一张图像x用$Z^2$表示</p><h3 id="2-3"><a href="#2-3" class="headerlink" title="2.3"></a>2.3</h3><h2 id="三、论文笔记"><a href="#三、论文笔记" class="headerlink" title="三、论文笔记"></a>三、论文笔记</h2><p>STAPLE目标跟踪算法结合了HOG特征和颜色直方图两种方法。由于HOG特征对运动模糊和照度较为鲁棒，但是对形变不够鲁棒，而相对应的颜色直方图对形变非常鲁棒，对光照变化不够鲁棒。因此两种方法可以互补，故同时使用这两种方法，分为两个通道进行处理。</p><p>该算法在第一帧使用矩形框指定目标，然后在视频中跟踪一个不熟悉的物体并对其外观的变化保持鲁棒性。由于一个物体的外观在视频中可能会出现很大变化，因此只从使用第一帧计算的模型估算其他帧不会很有效，通常的做法是将跟踪帧中的预测作为训练数据更新模型。在每一帧图像中搜索目标位置时，考虑先将图像的各个旋转中进行搜索，然后再在比例放缩中进行搜索。</p><h2 id="四、代码测试"><a href="#四、代码测试" class="headerlink" title="四、代码测试"></a>四、代码测试</h2><p>论文作者使用MATLAB实现这个算法。而本人使用的是Github上的大神xuduo35<strong>以C++实现的版本</strong>，原Github项目链接如下：</p><p>论文源代码(MATLAB)：<br><a href="https://github.com/bertinetto/staple">https://github.com/bertinetto/staple</a><br>xuduo35(C++)：<br><a href="https://github.com/xuduo35/STAPLE">https://github.com/xuduo35/STAPLE</a></p><p>本文参考<a href="https://github.com/xuduo35/STAPLE">xuduo34</a>的代码，调用了该项目中<code>fhog.cpp</code>、<code>fhog.h</code>、<code>sse.hpp</code>、<code>staple_tracker.cpp</code>、<code>staple_tracker.hpp</code>文件，下面只放出main函数代码。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> * argv[])</span></span>&#123;</span><br><span class="line">    <span class="comment">// 数据定义</span></span><br><span class="line">    STAPLE_TRACKER staple;  <span class="comment">//创建staple跟踪对象</span></span><br><span class="line">    std::vector&lt;cv::Rect_&lt;<span class="type">float</span>&gt;&gt; result_rects;     <span class="comment">//创建矩形容器，存储所有算法识别出的跟踪框</span></span><br><span class="line">    <span class="function">cv::VideoCapture <span class="title">capture</span><span class="params">(<span class="number">0</span>)</span></span>;<span class="comment">//创建VideoCapture类</span></span><br><span class="line">    cv::Mat image;      <span class="comment">//用来存储每一帧</span></span><br><span class="line">    cv::Mat tempImage;  <span class="comment">//每一帧的临时变量</span></span><br><span class="line">    int64 tic, toc;     <span class="comment">//算法运行时间起始点与终止点</span></span><br><span class="line">    <span class="type">double</span> time = <span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> show_visualization = <span class="literal">true</span>;</span><br><span class="line">    <span class="type">bool</span> first_image = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置鼠标操作回调函数</span></span><br><span class="line">    cv::<span class="built_in">namedWindow</span>(<span class="string">&quot;STAPLE&quot;</span>);</span><br><span class="line">    cv::<span class="built_in">setMouseCallback</span>(<span class="string">&quot;STAPLE&quot;</span>, on_MouseHandle, (<span class="type">void</span>*)&amp;image);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        capture.<span class="built_in">read</span>(image);<span class="comment">//逐帧读取视频</span></span><br><span class="line">        <span class="built_in">flip</span>(image, image, <span class="number">1</span>);<span class="comment">//将读取的视频左右反转</span></span><br><span class="line">        <span class="keyword">if</span> (image.<span class="built_in">empty</span>()) &#123;<span class="comment">//如果视频结束或未检测到摄像头则跳出循环</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(drawing_finished == <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="comment">// 鼠标按下drawing_box=true，在视频画面frame上画矩形</span></span><br><span class="line">            <span class="keyword">if</span>( drawing_box )&#123;</span><br><span class="line">                tempImage.<span class="built_in">copyTo</span>(image);</span><br><span class="line">                cv::<span class="built_in">rectangle</span>(image,groundtruth_rect.<span class="built_in">tl</span>(),groundtruth_rect.<span class="built_in">br</span>(),cv::<span class="built_in">Scalar</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>));<span class="comment">// 画框</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                image.<span class="built_in">copyTo</span>(tempImage);<span class="comment">//拷贝源图到临时变量</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 如果是第一帧图像,则进行staple初始化操作，反之则只更新staple</span></span><br><span class="line">            <span class="keyword">if</span> (first_image)&#123;</span><br><span class="line">                <span class="comment">// staple初始化操作</span></span><br><span class="line">                staple.<span class="built_in">tracker_staple_initialize</span>(image, groundtruth_rect);</span><br><span class="line">                <span class="comment">// staple目标追踪</span></span><br><span class="line">                staple.<span class="built_in">tracker_staple_train</span>(image, <span class="literal">true</span>);</span><br><span class="line">                first_image = <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                groundtruth_rect = staple.<span class="built_in">tracker_staple_update</span>(image);</span><br><span class="line">                staple.<span class="built_in">tracker_staple_train</span>(image, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 可视化部分</span></span><br><span class="line">        <span class="keyword">if</span> (show_visualization) &#123;</span><br><span class="line">            <span class="comment">// 显示算法识别的跟踪框</span></span><br><span class="line">            cv::<span class="built_in">rectangle</span>(image, groundtruth_rect, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">128</span>, <span class="number">255</span>), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 写入测试视频</span></span><br><span class="line">            <span class="comment">// ******************** //</span></span><br><span class="line">            <span class="comment">// video.write(image);</span></span><br><span class="line">            <span class="comment">// ******************** //</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 输出图像显示结果</span></span><br><span class="line">            cv::<span class="built_in">imshow</span>(<span class="string">&quot;STAPLE&quot;</span>, image);</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Center: [&quot;</span> &lt;&lt; groundtruth_rect.<span class="built_in">tl</span>().x +groundtruth_rect.width/<span class="number">2</span> &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; groundtruth_rect.<span class="built_in">tl</span>().y + groundtruth_rect.height/<span class="number">2</span> &lt;&lt; <span class="string">&quot;]&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">            <span class="type">char</span> key = cv::<span class="built_in">waitKey</span>(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">if</span> (key == <span class="number">27</span> || key == <span class="string">&#x27;q&#x27;</span> || key == <span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    cv::<span class="built_in">destroyAllWindows</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************** 函数定义 ********************/</span></span><br><span class="line"><span class="comment">// 使轴对齐</span></span><br><span class="line"><span class="function">cv::Rect_&lt;<span class="type">float</span>&gt; <span class="title">getAxisAlignedBB</span><span class="params">(std::vector&lt;cv::Point2f&gt; polygon)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> cx = <span class="built_in">double</span>(polygon[<span class="number">0</span>].x + polygon[<span class="number">1</span>].x + polygon[<span class="number">2</span>].x + polygon[<span class="number">3</span>].x) / <span class="number">4.</span>;</span><br><span class="line">    <span class="type">double</span> cy = <span class="built_in">double</span>(polygon[<span class="number">0</span>].y + polygon[<span class="number">1</span>].y + polygon[<span class="number">2</span>].y + polygon[<span class="number">3</span>].y) / <span class="number">4.</span>;</span><br><span class="line">    <span class="type">double</span> x1 = std::<span class="built_in">min</span>(std::<span class="built_in">min</span>(std::<span class="built_in">min</span>(polygon[<span class="number">0</span>].x, polygon[<span class="number">1</span>].x), polygon[<span class="number">2</span>].x), polygon[<span class="number">3</span>].x);</span><br><span class="line">    <span class="type">double</span> x2 = std::<span class="built_in">max</span>(std::<span class="built_in">max</span>(std::<span class="built_in">max</span>(polygon[<span class="number">0</span>].x, polygon[<span class="number">1</span>].x), polygon[<span class="number">2</span>].x), polygon[<span class="number">3</span>].x);</span><br><span class="line">    <span class="type">double</span> y1 = std::<span class="built_in">min</span>(std::<span class="built_in">min</span>(std::<span class="built_in">min</span>(polygon[<span class="number">0</span>].y, polygon[<span class="number">1</span>].y), polygon[<span class="number">2</span>].y), polygon[<span class="number">3</span>].y);</span><br><span class="line">    <span class="type">double</span> y2 = std::<span class="built_in">max</span>(std::<span class="built_in">max</span>(std::<span class="built_in">max</span>(polygon[<span class="number">0</span>].y, polygon[<span class="number">1</span>].y), polygon[<span class="number">2</span>].y), polygon[<span class="number">3</span>].y);</span><br><span class="line">    <span class="type">double</span> A1 = <span class="built_in">norm</span>(polygon[<span class="number">1</span>] - polygon[<span class="number">2</span>])*<span class="built_in">norm</span>(polygon[<span class="number">2</span>] - polygon[<span class="number">3</span>]);</span><br><span class="line">    <span class="type">double</span> A2 = (x2 - x1) * (y2 - y1);</span><br><span class="line">    <span class="type">double</span> s = <span class="built_in">sqrt</span>(A1 / A2);</span><br><span class="line">    <span class="type">double</span> w = s * (x2 - x1) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">double</span> h = s * (y2 - y1) + <span class="number">1</span>;</span><br><span class="line">    <span class="function">cv::Rect_&lt;<span class="type">float</span>&gt; <span class="title">rect</span><span class="params">(cx<span class="number">-1</span>-w/<span class="number">2.0</span>, cy<span class="number">-1</span>-h/<span class="number">2.0</span>, w, h)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> rect;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取groundtruth内的矩形坐标</span></span><br><span class="line">std::vector&lt;cv::Rect_&lt;<span class="type">float</span>&gt;&gt; <span class="built_in">getgroundtruth</span>(std::string txt_file)</span><br><span class="line">&#123;</span><br><span class="line">    std::vector&lt;cv::Rect_&lt;<span class="type">float</span>&gt;&gt; rects;</span><br><span class="line">    std::ifstream gt;</span><br><span class="line">    gt.<span class="built_in">open</span>(txt_file.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">if</span> (!gt.<span class="built_in">is_open</span>())</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Ground truth file &quot;</span> &lt;&lt; txt_file</span><br><span class="line">                  &lt;&lt; <span class="string">&quot; can not be read&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::string line;</span><br><span class="line">    <span class="type">float</span> x1, y1, x2, y2, x3, y3, x4, y4;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">getline</span>(gt, line)) &#123;</span><br><span class="line">        std::<span class="built_in">replace</span>(line.<span class="built_in">begin</span>(), line.<span class="built_in">end</span>(), <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        std::stringstream ss;</span><br><span class="line">        ss.<span class="built_in">str</span>(line);</span><br><span class="line">        ss &gt;&gt; x1 &gt;&gt; y1 &gt;&gt; x2 &gt;&gt; y2 &gt;&gt; x3 &gt;&gt; y3 &gt;&gt; x4 &gt;&gt; y4;</span><br><span class="line">        std::vector&lt;cv::Point2f&gt;polygon;</span><br><span class="line">        polygon.<span class="built_in">push_back</span>(cv::<span class="built_in">Point2f</span>(x1, y1));</span><br><span class="line">        polygon.<span class="built_in">push_back</span>(cv::<span class="built_in">Point2f</span>(x2, y2));</span><br><span class="line">        polygon.<span class="built_in">push_back</span>(cv::<span class="built_in">Point2f</span>(x3, y3));</span><br><span class="line">        polygon.<span class="built_in">push_back</span>(cv::<span class="built_in">Point2f</span>(x4, y4));</span><br><span class="line">        rects.<span class="built_in">push_back</span>(<span class="built_in">getAxisAlignedBB</span>(polygon)); <span class="comment">//0-index</span></span><br><span class="line">    &#125;</span><br><span class="line">    gt.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> rects;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第一帧画框鼠标响应</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">on_MouseHandle</span><span class="params">(<span class="type">int</span> event, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> flags, <span class="type">void</span>* param )</span></span>&#123;</span><br><span class="line">    cv::Mat&amp; image = *(cv::Mat*) param;</span><br><span class="line">    <span class="keyword">switch</span>( event)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//鼠标移动消息</span></span><br><span class="line">        <span class="keyword">case</span> cv::EVENT_MOUSEMOVE:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>( drawing_box )<span class="comment">//如果是否进行绘制的标识符为真，则记录下长和宽到RECT型变量中</span></span><br><span class="line">            &#123;</span><br><span class="line">                groundtruth_rect.width = x-groundtruth_rect.x;</span><br><span class="line">                groundtruth_rect.height = y-groundtruth_rect.y;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//左键按下消息</span></span><br><span class="line">        <span class="keyword">case</span> cv::EVENT_LBUTTONDOWN:</span><br><span class="line">        &#123;</span><br><span class="line">            drawing_box = <span class="literal">true</span>;</span><br><span class="line">            groundtruth_rect = cv::<span class="built_in">Rect</span>( x, y, <span class="number">0</span>, <span class="number">0</span> );<span class="comment">//记录起始点</span></span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//左键抬起消息</span></span><br><span class="line">        <span class="keyword">case</span> cv::EVENT_LBUTTONUP:</span><br><span class="line">        &#123;</span><br><span class="line">            drawing_box = <span class="literal">false</span>;<span class="comment">//置标识符为false</span></span><br><span class="line">            drawing_finished = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//对宽和高小于0的处理</span></span><br><span class="line">            <span class="keyword">if</span>( groundtruth_rect.width &lt; <span class="number">0</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                groundtruth_rect.x += groundtruth_rect.width;</span><br><span class="line">                groundtruth_rect.width *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>( groundtruth_rect.height &lt; <span class="number">0</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                groundtruth_rect.y += groundtruth_rect.height;</span><br><span class="line">                groundtruth_rect.height *= <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//调用函数进行绘制</span></span><br><span class="line">            cv::<span class="built_in">rectangle</span>(image,groundtruth_rect.<span class="built_in">tl</span>(),groundtruth_rect.<span class="built_in">br</span>(),cv::<span class="built_in">Scalar</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>));<span class="comment">// 画框</span></span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下图为在Staple目标跟踪程序的基础上改编，与Realsense D435i相机的深度图结合的测试程序。</p><p><img src="https://img.mahaofei.com/img/20220405_target_tracking.jpg" alt=""></p>]]></content>
    
    
    <summary type="html">Staple综合了局部特征HOG和全局特征颜色直方图用于目标跟踪的算法。此测试已经在win与ubuntu以及ros环境下完成，运行正常。</summary>
    
    
    
    <category term="机器人" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
    
    <category term="视觉" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA/%E8%A7%86%E8%A7%89/"/>
    
    
    <category term="算法" scheme="https://www.mahaofei.com/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="目标跟踪" scheme="https://www.mahaofei.com/tags/%E7%9B%AE%E6%A0%87%E8%B7%9F%E8%B8%AA/"/>
    
  </entry>
  
  <entry>
    <title>华为手机安装谷歌服务</title>
    <link href="https://www.mahaofei.com/post/367f6bb8.html"/>
    <id>https://www.mahaofei.com/post/367f6bb8.html</id>
    <published>2022-03-28T13:06:36.000Z</published>
    <updated>2022-03-28T13:06:36.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>链接: <a href="https://pan.baidu.com/s/1_PPC3xveD2xPwsg6JGgZmQ?pwd=wcrp">https://pan.baidu.com/s/1_PPC3xveD2xPwsg6JGgZmQ?pwd=wcrp</a><br>提取码: wcrp</p></blockquote><p>1、荣耀60或60pro教程【本人实测教程】，把这里的文件复制到手机</p><p>2、清除所有之前安装过的谷歌相关软件和系统进程。没装过的跳过这一步</p><p>3、打开 文件管理APP 将下载文件中的【Backup】 文件夹，复制到U盘根目录</p><p>4、很关键的一步，打开系统和更新，设置时间，将时间设置到2020年的任何一天</p><p>5、打开设置—系统和更新—备份和恢复-内部存储恢复-选择20191207的选项进行恢复。恢复完成后桌面会有一个谷歌服务助手，点开点激活，之后不用管它。回到设置—将时间设置为自动设置，恢复到2021年。</p><p>6、打开梯子。</p><p>7、安装0文件(microG)，装完之后打开，点账户account，点sign in，没有反应，就再点account，点sign in，登录谷歌账号（有几个登几个，后边不能再加）。</p><p>8、安装1，3，4，apk文件，然后卸载掉第7步安装的0文件(microG)</p><p>9、回到文件管理，安装2文件Google play服务.apk，拉下通知栏，等待弹出谷歌认证，之后点击验证（等10秒-50秒就会自动弹出来了）。</p><p>10、回到手机桌面，打开Google play商店，Google play商店可以正常打开，将Google play商店从后台关掉</p><p>11、打开手机设置-应用和服务-应用管理-点右上角，显示系统程序，搜索【Google】，</p><p>点开Google play商店，强行停止，后退，</p><p>点开-Google账号管理程序，存储，删除数据，后退，再后退</p><p>点开Google服务框架，存储，删除数据，后退</p><p>然后重启手机。</p><p>12、设置-里面有Google服务</p>]]></content>
    
    
    <summary type="html">以荣耀60或60pro为例【本人实测教程】</summary>
    
    
    
    <category term="技巧" scheme="https://www.mahaofei.com/categories/%E6%8A%80%E5%B7%A7/"/>
    
    <category term="破解方法" scheme="https://www.mahaofei.com/categories/%E6%8A%80%E5%B7%A7/%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95/"/>
    
    
    <category term="破解" scheme="https://www.mahaofei.com/tags/%E7%A0%B4%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>ROS与STM32通信</title>
    <link href="https://www.mahaofei.com/post/7ea7f1cc.html"/>
    <id>https://www.mahaofei.com/post/7ea7f1cc.html</id>
    <published>2022-03-28T03:43:16.000Z</published>
    <updated>2022-03-28T03:43:16.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ROS功能包与STM32工程文件：<br>蓝奏云：<a href="https://huffie.lanzouw.com/iN7w602ti37a">https://huffie.lanzouw.com/iN7w602ti37a</a></p></blockquote><h1 id="1-通信协议"><a href="#1-通信协议" class="headerlink" title="1 通信协议"></a>1 通信协议</h1><p>STM32和ROS端各有一个数据发送函数和数据接收函数，发送和接受的数据以数据包的形式发送。</p><h2 id="数据包的内容："><a href="#数据包的内容：" class="headerlink" title="数据包的内容："></a>数据包的内容：</h2><p>数据头55aa + 数据字节数size + 数据共用体 + 校验crc8 + 数据尾0d0a</p><h1 id="2-原理"><a href="#2-原理" class="headerlink" title="2 原理"></a>2 原理</h1><h2 id="2-1-收发数据方法简述"><a href="#2-1-收发数据方法简述" class="headerlink" title="2.1 收发数据方法简述"></a>2.1 收发数据方法简述</h2><p>首先，串口收发数据是一个字节一个字节的传输的。一个字节最大表示数据是255，而往往我们需要传递的传感器数据都是int/float类型的。</p><p>传统的串口通信方法是将int/float数据分解成一个个字节发送出去。</p><p>而这里使用共用体，将数据通过共用体转换为数组发送。</p><h2 id="2-2-数据共用体的使用"><a href="#2-2-数据共用体的使用" class="headerlink" title="2.2 数据共用体的使用"></a>2.2 数据共用体的使用</h2><p><strong>共用体的规则</strong>：</p><ul><li>共用体是结构体内不同成员共享内存的机制，各成员内存地址一致</li><li>同一时刻只能访问其中的一个成员</li><li>不同成员按照成员类型的性质进行内存访问。</li></ul><p><strong>共用体的创建</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span> <span class="title class_">Data</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">float</span> f;</span><br><span class="line"><span class="type">char</span> str[<span class="number">20</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">union</span> <span class="title class_">Data</span> data;</span><br><span class="line">data.i = <span class="number">10</span>;</span><br><span class="line">data.f = <span class="number">220.5</span>;</span><br><span class="line"><span class="built_in">strcpy</span>( data.str, <span class="string">&quot;C Programming&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>( <span class="string">&quot;data.i : %d\n&quot;</span>, data.i);</span><br><span class="line"><span class="built_in">printf</span>( <span class="string">&quot;data.f : %f\n&quot;</span>, data.f);</span><br><span class="line"><span class="built_in">printf</span>( <span class="string">&quot;data.str : %s\n&quot;</span>, data.str);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后赋给变量的值占用了内存位置，因此同一时间只能用到一个成员。</p><p><strong>如何使用共用体</strong></p><p>在通信两端都定义同样数据结构的共用体，该共用体包含一个short/int/float类型的变量和一个unsigned char类型的数组，数组大小与变量字节大小对应。这样发送和接收数据时，只发送或接收共用体中unsigned char数组的元素。</p><p><img src="https://gitee.com/huffiema/pictures/raw/master/image/202203251701027-stm32-ros-1.png" alt=""></p><h1 id="3-准备工作"><a href="#3-准备工作" class="headerlink" title="3 准备工作"></a>3 准备工作</h1><h2 id="3-1-硬件准备"><a href="#3-1-硬件准备" class="headerlink" title="3.1 硬件准备"></a>3.1 硬件准备</h2><p>使用STM32串口+TTL转USB模块（CH340）+Linux设备。</p><p><img src="https://gitee.com/huffiema/pictures/raw/master/image/202203251702390-stm32-ros-2.png" alt=""></p><p><strong>注意事项</strong>：</p><ul><li>STM32和ROS的串口波特率必须一致</li><li>STM32串口和USB转TTL模块连接正确，RX-TX，TX-RX</li><li>Linux设备安装好CH340/CH341驱动</li><li>确保串口在Linux系统上有超级用户权限</li><li>将ROS功能包中mbot_linux_serial.cpp文件中的串口设备名字改为自己的设备名</li></ul><h2 id="3-2-串口设置"><a href="#3-2-串口设置" class="headerlink" title="3.2 串口设置"></a>3.2 串口设置</h2><p><strong>查看串口设备</strong></p><p>Linux设备插上USB转TTL模块后，打开终端，输入命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /dev/ttyUSB*</span><br></pre></td></tr></table></figure><p>如果终端出现类似下面的输出结果，说明串口设备已经被识别</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crw-rw---- 1 root dialout 188, 0 3月  25 17:07 /dev/ttyUSB0</span><br></pre></td></tr></table></figure><p><strong>设置串口权限</strong></p><p>在终端中输入下面命令：（注意自己的串口设备名）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 /dev/ttyUSB0 </span><br><span class="line">source devel/setup.bash</span><br></pre></td></tr></table></figure><p>如果没有任何输出，说明串口设备设置权限成功。（每次重新启动或重新插入串口设备后都需要进行这样的操作）</p><h1 id="4-程序设计"><a href="#4-程序设计" class="headerlink" title="4 程序设计"></a>4 程序设计</h1><h2 id="4-1-STM32程序设计"><a href="#4-1-STM32程序设计" class="headerlink" title="4.1 STM32程序设计"></a>4.1 STM32程序设计</h2><p>工程文件中提供的是STM32F103的程序，也可以在自己板子的串口收发例程的基础上进行修改，添加mbotLinuxUsart.c和mbotLinuxUsart.h到工程中即可。</p><p>函数调用方式如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;usart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mbotLinuxUsart.h&quot;</span><span class="comment">//引用该头文件是使用，通信协议的前提</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试发送变量</span></span><br><span class="line"><span class="type">short</span> testSend1   =<span class="number">5000</span>;</span><br><span class="line"><span class="type">short</span> testSend2   =<span class="number">2000</span>;</span><br><span class="line"><span class="type">short</span> testSend3   =<span class="number">1000</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> testSend4 = <span class="number">0x05</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试接收变量</span></span><br><span class="line"><span class="type">int</span> testRece1     =<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> testRece2     =<span class="number">0</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> testRece3 = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line"><span class="comment">/*************** 硬件初始化 ***************/</span></span><br><span class="line">    <span class="built_in">delay_init</span>();                                   <span class="comment">//延时函数初始化   </span></span><br><span class="line">    <span class="built_in">NVIC_PriorityGroupConfig</span>(NVIC_PriorityGroup_2); <span class="comment">//设置中断优先级分组2</span></span><br><span class="line">    <span class="built_in">uart_init</span>(<span class="number">115200</span>);                              <span class="comment">//串口初始化为115200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************循环程序 ***************/</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//将需要发送到ROS的数据，从该函数发出，前三个数据范围（-32768 - +32767），第四个数据的范围(0 - 255)</span></span><br><span class="line">        <span class="built_in">usartSendData</span>(testSend1,testSend2,testSend3,testSend4);</span><br><span class="line">        <span class="comment">//必须的延时</span></span><br><span class="line">        <span class="built_in">delay_ms</span>(<span class="number">13</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*************** 串口中断服务程序 ***************/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">USART1_IRQHandler</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">USART_GetITStatus</span>(USART1, USART_IT_RXNE) != RESET)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="built_in">USART_ClearITPendingBit</span>(USART1,USART_IT_RXNE);<span class="comment">//首先清除中断标志位</span></span><br><span class="line">         <span class="comment">//从ROS接收到的数据，存放到下面三个变量中</span></span><br><span class="line">         <span class="built_in">usartReceiveOneData</span>(&amp;testRece1,&amp;testRece2,&amp;testRece3);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-ROS程序设计"><a href="#4-2-ROS程序设计" class="headerlink" title="4.2 ROS程序设计"></a>4.2 ROS程序设计</h2><p>[[01_Ubuntu20.04安装ROS Noetic|ROS安装]]过程不再介绍</p><p><strong>第一步</strong></p><p>首先[[13_ROS系统基本功能的使用详解（基本指令、节点、服务、启动文件、动态参数）]]（如果没创建的话）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/catkin_ws/src</span><br><span class="line">cd catkin_ws/src</span><br><span class="line">catkin_init_workspace</span><br></pre></td></tr></table></figure><p><strong>第二步</strong></p><p>将topic_example功能包复制到src目录下，然后回到工作空间目录进行编译</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure><h1 id="5-测试"><a href="#5-测试" class="headerlink" title="5 测试"></a>5 测试</h1><p>添加串口设备权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 /dev/ttyUSB0</span><br><span class="line">source devel/setup.bash</span><br></pre></td></tr></table></figure><p>打开新终端，启动`ros master</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br></pre></td></tr></table></figure><p>打开新终端，启动测试功能包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun topic_example publish_node</span><br></pre></td></tr></table></figure><p>可以看到从STM32接收到的数据。</p><p><img src="https://img.mahaofei.com/img/%E9%80%9A%E4%BF%A1STM32%E7%AB%AF.jpg" alt=""></p><p><img src="https://img.mahaofei.com/img/%E9%80%9A%E4%BF%A1%E4%B8%8A%E4%BD%8D%E6%9C%BA%E7%AB%AF.jpg" alt=""></p>]]></content>
    
    
    <summary type="html">实现了上位机Ros noetic与STM32F1开发板的基于串口的相互通信。</summary>
    
    
    
    <category term="机器人" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
    
    <category term="ROS" scheme="https://www.mahaofei.com/categories/%E6%9C%BA%E5%99%A8%E4%BA%BA/ROS/"/>
    
    
    <category term="实验" scheme="https://www.mahaofei.com/tags/%E5%AE%9E%E9%AA%8C/"/>
    
    <category term="ROS" scheme="https://www.mahaofei.com/tags/ROS/"/>
    
  </entry>
  
  <entry>
    <title>❤最全ButterFly主题配置教程 与 Hexo博客备份方法</title>
    <link href="https://www.mahaofei.com/post/8ee3ad86.html"/>
    <id>https://www.mahaofei.com/post/8ee3ad86.html</id>
    <published>2022-03-26T13:14:56.000Z</published>
    <updated>2022-03-26T13:14:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ButterFly主题配置"><a href="#ButterFly主题配置" class="headerlink" title="ButterFly主题配置"></a>ButterFly主题配置</h1><h2 id="一、主页设置"><a href="#一、主页设置" class="headerlink" title="一、主页设置"></a>一、主页设置</h2><h3 id="1-1-导航菜单"><a href="#1-1-导航菜单" class="headerlink" title="1.1 导航菜单"></a>1.1 导航菜单</h3><p><strong>导航菜单</strong></p><p>设置如下<code>_config.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">首页:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="string">时光轴:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="string">标签:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="string">分类:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-folder-open</span></span><br><span class="line">  <span class="comment"># List||fas fa-list:</span></span><br><span class="line">  <span class="comment">#   Music: /music/ || fas fa-music</span></span><br><span class="line">  <span class="comment">#   Movie: /movies/ || fas fa-video</span></span><br><span class="line">  <span class="string">友链:</span> <span class="string">/link/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-link</span></span><br><span class="line">  <span class="string">关于:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-heart</span></span><br></pre></td></tr></table></figure><p>必须是<code>/xxx/</code>，后面<code>||</code>分开，然后写图标名。</p><p>默认子目录是展开的，如果你想要隐藏，在子目录里添加hide</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">List||fas</span>  <span class="string">fa-list||hide:</span> <span class="attr">Music:</span> <span class="string">/music/</span> <span class="string">||</span> <span class="attr">fas fa-music Movie:</span> <span class="string">/movies/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-video</span></span><br></pre></td></tr></table></figure><p><strong>标签页</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span>/tags/index.md</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">--- </span></span><br><span class="line"><span class="attr">title:</span> <span class="string">标签</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2018-01-05 00:00:00</span> </span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;tags&quot;</span> </span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p><strong>分类页</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new page categories</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span>/categories/index.md</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">--- </span></span><br><span class="line"><span class="attr">title:</span> <span class="string">分类</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2018-01-05 00:00:00</span> </span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;categories&quot;</span> </span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p><strong>友情链接</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new page link</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span>/link/index.md</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">--- </span></span><br><span class="line"><span class="attr">title:</span> <span class="string">友情链接</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2018-06-07 22:17:49</span> </span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;link&quot;</span> </span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>在Hexo博客目录中的<code>source/_data</code>（如果没有_data 文件夹，请自行创建），创建一个文件<code>link.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span>  <span class="attr">class_name:</span> <span class="string">网站class_desc:值得推荐的网站link_list:</span> <span class="bullet">-</span> <span class="attr">name: Youtube link: https://www.youtube.com/ avatar:</span> <span class="string">https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png</span> <span class="string">descr:视频网站-</span> <span class="attr">name: Weibo link: https://www.weibo.com/ avatar:</span> <span class="string">https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png</span> <span class="string">descr:中国最大社交分享平台-</span> <span class="attr">name: Twitter link: https://twitter.com/ avatar:</span> <span class="string">https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png</span> <span class="string">descr:社交分享平台</span></span><br></pre></td></tr></table></figure><p>class_name和 class_desc 支持html 格式书写，如不需要，也可以留空。</p><p>友情链接界面可以由用户自己自定义，只需要在友情链接的md档设置就行，以普通的Markdown格式书写。</p><p><strong>搜索系统</strong></p><p>记得运行hexo clean</p><p><a href="https://github.com/PaicHyperionDev/hexo-generator-search">hexo-generator-search</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="1-2-社交图标"><a href="#1-2-社交图标" class="headerlink" title="1.2 社交图标"></a>1.2 社交图标</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># social settings (社交圖標設置)</span></span><br><span class="line"><span class="comment"># formal:</span></span><br><span class="line"><span class="comment">#   icon: link || the description</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">CSDN:</span> <span class="string">https://blog.csdn.net/weixin_44543463</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-cuttlefish</span></span><br><span class="line">  <span class="attr">GitHub:</span> <span class="string">https://github.com/HuffieMa</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">  <span class="attr">E-Mail:</span> <span class="string">mailto:haofei_ma@163.com</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-envelope</span></span><br><span class="line">  <span class="string">知乎:</span> <span class="string">https://www.zhihu.com/people/ma-hao-fei-2</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-zhihu</span></span><br></pre></td></tr></table></figure><h3 id="1-3-网站图像"><a href="#1-3-网站图像" class="headerlink" title="1.3 网站图像"></a>1.3 网站图像</h3><p><strong>网站图标与头像</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Favicon（網站圖標）</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">/img/favicon.png</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Avatar (頭像)</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">img:</span> <span class="string">/img/avatar.jpg</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p><strong>顶部图</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disable_top_img:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p><strong>设置顶部图</strong></p><div class="table-container"><table><thead><tr><th>配置</th><th>解释</th></tr></thead><tbody><tr><td>index_img</td><td>主页的top_img</td></tr><tr><td>default_top_img</td><td>默认的top_img，当页面的top_img 没有配置时，会显示default_top_img</td></tr><tr><td>archive_img</td><td>归档页面的top_img</td></tr><tr><td>tag_img    tag</td><td>子页面的默认top_img</td></tr><tr><td>tag_per_img</td><td>tag 子页面的top_img，可配置每个tag 的top_img</td></tr><tr><td>category_img</td><td>category 子页面的默认top_img</td></tr><tr><td>category_per_img</td><td>category 子页面的top_img，可配置每个category 的top_img</td></tr></tbody></table></div><p>并不推荐为每个tag 和每个category 都配置不同的顶部图，因为配置太多会拖慢生成速度</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tag_per_img</span></span><br><span class="line">  <span class="attr">aplayer:</span> <span class="string">https://xxxxxx.png</span></span><br><span class="line">  <span class="attr">android:</span> <span class="string">ddddddd.png</span></span><br><span class="line"><span class="string">category_per_img</span></span><br><span class="line"><span class="string">随想:</span> <span class="string">hdhdh.png</span></span><br><span class="line"><span class="string">推荐:</span> <span class="string">ddjdjdjd.png</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主页设置</span></span><br><span class="line"><span class="comment"># 默认top_img全屏，site_info在中间</span></span><br><span class="line"><span class="comment"># 使用默认, 都无需填写（建议默认）</span></span><br><span class="line"><span class="attr">index_site_info_top:</span>  <span class="comment"># 主页标题距离顶部距离例如300px/300em/300rem/10% </span></span><br><span class="line"><span class="attr">index_top_img_height:</span>   <span class="comment">#主页top_img高度例如300px/300em/300rem 不能使用百分比</span></span><br></pre></td></tr></table></figure><h3 id="1-4-主页文章设置"><a href="#1-4-主页文章设置" class="headerlink" title="1.4 主页文章设置"></a>1.4 主页文章设置</h3><p><strong>文章信息</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_meta:</span></span><br><span class="line">  <span class="attr">page:</span> <span class="comment"># Home Page</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">created</span> <span class="comment"># created or updated or both 主頁文章日期是創建日或者更新日或都顯示</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">date</span> <span class="comment"># date/relative 顯示日期還是相對日期</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false 主頁是否顯示分類</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false 主頁是否顯示標籤</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false 顯示描述性文字</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">both</span> <span class="comment"># created or updated or both 文章頁日期是創建日或者更新日或都顯示</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">date</span> <span class="comment"># date/relative 顯示日期還是相對日期</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false 文章頁是否顯示分類</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false 文章頁是否顯示標籤</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false 顯示描述性文字</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-docs-page-meta.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-doc-post-info.png" alt=""></p><p><strong>文章简介</strong></p><p>在butterfly里，有四种可供选择</p><ul><li>description：只显示description</li><li><strong>both</strong>：优先选择description，如果没有配置description，则显示自动节选的内容</li><li>auto_excerpt：只显示自动节选</li><li>false：不显示文章内容</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Display the article introduction on homepage</span></span><br><span class="line"><span class="comment"># 1: description</span></span><br><span class="line"><span class="comment"># 2: both (if the description exists, it will show description, or show the auto_excerpt)</span></span><br><span class="line"><span class="comment"># 3: auto_excerpt (default)</span></span><br><span class="line"><span class="comment"># false: do not show the article introduction</span></span><br><span class="line"><span class="attr">index_post_content:</span></span><br><span class="line">  <span class="attr">method:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">500</span> <span class="comment"># if you set method to 2 or 3, the length need to config</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>文章封面</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cover:</span></span><br><span class="line">  <span class="comment"># display the cover or not (是否顯示文章封面)</span></span><br><span class="line">  <span class="attr">index_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">aside_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">archives_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># the position of cover in home page (封面顯示的位置)</span></span><br><span class="line">  <span class="comment"># left/right/both</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">both</span></span><br><span class="line">  <span class="comment"># When cover is not set, the default cover is displayed (當沒有設置cover時，默認的封面顯示)</span></span><br><span class="line">  <span class="attr">default_cover:</span> <span class="string">https://img.mahaofei.com/img/linux_debian.jpg</span></span><br></pre></td></tr></table></figure><h3 id="1-5-字数统计"><a href="#1-5-字数统计" class="headerlink" title="1.5 字数统计"></a>1.5 字数统计</h3><p><code>npm install hexo-wordcount --save</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wordcount:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_wordcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_wordcount:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-docs-wordcount-totalcount.png" alt=""></p><h3 id="1-6-页脚设置"><a href="#1-6-页脚设置" class="headerlink" title="1.6 页脚设置"></a>1.6 页脚设置</h3><p><strong>博客年份</strong></p><p>展示你站点起始时间的选项。它位于页面的最底部。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Footer Settings</span></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">since:</span> <span class="number">2021</span></span><br><span class="line">  <span class="attr">custom_text:</span> <span class="string">&lt;a</span>  <span class="string">href=&quot;https://beian.miit.gov.cn&quot;&gt;&lt;img</span>  <span class="string">class=&quot;icp-icon&quot;</span>  <span class="string">src=&quot;/img/icp.png&quot;&gt;&lt;span&gt;津ICP备2021000769号-2&lt;/span&gt;&lt;/a&gt;</span></span><br><span class="line">  <span class="attr">copyright:</span> <span class="literal">true</span> <span class="comment"># Copyright of theme and framework</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>百度统计</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Baidu Analytics</span></span><br><span class="line"><span class="comment"># https://tongji.baidu.com/web/welcome/login</span></span><br><span class="line"><span class="attr">baidu_analytics:</span> <span class="string">439a0d0abeb31dd8f338efd8266c999b</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-doc-footer-text.png" alt=""></p><p><strong>页脚背景</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># footer是否显示图片背景(与top_img一致) </span></span><br><span class="line"><span class="attr">footer_bg:</span>  <span class="literal">true</span></span><br><span class="line"><span class="comment"># 留空/false显示默认的颜色</span></span><br><span class="line"><span class="comment"># img链接图片的链接，显示所配置的图片</span></span><br><span class="line"><span class="comment"># 颜色(HEX值- #0000FF; RGB值- rgb(0,0,255);颜色单词- orange;渐变色- linear-gradient( 135deg, #E2B0FF 10%, #9F44D3 100%)） 对应的颜色</span></span><br><span class="line"><span class="comment"># true显示跟top_img 一样</span></span><br></pre></td></tr></table></figure><h3 id="1-7-侧边栏设置"><a href="#1-7-侧边栏设置" class="headerlink" title="1.7 侧边栏设置"></a>1.7 侧边栏设置</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># aside (側邊欄)</span></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">aside:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">true</span> <span class="comment"># display on mobile</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">left</span> <span class="comment"># left or right</span></span><br><span class="line">  <span class="attr">card_author:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">    <span class="attr">button:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-cuttlefish</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">CSDN欢迎关注</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://blog.csdn.net/weixin_44543463</span></span><br><span class="line">  <span class="attr">card_announcement:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">毕设ing！！</span></span><br><span class="line">  <span class="attr">card_recent_post:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">5</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort:</span> <span class="string">date</span> <span class="comment"># date or updated</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_categories:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">expand:</span> <span class="string">none</span> <span class="comment"># none/true/false</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_tags:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">40</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">color:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_archives:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">monthly</span> <span class="comment"># yearly or monthly</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">MMMM</span> <span class="string">YYYY</span> <span class="comment"># eg: YYYY年MM月</span></span><br><span class="line">    <span class="attr">order:</span> <span class="number">-1</span> <span class="comment"># Sort of order. 1, asc for ascending; -1, desc for descending</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_webinfo:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">post_count:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">last_push_date:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br></pre></td></tr></table></figure><h2 id="二、文章设置"><a href="#二、文章设置" class="headerlink" title="二、文章设置"></a>二、文章设置</h2><h3 id="2-1-代码设置"><a href="#2-1-代码设置" class="headerlink" title="2.1 代码设置"></a>2.1 代码设置</h3><p><strong>代码高亮</strong></p><p>Butterfly支持6种代码高亮样式：</p><ul><li>darker</li><li>pale night</li><li><strong>light</strong></li><li>ocean</li><li>mac</li><li><strong>mac light</strong></li></ul><p>具体样式参考<a href="https://butterfly.js.org/posts/4aa8abbe/#%E4%BB%A3%E7%A2%BC%E9%AB%98%E4%BA%AE%E4%B8%BB%E9%A1%8C">官方文档</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_theme:</span>  <span class="string">light</span></span><br></pre></td></tr></table></figure><p><strong>代码复制</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_copy:</span>  <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>代码展开关闭</strong></p><p>在默认情况下，代码框自动展开，可设置是否所有代码框都关闭状态，点击&gt;可展开代码</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_shrink:</span>  <span class="literal">true</span>  </span><br><span class="line"><span class="comment"># true 代码框不展开，需点击&gt;打开; </span></span><br><span class="line"><span class="comment"># false 代码框展开，有&gt;点击按钮</span></span><br><span class="line"><span class="comment"># none 不显示&gt;按钮</span></span><br></pre></td></tr></table></figure><p><strong>代码高度限制</strong></p><p>可配置代码高度限制，超出的部分会隐藏，并显示展开按钮。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">highlight_height_limit:</span>  <span class="literal">false</span>  <span class="comment"># unit: px 直接添加数字，如200</span></span><br></pre></td></tr></table></figure><h3 id="2-2-文章复制设置"><a href="#2-2-文章复制设置" class="headerlink" title="2.2 文章复制设置"></a>2.2 文章复制设置</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># copy settings </span></span><br><span class="line"><span class="comment"># copyright: Add the copyright information after copied content (复制的内容后面加上版权信息)</span></span><br><span class="line"><span class="attr">copy:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">copyright:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">limit_count:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>配置</th><th>解释</th></tr></thead><tbody><tr><td>enable</td><td>是否开启网站复制权限</td></tr><tr><td>copyright</td><td>复制的内容后面加上版权信息</td></tr><tr><td>enable</td><td>是否开启复制版权信息添加</td></tr><tr><td>limit_count</td><td>字数限制，当复制文字大于这个字数限制时，将在复制的内容后面加上版权信息</td></tr></tbody></table></div><h3 id="2-3-文章目录"><a href="#2-3-文章目录" class="headerlink" title="2.3 文章目录"></a>2.3 文章目录</h3><p>在文章页，会有一个目录，用于显示TOC。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">post:</span> <span class="literal">true</span> <span class="comment"># 文章页是否显示TOC</span></span><br><span class="line">  <span class="attr">page:</span> <span class="literal">false</span> <span class="comment"># 普通页面是否显示TOC</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">true</span> <span class="comment"># 是否显示章节数</span></span><br><span class="line">  <span class="attr">expand:</span> <span class="literal">false</span> <span class="comment"># 是否展开TOC</span></span><br><span class="line">  <span class="attr">style_simple:</span> <span class="literal">false</span> <span class="comment"># 简洁模式（侧边栏只显示TOC, 只对文章页有效）</span></span><br></pre></td></tr></table></figure><p>主题会优先判断文章Markdown的Front-matter是否有配置，如有，则以Front-matter的配置为准。否则，以主题配置文件中的配置为准</p><h3 id="2-4-文章打赏"><a href="#2-4-文章打赏" class="headerlink" title="2.4 文章打赏"></a>2.4 文章打赏</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sponsor/reward</span></span><br><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">QR_code:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/img/wechatpay.png</span></span><br><span class="line">      <span class="attr">link:</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">微信支付</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">img:</span> <span class="string">/img/alipay.jpg</span></span><br><span class="line">      <span class="attr">link:</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">支付宝</span></span><br></pre></td></tr></table></figure><h3 id="2-5-下一篇文章"><a href="#2-5-下一篇文章" class="headerlink" title="2.5 下一篇文章"></a>2.5 下一篇文章</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># post_pagination (分頁)</span></span><br><span class="line"><span class="comment"># value: 1 || 2 || false</span></span><br><span class="line"><span class="comment"># 1: The &#x27;next post&#x27; will link to old post</span></span><br><span class="line"><span class="comment"># 2: The &#x27;next post&#x27; will link to new post</span></span><br><span class="line"><span class="comment"># false: disable pagination</span></span><br><span class="line"><span class="attr">post_pagination:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="2-6-文章分享"><a href="#2-6-文章分享" class="headerlink" title="2.6 文章分享"></a>2.6 文章分享</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Share.js</span></span><br><span class="line"><span class="comment"># https://github.com/overtrue/share.js</span></span><br><span class="line"><span class="attr">sharejs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sites:</span> <span class="string">qq,wechat,weibo,facebook,twitter</span></span><br></pre></td></tr></table></figure><p>在 head 里添加一些meta资料，例如缩略图、标题、时间等。当分享网页到一些平台时，平台会读取 Open Graph 的内容，展示缩略图，标题信息等等</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Open graph meta tags</span></span><br><span class="line"><span class="comment"># https://developers.facebook.com/docs/sharing/webmasters/</span></span><br><span class="line"><span class="attr">Open_Graph_meta:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="2-7-数学公式MathJax"><a href="#2-7-数学公式MathJax" class="headerlink" title="2.7 数学公式MathJax"></a>2.7 数学公式MathJax</h3><p>mathjax 是一个开源的 web 数学公式渲染器，由 JS 编写而成，它提供的书写方式和 LaTeX 的书写方式一样。</p><p><strong>（1）更换渲染插件</strong></p><p>Hexo 默认的渲染引擎是 marked，但 marked 不支持 mathjax，所以需要更换渲染引擎为 hexo-renderer-kramed，主要步骤如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --save # 卸载 marked  </span><br><span class="line">npm install hexo-renderer-kramed --save # 安装 kramed</span><br></pre></td></tr></table></figure><p>停用 hexo-math 并安装 mathjax</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-math --save # 卸载 hexo-math  </span><br><span class="line">npm install hexo-renderer-mathjax --save # 安装 mathjax</span><br></pre></td></tr></table></figure><p>打开 <code>/node_modules/hexo-renderer-kramed/lib/renderer.js</code>，进行如下修改：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// Change inline math rule  </span><br><span class="line">function formatText(text) &#123;  </span><br><span class="line">    // Fit kramed&#x27;s rule: $$ + \1 + $$  </span><br><span class="line"><span class="deletion">-   return text.replace(/`\$(.*?)\$`/g, &#x27;$$$$$1$$$$&#x27;); </span></span><br><span class="line"><span class="addition">+   return text;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更新 Mathjax 配置文件，打开 <code>/node_modules/hexo-renderer-mathjax/mathjax.html</code>，将最后一行的 <code>&lt;script&gt;</code> 改为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>更改默认转义规则，因为 LaTeX 与 markdown 语法有语义冲突，所以 hexo 默认的转义规则会将一些字符进行转义，我们需要对默认的规则进行修改。打开 <code>\node_modules\kramed\lib\rules\inline.js</code> ，将<code>var inline = &#123;&#125;</code> 中的属性 <code>escape</code> 和 <code>em</code> 参数更改如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">escape</span>: <span class="regexp">/^\\([`*\[\]()#$+\-.!_&gt;])/</span>,</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">em</span>: <span class="regexp">/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>,</span><br></pre></td></tr></table></figure><p>开启 mathjax，打开主题的 <code>_config.butterfly.yml</code> ，检索 <code>MathJax</code>，将 <code>enable</code> 参数设置为 <code>true</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MathJax  </span></span><br><span class="line"><span class="attr">mathjax:</span>  </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span>  </span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>配置成功后，需要渲染的文章开头，添加参数 <code>mathjax: true</code> 即可。</p><h2 id="三、博客美化"><a href="#三、博客美化" class="headerlink" title="三、博客美化"></a>三、博客美化</h2><h3 id="3-1-背景canvas-nest"><a href="#3-1-背景canvas-nest" class="headerlink" title="3.1 背景canvas_nest"></a>3.1 背景canvas_nest</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">canvas_nest:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&#x27;0,0,255&#x27;</span> <span class="comment">#color of lines, default: &#x27;0,0,0&#x27;; RGB values: (R,G,B).( <span class="doctag">note:</span> use &#x27;,&#x27; to separate.)</span></span><br><span class="line">  <span class="attr">opacity:</span> <span class="number">0.7</span> <span class="comment"># the opacity of line (0~1), default: 0.5.</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">-1</span> <span class="comment"># z-index property of the background, default: -1.</span></span><br><span class="line">  <span class="attr">count:</span> <span class="number">99</span> <span class="comment"># the number of lines,default: 99.</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment"># false 手机端不显示true 手机端显示</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-doc-canvas_nest.gif" alt=""></p><h3 id="3-2-打字烟花特效"><a href="#3-2-打字烟花特效" class="headerlink" title="3.2 打字烟花特效"></a>3.2 打字烟花特效</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Typewriter Effect (打字效果) </span></span><br><span class="line"><span class="comment"># https://github.com/disjukr/activate-power-mode </span></span><br><span class="line"><span class="attr">activate_power_mode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorful:</span> <span class="literal">true</span> <span class="comment"># open particle animation (冒光特效)</span></span><br><span class="line">  <span class="attr">shake:</span> <span class="literal">true</span> <span class="comment"># open shake (抖动特效)</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-doc-type-animation.gif" alt=""></p><h3 id="3-3-页面美化"><a href="#3-3-页面美化" class="headerlink" title="3.3 页面美化"></a>3.3 页面美化</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 美化页面显示</span></span><br><span class="line"><span class="attr">beautify:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># site/post</span></span><br><span class="line">  <span class="attr">title-prefix-icon:</span> <span class="string">&#x27;\f0c1&#x27;</span></span><br><span class="line">  <span class="attr">title-prefix-icon-color:</span> <span class="string">&quot;#F47466&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3-4-网站副标题打字效果"><a href="#3-4-网站副标题打字效果" class="headerlink" title="3.4 网站副标题打字效果"></a>3.4 网站副标题打字效果</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># the subtitle on homepage (主頁subtitle)</span></span><br><span class="line"><span class="attr">subtitle:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Typewriter Effect (打字效果)</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># loop (循環打字)</span></span><br><span class="line">  <span class="attr">loop:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># source 調用第三方服務</span></span><br><span class="line">  <span class="comment"># source: false 關閉調用</span></span><br><span class="line">  <span class="comment"># source: 1  調用一言網的一句話（簡體） https://hitokoto.cn/</span></span><br><span class="line">  <span class="comment"># source: 2  調用一句網（簡體） http://yijuzhan.com/</span></span><br><span class="line">  <span class="comment"># source: 3  調用今日詩詞（簡體） https://www.jinrishici.com/</span></span><br><span class="line">  <span class="comment"># subtitle 會先顯示 source , 再顯示 sub 的內容</span></span><br><span class="line">  <span class="attr">source:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># 如果關閉打字效果，subtitle 只會顯示 sub 的第一行文字</span></span><br><span class="line">  <span class="attr">sub:</span></span><br></pre></td></tr></table></figure><h3 id="3-5-访问人数busuanzi"><a href="#3-5-访问人数busuanzi" class="headerlink" title="3.5 访问人数busuanzi"></a>3.5 访问人数busuanzi</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">busuanzi:</span></span><br><span class="line">  <span class="attr">site_uv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">site_pv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">page_pv:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-doc-busuanzi-site-pv.png" alt=""></p><h3 id="3-6-运行时间"><a href="#3-6-运行时间" class="headerlink" title="3.6 运行时间"></a>3.6 运行时间</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Time difference between publish date and now (網頁運行時間)</span></span><br><span class="line"><span class="comment"># Formal: Month/Day/Year Time or Year/Month/Day Time</span></span><br><span class="line"><span class="attr">runtimeshow:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">publish_date:</span> <span class="number">2021</span><span class="string">/01/16</span> <span class="number">23</span><span class="string">:30:32</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-7-夜间模式"><a href="#3-7-夜间模式" class="headerlink" title="3.7 夜间模式"></a>3.7 夜间模式</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dark mode </span></span><br><span class="line"><span class="attr">darkmode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># dark mode和light mode切换按钮</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">autoChangeMode:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>配置项</th><th>说明</th></tr></thead><tbody><tr><td>autoChangeMode: 1</td><td>跟随系统而变化，不支持的浏览器/系统将按照时间晚上6点到早上6点之间切换为dark mode</td></tr><tr><td>autoChangeMode: 2</td><td>只按照时间晚上6点到早上6点之间切换为dark mode,其余时间为light mode</td></tr><tr><td>autoChangeMode: false</td><td>取消自动切换</td></tr></tbody></table></div><h3 id="3-8-阅读模式"><a href="#3-8-阅读模式" class="headerlink" title="3.8 阅读模式"></a>3.8 阅读模式</h3><p>阅读模式下会去掉除文章外的内容，避免干扰阅读。</p><p>只会出现在文章页面，右下角会有阅读模式按钮。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">readmode:</span>  <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="3-9-页脚添加Github-badge标签"><a href="#3-9-页脚添加Github-badge标签" class="headerlink" title="3.9 页脚添加Github-badge标签"></a>3.9 页脚添加Github-badge标签</h3><p><img src="https://img.mahaofei.com/img/20220411223909.png" alt=""></p><ol><li>首先到<a href="https://shields.io/">https://shields.io/</a>这个徽标生成网站生成Github-badge徽标。</li></ol><p><img src="https://img.mahaofei.com/img/20220411120309.png" alt=""></p><p>具体方法见网页，标签中用到的图标可以从<a href="https://simpleicons.org/">simpleicons</a>查询。</p><p>生成的链接都是这样的 → <a href="https://img.shields.io/badge/Hosted-Github-brightgreen?style=flat&amp;logo=GitHub">https://img.shields.io/badge/Hosted-Github-brightgreen?style=flat&amp;logo=GitHub</a><br>然后简单写一下html代码，为每个标签添加链接</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;margin-inline:5px&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/Hosted-Github-brightgreen?style=flat&amp;logo=GitHub&quot;</span> <span class="attr">title</span>=<span class="string">&quot;本站项目由Gtihub托管&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;margin-inline:5px&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://hexo.io/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo&quot;</span> <span class="attr">title</span>=<span class="string">&quot;博客框架为Hexo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;margin-inline:5px&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://butterfly.js.org/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/Theme-Butterfly-6513df?logoColor=white&amp;style=flat&amp;logo=buefy&quot;</span> <span class="attr">title</span>=<span class="string">&quot;主题采用butterfly&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;margin-inline:5px&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://aliyun.com/product/cdn&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/CDN-%E9%98%BF%E9%87%8C%E4%BA%91-orange?style=flat&amp;logo=alibabacloud&quot;</span> <span class="attr">title</span>=<span class="string">&quot;本站使用阿里云为静态资源提供CDN加速&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;margin-inline:5px&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://beian.miit.gov.cn/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/%E6%B4%A5ICP%E5%A4%87-2021000769%E5%8F%B7--2-red?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAACNlJREFUSInF1mmMVeUdx/Hv2e+5+519mJWBYQZkGxZZxLKJqBXGoLS1iXWrmihotFXaJiTWWlsbl6q1aetWd5u0VkKjNG4YEJSlOCibDLMwM8x679z9nnPP1jcVJUxf+7z6J8+LT37/Z4VvaQhfFS8+sBXbctCDGrVTKlBUH4mxAbI9Hfj0IJLsp6paJ5/tmn20N/D0wKDRMq9F/c3M2U1/V0vDfWMFh+tv/Ig1zYPMabDImPJ52OaXO87W580KggCiiOsJOJ6I3wcNFaaeNKxrt72f2fLGu4FpJ/sDQABRzD22fH7/Yze069vGc6mrDLNIJCDik10sxz2by3VdPM87xzkP9jwPTZFRVI1YUJKH+oy7n3tbvv/P2wW/UQxRWe6w4ZJRptYLHDoCuz8v5cP92XbI762O+h6UVWHnUFbPpU0fEb2A60mMJ7MUi9b/b7UgKhiZMaIxm8YLplLMDPz8hl/EH+rs8TNlUpFf32uyZJGLPDwCiTGUyTWodTN49eUCdz2YwXb9NNcObp1X98WDoufynzMVCEKGn27ayPTWBi5ad8P5iQUkJEnFLjqM9Z+hrVX0vfDe6K2dPRWsW2bwyp9EUifSJB84gdxrkR0eRgv1o/3I4fbbprJ6scqamzVO9pffec1S5ZWY2Nfz5qEy/FqOC2Y3s3j53HMSi18VRjFPwSwg+1RfVbl115vvJrsfej7UGIsYPPGgQ7JXoO+Xx5B3dHEomyJ9x1qiQozkr95h5937aFnVyouPlgJK+Ss7Fxz64OTSxSX+LHYxT2IsRW5kbGI4oHcR0jqoqTjV9se3I7/f8rS/ClS23GxSXhph6L5d9Akm7qqZhHWBQGUJ+CWGFzcg7e7m6D3/ZuW1Ea5YKdA3EojuONi813TqNi+YPYOKUhXDtCeGL26/hakLLiEcdsaHRkRAoLRc4fJrmhnekyF0apgZowWSwwkaa+rw3f8WA1GZZsPP5JEChX8dhZTN6iU6kAcs5s+dHd183SJ0VVKL57pfw6YdRQw23aeWTns47DPTALWlRTR7kMLew6hGgYqUhWXYFFUdPZ6lUBahLA8hVcOftckfi7No7VRAAQqsX1dybfvG1qwriM9mM5mJ4e4jO5Cc01dPqixbr8tWGBQUL4vjGigEEShi+xUmZ2RiR/sJ1pbS8NkgZrKAGw0TsgQsQyFaF/nfYTGprAlMFysbA1pI3mhkR6snhGsaymYGvPyFEb9IdbUE2AzFFTwpRqCtBY0wmdER+hZW4j63gcJj38V+/ErSUZXsYBfjIZHIRW0c2Z8BskCAqN+CbBJBFnyyKjR+Ez57nBxLqpfMUeSISElMBFz6x2Q6OxzWrYjyxWVzEewioU3LCS5vQY6nMUrLwNaxXvoQ59IloFSx54PPAZtQLExVZZDxsVE8J4dn6v4JYatgbSjk0owPw7RGH2ADMo88Z7L20ip8f7gC7fAo0q4+0rt7kEQDvaghVZbiPHUHcyeXcfLjT3jmpR7AYsnSScya3UR8bARVMck7Y/cB75/X6rDf3Fg2dw2jKZm5dXGm1LuAzO5DCo9v6aT0ibco5kzOvLOP+NGTFJtDpPYeZKijk/Rn3QxsfZV7txwhX7ABiZUXBsGvIvguQApNQQva9RMmTvZ2dpVUls+tX/UD7GN/Y8Ws05w6rQF+9vyzg1vZjbvMRJhXiRSU8DpTFFe0QE8S6SfPkOkZoktrB2oAhZWrwljxOPmchiSMYOWNoxNuruFU5vWeXdsojiUon345113dBBQBmTYlTimgdB8nfPo4WjaNFgN9OMEkJ02dnadVt5ki54Esqy+bzKJltVhSPbI3iN2zCyMTeXNCuG7Omm2Zok7PR2+R7jvD8ouruHhmCrB5jVZeYxLdrTP4sr4Vtd9g4MA4qc4c+6cu5NPamfw4P59t2WrA4YdXKkASf7SFivo6PDdEPmf1fRM++zp1bH/0r4I1dD1ODtOWaW4IsvPjL7nqXhloQiSPwjjgMYkMASyGEBkjhISCQwkwzve/18AbT+pk8pVY4UacQi9y+gyZ0eRAw4qHa89LXEx1LXMSPfhDJYRb59BtlLKg2WPT2l6qYl1svtGkrLYckyA1S+t5+2ATm37WCui0LSynsckDNH5zTxAchbQtkx08hDHYiW6NgC0enHBzEZ102UDH8QORdEckjEzZrNWkRydzyx17uGnDXqbUnGZ6dRPjSY91q2TqwjFuvTxLo5Zn5Qo/pumRSFcTLQtybEhGE0fQrDhhJ0VvH2lTnnHPhGtsmWan469apERjI2MH3qN7+7MEfH6ql29CbV7PvsMG32k6yU2XDhEKyZw66eJaRdrXR7CzCcqUNC3zwgymPJRCH4KRRLINimpL14A5Y4GDeOqbsPRVcfuN7Xj44pav/hFfrNT2kr2rsqf2Ibp5pEA14ZIImUyW3t5REkkTXRGQ/DGGhtLginhqCWknQDE5hKf5UFSF9Lj020Q2ul5V1AR2hr+8vuP8Vlc2zMPRxoSjnx7XBC14sDoydahSGq7KdO/HFyrBchxCVfX4fDKp4T7SCQejYODZLrYgIqgKFsNIgQqEYob8mW6yiUyb7Z64LVK/+B85xznnJ3AWzqTzuIX46mr5wLs+UUTyIriBCjRNxguHMJIFDLEEvXEOVRWnSJ0+jCd4CJoGjoedM1CLcXQziW3nMV2TSMBeOx7vWZvPt1r+cMPzE8KunaUkFn0vNrvtqXj34c1W6gzxlEQ6naIoBahtnkMwoFMwIVzSRNguMt53Aj2s4nkSlgPoGqLkICsRNF0gl8rYWuP8+11/w/OOJDEhHPKLCIpOXmi+M9AgP+maiesLifF2T1Rn5ZNj5Lo/Qc/GcPMmhdoqlEgIGzCK4PiCmJKK68p4KfF3qYGuF0qCRUkJTzleUbvQyWRTuE5xYthxQbBs7EISAbkzUFG3VfXXbK2YFi3X/eryfKKnqVBItNjJxDzH8erddC4SqWwcN5WyTtlyO1RP/Lh3eHD76MB40swmiDVJyDLYRhpc5+ub6tse/wWKbvSQEAw1awAAAABJRU5ErkJggg==&quot;</span> <span class="attr">title</span>=<span class="string">&quot;备案号:津ICP备-2021000769号--2&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;margin-inline:5px&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://tongji.baidu.com/web/10000399748/overview/index?siteId=17522448&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/%E7%99%BE%E5%BA%A6-%E7%BB%9F%E8%AE%A1-blue?style=flat&amp;logo=baidu&quot;</span> <span class="attr">title</span>=<span class="string">&quot;本站采用百度统计进行网站管理与维护&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;margin-inline:5px&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://creativecommons.org/licenses/by-nc-sa/4.0/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris&quot;</span> <span class="attr">title</span>=<span class="string">&quot;本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>到<a href="http://tool.ggo.net/htmlpack/">HTML压缩网站</a>将代码压缩成一行，复制到footer属性中就完成Github-badge效果了</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Footer Settings</span></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">since:</span> <span class="number">2021</span></span><br><span class="line">  <span class="attr">custom_text:</span> <span class="string">&lt;p&gt;&lt;a</span> <span class="string">style=&quot;margin-inline:5px&quot;target=&quot;_blank&quot;href=&quot;https://github.com/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Hosted-Github-brightgreen?style=flat&amp;logo=GitHub&quot;title=&quot;本站项目由Gtihub托管&quot;&gt;&lt;/a&gt;&lt;a</span> <span class="string">style=&quot;margin-inline:5px&quot;target=&quot;_blank&quot;href=&quot;https://hexo.io/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo&quot;title=&quot;博客框架为Hexo&quot;&gt;&lt;/a&gt;&lt;a</span> <span class="string">style=&quot;margin-inline:5px&quot;target=&quot;_blank&quot;href=&quot;https://butterfly.js.org/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Theme-Butterfly-6513df?logoColor=white&amp;style=flat&amp;logo=buefy&quot;title=&quot;主题采用butterfly&quot;&gt;&lt;/a&gt;&lt;a</span> <span class="string">style=&quot;margin-inline:5px&quot;target=&quot;_blank&quot;href=&quot;https://aliyun.com/product/cdn&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/CDN-%E9%98%BF%E9%87%8C%E4%BA%91-orange?style=flat&amp;logo=alibabacloud&quot;title=&quot;本站使用阿里云为静态资源提供CDN加速&quot;&gt;&lt;/a&gt;&lt;a</span> <span class="string">style=&quot;margin-inline:5px&quot;target=&quot;_blank&quot;href=&quot;https://beian.miit.gov.cn/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/%E6%B4%A5ICP%E5%A4%87-2021000769%E5%8F%B7--2-red?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAACNlJREFUSInF1mmMVeUdx/Hv2e+5+519mJWBYQZkGxZZxLKJqBXGoLS1iXWrmihotFXaJiTWWlsbl6q1aetWd5u0VkKjNG4YEJSlOCibDLMwM8x679z9nnPP1jcVJUxf+7z6J8+LT37/Z4VvaQhfFS8+sBXbctCDGrVTKlBUH4mxAbI9Hfj0IJLsp6paJ5/tmn20N/D0wKDRMq9F/c3M2U1/V0vDfWMFh+tv/Ig1zYPMabDImPJ52OaXO87W580KggCiiOsJOJ6I3wcNFaaeNKxrt72f2fLGu4FpJ/sDQABRzD22fH7/Yze069vGc6mrDLNIJCDik10sxz2by3VdPM87xzkP9jwPTZFRVI1YUJKH+oy7n3tbvv/P2wW/UQxRWe6w4ZJRptYLHDoCuz8v5cP92XbI762O+h6UVWHnUFbPpU0fEb2A60mMJ7MUi9b/b7UgKhiZMaIxm8YLplLMDPz8hl/EH+rs8TNlUpFf32uyZJGLPDwCiTGUyTWodTN49eUCdz2YwXb9NNcObp1X98WDoufynzMVCEKGn27ayPTWBi5ad8P5iQUkJEnFLjqM9Z+hrVX0vfDe6K2dPRWsW2bwyp9EUifSJB84gdxrkR0eRgv1o/3I4fbbprJ6scqamzVO9pffec1S5ZWY2Nfz5qEy/FqOC2Y3s3j53HMSi18VRjFPwSwg+1RfVbl115vvJrsfej7UGIsYPPGgQ7JXoO+Xx5B3dHEomyJ9x1qiQozkr95h5937aFnVyouPlgJK+Ss7Fxz64OTSxSX+LHYxT2IsRW5kbGI4oHcR0jqoqTjV9se3I7/f8rS/ClS23GxSXhph6L5d9Akm7qqZhHWBQGUJ+CWGFzcg7e7m6D3/ZuW1Ea5YKdA3EojuONi813TqNi+YPYOKUhXDtCeGL26/hakLLiEcdsaHRkRAoLRc4fJrmhnekyF0apgZowWSwwkaa+rw3f8WA1GZZsPP5JEChX8dhZTN6iU6kAcs5s+dHd183SJ0VVKL57pfw6YdRQw23aeWTns47DPTALWlRTR7kMLew6hGgYqUhWXYFFUdPZ6lUBahLA8hVcOftckfi7No7VRAAQqsX1dybfvG1qwriM9mM5mJ4e4jO5Cc01dPqixbr8tWGBQUL4vjGigEEShi+xUmZ2RiR/sJ1pbS8NkgZrKAGw0TsgQsQyFaF/nfYTGprAlMFysbA1pI3mhkR6snhGsaymYGvPyFEb9IdbUE2AzFFTwpRqCtBY0wmdER+hZW4j63gcJj38V+/ErSUZXsYBfjIZHIRW0c2Z8BskCAqN+CbBJBFnyyKjR+Ez57nBxLqpfMUeSISElMBFz6x2Q6OxzWrYjyxWVzEewioU3LCS5vQY6nMUrLwNaxXvoQ59IloFSx54PPAZtQLExVZZDxsVE8J4dn6v4JYatgbSjk0owPw7RGH2ADMo88Z7L20ip8f7gC7fAo0q4+0rt7kEQDvaghVZbiPHUHcyeXcfLjT3jmpR7AYsnSScya3UR8bARVMck7Y/cB75/X6rDf3Fg2dw2jKZm5dXGm1LuAzO5DCo9v6aT0ibco5kzOvLOP+NGTFJtDpPYeZKijk/Rn3QxsfZV7txwhX7ABiZUXBsGvIvguQApNQQva9RMmTvZ2dpVUls+tX/UD7GN/Y8Ws05w6rQF+9vyzg1vZjbvMRJhXiRSU8DpTFFe0QE8S6SfPkOkZoktrB2oAhZWrwljxOPmchiSMYOWNoxNuruFU5vWeXdsojiUon345113dBBQBmTYlTimgdB8nfPo4WjaNFgN9OMEkJ02dnadVt5ki54Esqy+bzKJltVhSPbI3iN2zCyMTeXNCuG7Omm2Zok7PR2+R7jvD8ouruHhmCrB5jVZeYxLdrTP4sr4Vtd9g4MA4qc4c+6cu5NPamfw4P59t2WrA4YdXKkASf7SFivo6PDdEPmf1fRM++zp1bH/0r4I1dD1ODtOWaW4IsvPjL7nqXhloQiSPwjjgMYkMASyGEBkjhISCQwkwzve/18AbT+pk8pVY4UacQi9y+gyZ0eRAw4qHa89LXEx1LXMSPfhDJYRb59BtlLKg2WPT2l6qYl1svtGkrLYckyA1S+t5+2ATm37WCui0LSynsckDNH5zTxAchbQtkx08hDHYiW6NgC0enHBzEZ102UDH8QORdEckjEzZrNWkRydzyx17uGnDXqbUnGZ6dRPjSY91q2TqwjFuvTxLo5Zn5Qo/pumRSFcTLQtybEhGE0fQrDhhJ0VvH2lTnnHPhGtsmWan469apERjI2MH3qN7+7MEfH6ql29CbV7PvsMG32k6yU2XDhEKyZw66eJaRdrXR7CzCcqUNC3zwgymPJRCH4KRRLINimpL14A5Y4GDeOqbsPRVcfuN7Xj44pav/hFfrNT2kr2rsqf2Ibp5pEA14ZIImUyW3t5REkkTXRGQ/DGGhtLginhqCWknQDE5hKf5UFSF9Lj020Q2ul5V1AR2hr+8vuP8Vlc2zMPRxoSjnx7XBC14sDoydahSGq7KdO/HFyrBchxCVfX4fDKp4T7SCQejYODZLrYgIqgKFsNIgQqEYob8mW6yiUyb7Z64LVK/+B85xznnJ3AWzqTzuIX46mr5wLs+UUTyIriBCjRNxguHMJIFDLEEvXEOVRWnSJ0+jCd4CJoGjoedM1CLcXQziW3nMV2TSMBeOx7vWZvPt1r+cMPzE8KunaUkFn0vNrvtqXj34c1W6gzxlEQ6naIoBahtnkMwoFMwIVzSRNguMt53Aj2s4nkSlgPoGqLkICsRNF0gl8rYWuP8+11/w/OOJDEhHPKLCIpOXmi+M9AgP+maiesLifF2T1Rn5ZNj5Lo/Qc/GcPMmhdoqlEgIGzCK4PiCmJKK68p4KfF3qYGuF0qCRUkJTzleUbvQyWRTuE5xYthxQbBs7EISAbkzUFG3VfXXbK2YFi3X/eryfKKnqVBItNjJxDzH8erddC4SqWwcN5WyTtlyO1RP/Lh3eHD76MB40swmiDVJyDLYRhpc5+ub6tse/wWKbvSQEAw1awAAAABJRU5ErkJggg==&quot;title=&quot;备案号:津ICP备-2021000769号-2&quot;&gt;&lt;/a&gt;&lt;a</span> <span class="string">style=&quot;margin-inline:5px&quot;target=&quot;_blank&quot;href=&quot;https://tongji.baidu.com/web/10000399748/overview/index?siteId=17522448&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/%E7%99%BE%E5%BA%A6-%E7%BB%9F%E8%AE%A1-blue?style=flat&amp;logo=baidu&quot;title=&quot;本站采用百度统计进行网站管理与维护&quot;&gt;&lt;/a&gt;&lt;a</span> <span class="string">style=&quot;margin-inline:5px&quot;target=&quot;_blank&quot;href=&quot;http://creativecommons.org/licenses/by-nc-sa/4.0/&quot;&gt;&lt;img</span> <span class="string">src=&quot;https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris&quot;title=&quot;本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可&quot;&gt;&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line">  <span class="attr">copyright:</span> <span class="literal">false</span> <span class="comment"># Copyright of theme and framework</span></span><br></pre></td></tr></table></figure><h3 id="3-10-评论系统valine"><a href="#3-10-评论系统valine" class="headerlink" title="3.10 评论系统valine"></a>3.10 评论系统valine</h3><p><strong>开启评论</strong></p><p>在主题配置文件的<code>comments</code>中填写需要用的评论</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="comment"># Up to two comments system, the first will be shown as default</span></span><br><span class="line">  <span class="comment"># Choose: Disqus/Disqusjs/Livere/Gitalk/Valine/Waline/Utterances/Facebook Comments/Twikoo/Giscus</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">Valine</span> <span class="comment"># Valine,Disqus</span></span><br><span class="line">  <span class="attr">text:</span> <span class="literal">true</span> <span class="comment"># Display the comment name next to the button</span></span><br><span class="line">  <span class="comment"># lazyload: The comment system will be load when comment element enters the browser&#x27;s viewport.</span></span><br><span class="line">  <span class="comment"># If you set it to true, the comment count will be invalid</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">true</span> <span class="comment"># Display comment count in post&#x27;s top_img</span></span><br><span class="line">  <span class="attr">card_post_count:</span> <span class="literal">false</span> <span class="comment"># Display comment count in Home Page</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>参数</th><th>解释</th></tr></thead><tbody><tr><td>use</td><td>使用的评论（请注意，最多支持两个，如果不需要请留空）</td></tr><tr><td>text</td><td>是否显示评论服务商的名字</td></tr><tr><td>lazyload</td><td>是否为评论开启lazyload，开启后，只有滚动到评论位置时才会加载评论所需要的资源（开启lazyload后，评论数将不显示）</td></tr><tr><td>count</td><td>是否在文章顶部显示评论数(livere、Giscus 和utterances 不支持评论数显示)</td></tr><tr><td>card_post_count</td><td>是否在首页文章卡片显示评论数(gitalk、livere 、Giscus 和utterances 不支持评论数显示)</td></tr></tbody></table></div><p><strong>配置Valine</strong></p><p>参考<a href="https://valine.js.org/quickstart.html">Valine文档</a>与<a href="https://github.com/xCss/Valine">Github项目</a></p><ol><li>注册LeanCloud：<a href="https://leancloud.cn/dashboard/login.html#/signup">国内版</a>注册使用需要域名备案，如果域名没有备案请使用<a href="https://console.leancloud.app/register">国际版</a>。</li><li>进入控制台，点击左下角创建应用</li></ol><p><img src="https://img.mahaofei.com/img/20220410162655.png" alt=""></p><ol><li>应用创建好后，进入应用界面，点击左下角的【设置-应用凭证】，可以看到APPID</li></ol><p><img src="https://img.mahaofei.com/img/20220410162923.png" alt=""></p><ol><li><p>将APPID和APPKey复制到主题配置文件的<code>valine</code>下</p></li><li><p>重新部署自己的网站，就可以看到评论系统了</p></li><li><p>在LeanCloud中：<code>登录&gt;选择你创建的应用&gt;存储&gt;选择Class Comment</code>，然后就可以管理评论了</p></li></ol><p><strong>Valine高级配置</strong></p><ol><li>头像配置</li></ol><div class="table-container"><table><thead><tr><th>参数值</th><th>表现形式</th><th>备注</th></tr></thead><tbody><tr><td>空字符串<code>&#39;&#39;</code></td><td><img src="https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40" alt="Gravatar官方图形"></td><td>Gravatar官方图形</td></tr><tr><td><code>mp</code></td><td><img src="https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&amp;d=mp" alt="神秘人(一个灰白头像)"></td><td>神秘人(一个灰白头像)</td></tr><tr><td><code>identicon</code></td><td><img src="https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&amp;d=identicon" alt="抽象几何图形"></td><td>抽象几何图形</td></tr><tr><td><code>monsterid</code></td><td><img src="https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&amp;d=monsterid" alt="小怪物"></td><td>小怪物</td></tr><tr><td><code>wavatar</code></td><td><img src="https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&amp;d=wavatar" alt="用不同面孔和背景组合生成的头像"></td><td>用不同面孔和背景组合生成的头像</td></tr><tr><td><code>retro</code></td><td><img src="https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&amp;d=retro" alt="八位像素复古头像"></td><td>八位像素复古头像</td></tr><tr><td><code>robohash</code></td><td><img src="https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&amp;d=robohash" alt="机器人"></td><td>一种具有不同颜色、面部等的机器人</td></tr><tr><td><code>hide</code></td><td></td><td>不显示头像</td></tr></tbody></table></div><ol><li>自定义表情</li></ol><p>在Hexo根目录下的<code>source/_data/</code>下创建一个<code>valine.json</code>文件，文件内容为自定义表情，比如我们要用<code>Bilibili</code>的表情包(效果可以在评论区查看):</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line"><span class="attr">&quot;tv_doge&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_亲亲&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;a8111ad55953ef5e3be3327ef94eb4a39d535d06.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_偷笑&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bb690d4107620f1c15cff29509db529a73aee261.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_再见&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_冷漠&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_发怒&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_发财&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;34db290afd2963723c6eb3c4560667db7253a21a.png&quot;</span><span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_可爱&quot;</span> <span class="punctuation">:</span><span class="string">&quot;9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_吐血&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;09dd16a7aa59b77baa1155d47484409624470c77.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_呆&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_呕吐&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;9f996894a39e282ccf5e66856af49483f81870f3.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_困&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;241ee304e44c0af029adceb294399391e4737ef2.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_坏笑&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1f0b87f731a671079842116e0991c91c2c88645a.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_大佬&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;093c1e2c490161aca397afc45573c877cdead616.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_大哭&quot;</span> <span class="punctuation">:</span><span class="string">&quot;23269aeb35f99daee28dda129676f6e9ea87934f.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_委屈&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_害羞&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_尴尬&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_微笑&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_思考&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;90cf159733e558137ed20aa04d09964436f618a1.png&quot;</span> <span class="punctuation">,</span> </span><br><span class="line"><span class="attr">&quot;tv_惊吓&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;0d15c7e2ee58e935adc6a7193ee042388adc22af.png&quot;</span></span><br><span class="line"><span class="comment">// 更多表情</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>主页显示最近评论</strong><br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Aside widget - Newest Comments </span></span><br><span class="line"><span class="attr">newest_comments :</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">sort_order :</span> <span class="comment"># Don &#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">storage:</span> <span class="number">10</span> <span class="comment"># unit: mins, save data to localStorage</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/hexo-theme-butterfly-docs-newest-comments.png" alt=""></p><h3 id="3-11-评论系统twikoo"><a href="#3-11-评论系统twikoo" class="headerlink" title="3.11 评论系统twikoo"></a>3.11 评论系统twikoo</h3><p><strong>配置云环境</strong></p><ol><li><p>打开腾讯云，<a href="https://console.cloud.tencent.com/tcb/env/login?rid=4">创建云环境</a></p><blockquote><p>应用模板：选择空模板，套餐选择包月免费套餐<br>环境信息：推荐创建上海环境。如选择广州环境，需要在 <code>twikoo.init()</code> 时额外指定环境 <code>region: &quot;ap-guangzhou&quot;</code>； 环境名称自由填写；推荐选择计费方式<code>包年包月</code>，套餐版本<code>免费版</code><br><img src="https://img.mahaofei.com/img/20220412085817.png" alt=""></p></blockquote></li><li><p>进入【控制台-登录授权】，开启【匿名登陆】</p></li></ol><p><img src="https://img.mahaofei.com/img/20220412090355.png" alt=""></p><ol><li>进入【控制台-安全配置】，添加自己的域名和<code>localhost:4000</code><blockquote><p>当你的博客使用了二级域名的场合，需要将完整的二级域名填入，而不是只填入主域名。</p></blockquote></li></ol><ol><li>进入【控制台-云函数】，新建云函数</li></ol><p><img src="https://img.mahaofei.com/img/20220412090822.png" alt=""></p><ol><li><ol><li>函数名称请填写：<code>twikoo</code>，创建方式请选择：<code>空白函数</code>，运行环境请选择：<code>Nodejs 10.15</code>，函数内存请选择：<code>128MB</code>，点击“下一步”</li></ol></li></ol><p><img src="https://img.mahaofei.com/img/20220412090902.png" alt=""></p><ol><li>清空输入框中的示例代码，复制以下代码、粘贴到“函数代码”输入框中，点击“确定”</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exports.main = require(&#x27;twikoo-func&#x27;).main</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220412091047.png" alt=""></p><ol><li>创建完成后，点击“twikoo”进入云函数详情页，进入“函数代码”标签，点击“文件 - 新建文件”，输入 <code>package.json</code>，复制以下代码、粘贴到代码框中，点击“保存并安装依赖”</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;dependencies&quot;: &#123; &quot;twikoo-func&quot;: &quot;1.5.3&quot; &#125; &#125;</span><br></pre></td></tr></table></figure><p><img src="https://img.mahaofei.com/img/20220412091344.png" alt=""></p><p><strong>Butterfly配置</strong></p><p>首先再主题配置文件中启用twikoo评论</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comments System</span></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="comment"># Up to two comments system, the first will be shown as default</span></span><br><span class="line">  <span class="comment"># Choose: Disqus/Disqusjs/Livere/Gitalk/Valine/Waline/Utterances/Facebook Comments/Twikoo/Giscus</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">twikoo</span> <span class="comment"># Valine,Disqus</span></span><br><span class="line">  <span class="attr">text:</span> <span class="literal">true</span> <span class="comment"># Display the comment name next to the button</span></span><br><span class="line">  <span class="comment"># lazyload: The comment system will be load when comment element enters the browser&#x27;s viewport.</span></span><br><span class="line">  <span class="comment"># If you set it to true, the comment count will be invalid</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">true</span> <span class="comment"># Display comment count in post&#x27;s top_img</span></span><br><span class="line">  <span class="attr">card_post_count:</span> <span class="literal">false</span> <span class="comment"># Display comment count in Home Page</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>进入【环境总览】，复制环境ID到主题配置文件的twikoo配置项中，这时使用<code>hexo clean &amp; hexo s</code>就可以看到twikoo评论框了</p><p>下载私钥，然后用记事本打开私钥文件，将内容复制。</p><p><img src="https://img.mahaofei.com/img/20220412091956.png" alt=""></p><p>打开<code>http://localhost:4000/</code>，再twikoo右下角点击齿轮，输入复制的密钥，并设置密码，即可完成注册</p><p><img src="https://img.mahaofei.com/img/20220412092724.png" alt=""></p><p>大功告成！</p><p><img src="https://img.mahaofei.com/img/20220412094538.png" alt=""></p><h3 id="3-12-Artitalk说说"><a href="#3-12-Artitalk说说" class="headerlink" title="3.12 Artitalk说说"></a>3.12 Artitalk说说</h3><ol><li>前往 <a href="https://leancloud.app/">LeanCloud 国际版</a>，注册账号。</li><li>注册完成之后根据 LeanCloud 的提示绑定手机号和邮箱。</li><li>绑定完成之后点击<code>创建应用</code>，应用名称随意，接着在<code>结构化数据</code>中创建 <code>class</code>，命名为 <code>shuoshuo</code>。</li><li>在你新建的应用中找到<code>结构化数据</code>下的<code>用户</code>。点击<code>添加用户</code>，输入想用的用户名及密码。</li><li>回到<code>结构化数据</code>中，点击 <code>class</code> 下的 <code>shuoshuo</code>。找到权限，在 <code>Class 访问权限</code>中将 <code>add_fields</code> 以及 <code>create</code> 权限设置为指定用户，输入你刚才输入的用户名会自动匹配。为了安全起见，将 <code>delete</code> 和 <code>update</code> 也设置为跟它们一样的权限。</li><li>然后新建一个名为<code>atComment</code>的class，权限什么的使用默认的即可。</li><li>点击 <code>class</code> 下的 <code>_User</code> 添加列，列名称为 <code>img</code>，默认值填上你这个账号想要用的发布说说的头像url，这一项不进行配置，说说头像会显示为默认头像 —— Artitalk 的 logo。</li><li>在最菜单栏中找到设置-&gt; 应用 keys，记下来 <code>AppID</code> 和 <code>AppKey</code> ，一会会用。</li><li>最后将 <code>_User</code> 中的权限全部调为指定用户，或者数据创建者，为了保证不被篡改用户数据以达到强制发布说说。</li><li>安装<code>hexo-butterfly-artitalk</code>插件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-artitalk</span><br></pre></td></tr></table></figure><ol><li>在主题配置文件中添加如下配置</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Artitalk</span></span><br><span class="line"><span class="comment"># see https://artitalk.js.org/</span></span><br><span class="line"><span class="attr">artitalk:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">appId:</span>  <span class="comment"># 【必须】LeanCloud 创建应用中的 AppID</span></span><br><span class="line">  <span class="attr">appKey:</span>  <span class="comment"># 【必须】LeanCloud 创建应用中的 AppKEY</span></span><br><span class="line">  <span class="attr">path:</span>  <span class="comment"># 【任选】Artitalk的路径名称（默认为artitalk，生成的页面为artitalk/index.html）</span></span><br><span class="line">  <span class="attr">js:</span>  <span class="comment"># 【任选】更换Artitalk的js CDN（默认为https://cdn.jsdelivr.net/npm/artitalk）</span></span><br><span class="line">  <span class="attr">option:</span>  <span class="comment"># 【任选】Artitalk 需要的额外配置</span></span><br><span class="line">  <span class="attr">front_matter:</span>  <span class="comment"># 【任选】Arttalk页面的front_matter配置</span></span><br></pre></td></tr></table></figure><ol><li>默认的访问网址：<code>/artitalk/index.html</code></li></ol><p><img src="https://img.mahaofei.com/img/20220412165755.png" alt=""></p><h3 id="3-13-动态分类条"><a href="#3-13-动态分类条" class="headerlink" title="3.13 动态分类条"></a>3.13 动态分类条</h3><p>参考<a href="https://blog.zhheo.com/p/bc61964d.html">【张洪老师的博客】</a>，分类的添加使用纯手工的方式。</p><p><img src="https://img.mahaofei.com/img/20220427195336.png" alt=""></p><p><strong>新建文件</strong></p><p>新建一个文件：<code>themes/butterfly/layout/includes/categoryBar.pug</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#category-bar</span><br><span class="line">    .category-bar-items#category-bar-items</span><br><span class="line">        .category-bar-item(id=&#x27;首页&#x27;)</span><br><span class="line">            a(href=&quot;/&quot;) 首页</span><br><span class="line">        .category-bar-item(id=&#x27;机器人&#x27;)</span><br><span class="line">            a(href=&quot;/categories/机器人/&quot;) 机器人</span><br><span class="line">        .category-bar-item(id=&#x27;程序设计&#x27;)</span><br><span class="line">            a(href=&quot;/categories/程序设计/&quot;) 程序设计</span><br><span class="line">        .category-bar-item(id=&#x27;嵌入式&#x27;)</span><br><span class="line">            a(href=&quot;/categories/嵌入式/&quot;) 嵌入式</span><br><span class="line">        .category-bar-item(id=&#x27;机械&#x27;)</span><br><span class="line">            a(href=&quot;/categories/机械/&quot;) 机械</span><br><span class="line">        .category-bar-item(id=&#x27;破解技巧&#x27;)</span><br><span class="line">            a(href=&quot;/categories/破解技巧/&quot;) 破解技巧</span><br><span class="line">        .category-bar-item(id=&#x27;随笔&#x27;)</span><br><span class="line">            a(href=&quot;/categories/随笔/&quot;) 随笔</span><br><span class="line">    a.category-bar-more(href=&quot;/categories/&quot;) 更多</span><br></pre></td></tr></table></figure><p><strong>引用文件</strong></p><p>编辑<code>themes/butterfly/layout/index.pug</code></p><p>在<code>+postUI</code>上一行添加<code>include includes/categoryBar.pug</code>，并保持缩进相同。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">extends includes/layout.pug</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  include ./includes/mixins/post-ui.pug</span><br><span class="line">  #recent-posts.recent-posts</span><br><span class="line">include includes/categoryBar.pug</span><br><span class="line">    +postUI</span><br><span class="line">    include includes/pagination.pug</span><br></pre></td></tr></table></figure><p>编辑<code>themes/butterfly/layout/category.pug</code>，在<code>#category</code>下方添加以下代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#category  </span><br><span class="line">  .category-in-bar  </span><br><span class="line">    .category-in-bar-tips  </span><br><span class="line">      | 分类  </span><br><span class="line">    include includes/categoryBar.pug</span><br></pre></td></tr></table></figure><p><strong>引用CSS和JS</strong></p><p>链接: <a href="https://pan.baidu.com/s/13iOkTwWDbtzlFzRLTdQl9Q?pwd=9e32">https://pan.baidu.com/s/13iOkTwWDbtzlFzRLTdQl9Q?pwd=9e32</a><br>提取码: 9e32</p><p>将其中的<code>MainColor.css</code>, <code>categoryBar.css</code>两个文件复制到<code>themes/butterfly/source/css</code>目录下，将<code>categoryBar.js</code>复制到<code>themes/butterfly/source/js</code>目录下，然后在主题配置文件<code>_config.yml</code>中引用这三个文件。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/categoryBar.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/MainColor.css&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/categoryBar.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-14-Butterfly首页隐藏文章"><a href="#3-14-Butterfly首页隐藏文章" class="headerlink" title="3.14 Butterfly首页隐藏文章"></a>3.14 Butterfly首页隐藏文章</h3><p>打开文件：<code>themes/butterfly/layout/includes/mixins/post-ui.pug</code></p><p>注意，主要是添加了<code>if article.hide !== true</code>这一行，然后这一行后全部需要按下tab缩进一层。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mixin postUI(posts)  </span><br><span class="line">  each article , index in page.posts.data  </span><br><span class="line">    if article.hide !== true  </span><br><span class="line">      .recent-post-item</span><br></pre></td></tr></table></figure><p>在md文件的头部信息中添加<code>hide: true</code></p><h3 id="3-15-相关推荐侧边栏化"><a href="#3-15-相关推荐侧边栏化" class="headerlink" title="3.15 相关推荐侧边栏化"></a>3.15 相关推荐侧边栏化</h3><p>参考文章：<a href="https://akilar.top/posts/194e1534/">《Butterfly 布局调整 ——— 相关推荐版块侧栏卡片化》</a></p><p><img src="https://img.mahaofei.com/img/20220428112259.png" alt=""></p><p>修改 <code>[Blogroot]\themes\butterfly\scripts\helpers\related_post.js</code>, 从大概 47 行开始到 70 行的部分。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (relatedPosts.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">    result += <span class="string">&#x27;&lt;div class=&quot;card-widget card-recommend-post&quot;&gt;&#x27;</span>  </span><br><span class="line">    result += <span class="string">`&lt;div class=&quot;item-headline&quot;&gt;&lt;i class=&quot;fas fa-dharmachakra&quot;&gt;&lt;/i&gt;&lt;span&gt;<span class="subst">$&#123;headlineLang&#125;</span>&lt;/span&gt;&lt;/div&gt;`</span>  </span><br><span class="line">    result += <span class="string">&#x27;&lt;div class=&quot;aside-list&quot;&gt;&#x27;</span>  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="title class_">Math</span>.<span class="title function_">min</span>(relatedPosts.<span class="property">length</span>, limitNum); i++) &#123;  </span><br><span class="line">      <span class="keyword">const</span> cover =  </span><br><span class="line">        relatedPosts[i].<span class="property">cover</span> === <span class="literal">false</span>  </span><br><span class="line">          ? relatedPosts[i].<span class="property">randomcover</span>  </span><br><span class="line">          : relatedPosts[i].<span class="property">cover</span>  </span><br><span class="line">      result += <span class="string">`&lt;div class=&quot;aside-list-item&quot;&gt;`</span>  </span><br><span class="line">      result += <span class="string">`&lt;a class=&quot;thumbnail&quot; href=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>.url_for(relatedPosts[i].path)&#125;</span>&quot; title=&quot;<span class="subst">$&#123;relatedPosts[i].title&#125;</span>&quot;&gt;&lt;img src=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>.url_for(cover)&#125;</span>&quot; alt=&quot;<span class="subst">$&#123;relatedPosts[i].title&#125;</span>&quot;&gt;&lt;/a&gt;`</span>  </span><br><span class="line">      result += <span class="string">`&lt;div class=&quot;content&quot;&gt;`</span>  </span><br><span class="line">      result += <span class="string">`&lt;a class=&quot;title&quot; href=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>.url_for(relatedPosts[i].path)&#125;</span>&quot; title=&quot;<span class="subst">$&#123;relatedPosts[i].title&#125;</span>&quot;&gt;<span class="subst">$&#123;relatedPosts[i].title&#125;</span>&lt;/a&gt;`</span>  </span><br><span class="line">      <span class="keyword">if</span> (dateType === <span class="string">&#x27;created&#x27;</span>) &#123;  </span><br><span class="line">        result += <span class="string">`&lt;time datetime=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>.date(relatedPosts[i].created, hexoConfig.date_format)&#125;</span>&quot; title=&quot;发表于 <span class="subst">$&#123;<span class="variable language_">this</span>.date(relatedPosts[i].created, hexoConfig.date_format)&#125;</span>&quot;&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.date(relatedPosts[i].created, hexoConfig.date_format)&#125;</span>&lt;/time&gt;`</span>  </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        result += <span class="string">`&lt;time datetime=&quot;<span class="subst">$&#123;<span class="variable language_">this</span>.date(relatedPosts[i].updated, hexoConfig.date_format)&#125;</span>&quot; title=&quot;发表于 <span class="subst">$&#123;<span class="variable language_">this</span>.date(relatedPosts[i].updated, hexoConfig.date_format)&#125;</span>&quot;&gt;<span class="subst">$&#123;<span class="variable language_">this</span>.date(relatedPosts[i].updated, hexoConfig.date_format)&#125;</span>&lt;/time&gt;`</span>  </span><br><span class="line">      &#125;  </span><br><span class="line">      result += <span class="string">`&lt;/div&gt;&lt;/div&gt;`</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">    result += <span class="string">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span>  </span><br><span class="line">    <span class="keyword">return</span> result  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>因为原本的版块是在文章下方，而现在我们需要把它改到侧栏。所以需要修改 <code>[Blogroot]\themes\butterfly\layout\post.pug</code> 大约 26 行的位置先移除在文章底部的推荐版块。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  if theme.post_pagination  </span><br><span class="line">    include includes/pagination.pug  </span><br><span class="line"><span class="deletion">- if theme.related_post &amp;&amp; theme.related_post.enable  </span></span><br><span class="line"><span class="deletion">-   != related_posts(page,site.posts)  </span></span><br><span class="line">  </span><br><span class="line">  if page.comments !== false &amp;&amp; theme.comments &amp;&amp; theme.comments.use</span><br></pre></td></tr></table></figure><p>然后修改 <code>[Blogroot]\themes\butterfly\layout\includes\widget\index.pug</code>, 这个文件每个版本都长得不太一样，这里仅供参考。因为感觉文章也最新文章和推荐文章同时存在，最新文章就显得有点多余了，所以我把最新文章的侧栏卡片注释了。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#aside-content.aside-content  </span><br><span class="line">  //- post  </span><br><span class="line">  if is_post()  </span><br><span class="line">    if showToc &amp;&amp; theme.toc.style_simple  </span><br><span class="line">      .sticky_layout  </span><br><span class="line">        include ./card_post_toc.pug  </span><br><span class="line">    else  </span><br><span class="line">      !=partial(&#x27;includes/custom/SAO_card_player&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)  </span><br><span class="line">      !=partial(&#x27;includes/widget/card_announcement&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)  </span><br><span class="line">      !=partial(&#x27;includes/widget/card_top_self&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)    </span><br><span class="line">      .sticky_layout  </span><br><span class="line">        if showToc  </span><br><span class="line">          include ./card_post_toc.pug  </span><br><span class="line"><span class="addition">+       if theme.related_post &amp;&amp; theme.related_post.enable  </span></span><br><span class="line"><span class="addition">+         != related_posts(page,site.posts)  </span></span><br><span class="line"><span class="deletion">-       - !=partial(&#x27;includes/widget/card_recent_post&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)  </span></span><br><span class="line"><span class="addition">+       //- !=partial(&#x27;includes/widget/card_recent_post&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)  </span></span><br><span class="line">        !=partial(&#x27;includes/widget/card_ad&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)</span><br></pre></td></tr></table></figure><p>改动完成后运行 <code>hexo clean</code>,<code>hexo generate</code>,<code>hexo server</code> 三件套就能看到完成效果了。</p><h3 id="3-16-侧边栏添加历史上的今天"><a href="#3-16-侧边栏添加历史上的今天" class="headerlink" title="3.16 侧边栏添加历史上的今天"></a>3.16 侧边栏添加历史上的今天</h3><p>在<code>[Blogroot]\themes\butterfly\layout\includes\widget\</code> 中新建一个<code>card_history.pug</code>文件，内容如下。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.card-widget.card-history</span><br><span class="line">  .card-content</span><br><span class="line">    .item-headline</span><br><span class="line">       i.fas.fa-clock.fa-spin</span><br><span class="line">       span= _p(&#x27;那年今日&#x27;)</span><br><span class="line">    #history-baidu(style=&#x27;height: 60px;overflow: hidden;&#x27;)</span><br><span class="line">      #history-container.history_swiper-container(style=&quot;width: 100%;height: 100%;&quot;)</span><br><span class="line">          #history_container_wrapper.swiper-wrapper(style=&quot;height:20px&quot; )</span><br></pre></td></tr></table></figure><p>修改位于 <code>[Blogroot]\themes\butterfly\layout\includes\widget\</code> 中的<code>index.pug</code>。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#aside-content.aside-content</span><br><span class="line">  //- post</span><br><span class="line">  if is_post()</span><br><span class="line">    - const tocStyle = page.toc_style_simple</span><br><span class="line">    - const tocStyleVal = tocStyle <span class="comment">=== true || tocStyle === false ? tocStyle : theme.toc.style_simple</span></span><br><span class="line">    if showToc &amp;&amp; tocStyleVal</span><br><span class="line">      .sticky_layout</span><br><span class="line">        include ./card_post_toc.pug</span><br><span class="line">    else</span><br><span class="line">      !=partial(&#x27;includes/widget/card_author&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_announcement&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_top_self&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      .sticky_layout</span><br><span class="line">        if showToc</span><br><span class="line">          include ./card_post_toc.pug</span><br><span class="line">        if theme.related_post &amp;&amp; theme.related_post.enable</span><br><span class="line"><span class="addition">+         !=partial(&#x27;includes/widget/card_history&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span></span><br><span class="line">          !=partial(&#x27;includes/widget/card_recent_post&#x27;, &#123;&#125;, &#123;cache:theme.fragment_cache&#125;)</span><br><span class="line">        !=partial(&#x27;includes/widget/card_ad&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">  else</span><br><span class="line">    //- page</span><br><span class="line">    !=partial(&#x27;includes/widget/card_author&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">    !=partial(&#x27;includes/widget/card_announcement&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">    !=partial(&#x27;includes/widget/card_top_self&#x27;, &#123;&#125;, &#123;cache: true&#125;)      </span><br><span class="line"></span><br><span class="line">    .sticky_layout</span><br><span class="line">      if showToc</span><br><span class="line">        include ./card_post_toc.pug</span><br><span class="line"><span class="addition">+     !=partial(&#x27;includes/widget/card_history&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span></span><br><span class="line">      !=partial(&#x27;includes/widget/card_recent_post&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_ad&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_newest_comment&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_categories&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_tags&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_archives&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_webinfo&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_bottom_self&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br></pre></td></tr></table></figure><p>打开 主题配置文件<code>_config.yml</code> 搜索到 <code>aside:</code> 处，添加开关：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">aside:</span>  </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span>  </span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">true</span> <span class="comment"># display on mobile  </span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">left</span> <span class="comment"># left or right  </span></span><br><span class="line">  <span class="attr">card_history:</span> <span class="comment"># 添加开关名称  </span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 打开card_history开关  </span></span><br><span class="line">  <span class="attr">card_author:</span>  </span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>然后搜索<code>inject:</code>，进行如下修改</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span>  </span><br><span class="line">  <span class="attr">head:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://unpkg.com/swiper/swiper-bundle.min.css&quot;&gt;</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css&quot;&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="attr">bottom:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://unpkg.com/swiper/swiper-bundle.min.js&quot;&gt;&lt;/script&gt;</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-17-白天-黑夜模式切换动画"><a href="#3-17-白天-黑夜模式切换动画" class="headerlink" title="3.17 白天/黑夜模式切换动画"></a>3.17 白天/黑夜模式切换动画</h3><p>参考<a href="https://akilar.top/posts/d9550c81/">《Akilarの糖果屋-添加白天夜间模式转换动画》</a></p><p>新建 <code>[Blogroot]\themes\butterfly\layout\includes\custom\light_dark.pug</code>, 这部分其实实质上就是一个 svg 文件，通过 js 操作它的旋转显隐，淡入淡出实现动画效果。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg(aria-hidden=&#x27;true&#x27;, style=&#x27;position:absolute; overflow:hidden; width:0; height:0&#x27;)  </span><br><span class="line">  symbol#icon-sun(viewBox=&#x27;0 0 1024 1024&#x27;)  </span><br><span class="line">    path(d=&#x27;M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z&#x27;, fill=&#x27;#FFD878&#x27;, p-id=&#x27;8420&#x27;)  </span><br><span class="line">    path(d=&#x27;M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z&#x27;, fill=&#x27;#FFE4A9&#x27;, p-id=&#x27;8421&#x27;)  </span><br><span class="line">    path(d=&#x27;M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z&#x27;, fill=&#x27;#4D5152&#x27;, p-id=&#x27;8422&#x27;)  </span><br><span class="line">    path(d=&#x27;M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z&#x27;, fill=&#x27;#4D5152&#x27;, p-id=&#x27;8423&#x27;)  </span><br><span class="line">  symbol#icon-moon(viewBox=&#x27;0 0 1024 1024&#x27;)  </span><br><span class="line">    path(d=&#x27;M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z&#x27;, fill=&#x27;#FFB531&#x27;, p-id=&#x27;11345&#x27;)  </span><br><span class="line">    path(d=&#x27;M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z&#x27;, fill=&#x27;#030835&#x27;, p-id=&#x27;11346&#x27;)</span><br></pre></td></tr></table></figure><p>新建 <code>[Blogroot]\themes\butterfly\source\css\_layout\light_dark.styl</code></p><figure class="highlight styl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.Cuteen_DarkSky</span>,  </span><br><span class="line"><span class="selector-class">.Cuteen_DarkSky</span><span class="selector-pseudo">:before</span>  </span><br><span class="line">  <span class="attribute">content</span> <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">  <span class="attribute">position</span> fixed  </span><br><span class="line">  <span class="attribute">left</span> <span class="number">0</span>  </span><br><span class="line">  <span class="attribute">right</span> <span class="number">0</span>  </span><br><span class="line">  <span class="attribute">top</span> <span class="number">0</span>  </span><br><span class="line">  <span class="attribute">bottom</span> <span class="number">0</span>  </span><br><span class="line">  <span class="attribute">z-index</span> <span class="number">88888888</span>  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.Cuteen_DarkSky</span>  </span><br><span class="line">  <span class="attribute">background</span> linear-gradient(<span class="number">#feb8b0</span>, <span class="number">#fef9db</span>)  </span><br><span class="line">  <span class="selector-pseudo">&amp;:before</span>  </span><br><span class="line">    <span class="attribute">transition</span> <span class="number">2s</span> ease all  </span><br><span class="line">    <span class="attribute">opacity</span> <span class="number">0</span>  </span><br><span class="line">    <span class="attribute">background</span> linear-gradient(<span class="number">#4c3f6d</span>, <span class="number">#6c62bb</span>, <span class="number">#93b1ed</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.DarkMode</span>  </span><br><span class="line">  <span class="selector-class">.Cuteen_DarkSky</span>  </span><br><span class="line">    <span class="selector-pseudo">&amp;:before</span>  </span><br><span class="line">      <span class="attribute">opacity</span> <span class="number">1</span>  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.Cuteen_DarkPlanet</span>  </span><br><span class="line">  <span class="attribute">z-index</span> <span class="number">99999999</span>  </span><br><span class="line">  <span class="attribute">position</span> fixed  </span><br><span class="line">  <span class="attribute">left</span> -<span class="number">50%</span>  </span><br><span class="line">  <span class="attribute">top</span> -<span class="number">50%</span>  </span><br><span class="line">  <span class="attribute">width</span> <span class="number">200%</span>  </span><br><span class="line">  <span class="attribute">height</span> <span class="number">200%</span>  </span><br><span class="line">  -webkit-<span class="attribute">animation</span> CuteenPlanetMove <span class="number">2s</span> cubic-bezier(<span class="number">0.7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)  </span><br><span class="line">  <span class="attribute">animation</span> CuteenPlanetMove <span class="number">2s</span> cubic-bezier(<span class="number">0.7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)  </span><br><span class="line">  <span class="attribute">transform-origin</span> center bottom  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> CuteenPlanetMove &#123;  </span><br><span class="line">  <span class="number">0%</span> &#123;  </span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">0</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  to &#123;  </span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">@keyframes</span> CuteenPlanetMove &#123;  </span><br><span class="line">  <span class="number">0%</span> &#123;  </span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">0</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">  to &#123;  </span><br><span class="line">    <span class="attribute">transform</span>: rotate(<span class="number">360deg</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="selector-class">.Cuteen_DarkPlanet</span>  </span><br><span class="line">  <span class="selector-pseudo">&amp;:after</span>  </span><br><span class="line">    <span class="attribute">position</span> absolute  </span><br><span class="line">    <span class="attribute">left</span> <span class="number">35%</span>  </span><br><span class="line">    <span class="attribute">top</span> <span class="number">40%</span>  </span><br><span class="line">    <span class="attribute">width</span> <span class="number">9.375rem</span>  </span><br><span class="line">    <span class="attribute">height</span> <span class="number">9.375rem</span>  </span><br><span class="line">    <span class="attribute">border-radius</span> <span class="number">50%</span>  </span><br><span class="line">    <span class="attribute">content</span> <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    <span class="attribute">background</span> linear-gradient(<span class="number">#fefefe</span>, <span class="number">#fffbe8</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.search</span>  </span><br><span class="line">  <span class="selector-tag">span</span>  </span><br><span class="line">    <span class="attribute">display</span> none  </span><br><span class="line">  </span><br><span class="line"><span class="selector-class">.menus_item</span>  </span><br><span class="line">  <span class="selector-tag">a</span>  </span><br><span class="line">    <span class="attribute">text-decoration</span> none<span class="meta">!important</span>  </span><br></pre></td></tr></table></figure><p>新建 <code>[Blogroot]\themes\butterfly\source\js\sun_moon.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">switchNightMode</span>(<span class="params"></span>) &#123;  </span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">insertAdjacentHTML</span>(<span class="string">&#x27;beforeend&#x27;</span>, <span class="string">&#x27;&lt;div class=&quot;Cuteen_DarkSky&quot;&gt;&lt;div class=&quot;Cuteen_DarkPlanet&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#x27;</span>),  </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;  </span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;DarkMode&#x27;</span>) ? (<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;DarkMode&#x27;</span>), <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;isDark&#x27;</span>, <span class="string">&#x27;0&#x27;</span>), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-moon&#x27;</span>)) : (<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;DarkMode&#x27;</span>), <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;isDark&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-sun&#x27;</span>)),  </span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;  </span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;Cuteen_DarkSky&#x27;</span>)[<span class="number">0</span>].<span class="property">style</span>.<span class="property">transition</span> = <span class="string">&#x27;opacity 3s&#x27;</span>;  </span><br><span class="line">          <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;Cuteen_DarkSky&#x27;</span>)[<span class="number">0</span>].<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;  </span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;  </span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;Cuteen_DarkSky&#x27;</span>)[<span class="number">0</span>].<span class="title function_">remove</span>();  </span><br><span class="line">          &#125;, <span class="number">1e3</span>);  </span><br><span class="line">        &#125;, <span class="number">2e3</span>)  </span><br><span class="line">    &#125;)  </span><br><span class="line">  <span class="keyword">const</span> nowMode = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>) === <span class="string">&#x27;dark&#x27;</span> ? <span class="string">&#x27;dark&#x27;</span> : <span class="string">&#x27;light&#x27;</span>  </span><br><span class="line">  <span class="keyword">if</span> (nowMode === <span class="string">&#x27;light&#x27;</span>) &#123;  </span><br><span class="line">    <span class="title function_">activateDarkMode</span>()  </span><br><span class="line">    saveToLocal.<span class="title function_">set</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;dark&#x27;</span>, <span class="number">2</span>)  </span><br><span class="line">    <span class="variable constant_">GLOBAL_CONFIG</span>.<span class="property">Snackbar</span> !== <span class="literal">undefined</span> &amp;&amp; btf.<span class="title function_">snackbarShow</span>(<span class="variable constant_">GLOBAL_CONFIG</span>.<span class="property">Snackbar</span>.<span class="property">day_to_night</span>)  </span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-sun&#x27;</span>)  </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    <span class="title function_">activateLightMode</span>()  </span><br><span class="line">    saveToLocal.<span class="title function_">set</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;light&#x27;</span>, <span class="number">2</span>)  </span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;DarkMode&#x27;</span>), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-moon&#x27;</span>)  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="comment">// handle some cases  </span></span><br><span class="line">  <span class="keyword">typeof</span> utterancesTheme === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="title function_">utterancesTheme</span>()  </span><br><span class="line">  <span class="keyword">typeof</span> <span class="variable constant_">FB</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="variable language_">window</span>.<span class="title function_">loadFBComment</span>()  </span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">DISQUS</span> &amp;&amp; <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;disqus_thread&#x27;</span>).<span class="property">children</span>.<span class="property">length</span> &amp;&amp; <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">disqusReset</span>(), <span class="number">200</span>)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改 <code>[Blogroot]\themes\butterfly\layout\includes\rightside.pug</code>, 把原本的昼夜切换按钮替换掉</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  when &#x27;translate&#x27;  </span><br><span class="line">    if translate.enable  </span><br><span class="line">      button#translateLink(type=&quot;button&quot; title=_p(&#x27;rightside.translate_title&#x27;))= translate.default  </span><br><span class="line">  when &#x27;darkmode&#x27;  </span><br><span class="line">    if darkmode.enable &amp;&amp; darkmode.button  </span><br><span class="line"><span class="deletion">-     button#darkmode(type=&quot;button&quot; title=_p(&#x27;rightside.night_mode_title&#x27;))  </span></span><br><span class="line"><span class="deletion">-       i.fas.fa-adjust  </span></span><br><span class="line"><span class="addition">+     a.hidden(onclick=&#x27;switchNightMode()&#x27;,  title=_p(&#x27;rightside.night_mode_title&#x27;))  </span></span><br><span class="line"><span class="addition">+       i.fas.fa-adjust  </span></span><br><span class="line"><span class="addition">+         use#modeicon(xlink:href=&#x27;#icon-moon&#x27;)</span></span><br></pre></td></tr></table></figure><p>修改 <code>[Blogroot]\_config.butterfly.yml</code>, 引入一下 js</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span>  </span><br><span class="line">  <span class="attr">head:</span>  </span><br><span class="line">  <span class="attr">bottome:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/sun_moon.js&quot;</span> <span class="string">async&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-18-twikoo评论气泡风格"><a href="#3-18-twikoo评论气泡风格" class="headerlink" title="3.18 twikoo评论气泡风格"></a>3.18 twikoo评论气泡风格</h3><p>参考<a href="https://akilar.top/posts/d99b5f01/">《Akilarの糖果屋-twikoo 评论块气泡风格魔改美化》</a></p><p>新建 <code>[Blogroot]\themes\butterfly\source\css\custom\twikoo_beautify.css</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 调整表情大小 */</span></span><br><span class="line"><span class="selector-class">.OwO</span> <span class="selector-class">.OwO-body</span> <span class="selector-class">.OwO-items-image</span> <span class="selector-class">.OwO-item</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="built_in">calc</span>(<span class="number">25%</span> - <span class="number">10px</span>) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 调整表情位置 */</span></span><br><span class="line"><span class="selector-class">.tk-content</span> <span class="selector-tag">img</span><span class="selector-class">.tk-owo-emotion</span> &#123;</span><br><span class="line">    <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自定义twikoo评论输入框高度 */</span></span><br><span class="line"><span class="selector-class">.tk-input</span><span class="selector-attr">[data-v-619b4c52]</span> <span class="selector-class">.el-textarea__inner</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">130px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输入评论时自动隐藏输入框背景图片 */</span></span><br><span class="line"><span class="selector-class">.tk-input</span><span class="selector-attr">[data-v-619b4c52]</span> <span class="selector-class">.el-textarea__inner</span><span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 调整楼中楼样式 ，整体左移，贴合气泡化效果 */</span></span><br><span class="line"><span class="selector-class">.tk-replies</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">70px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> + <span class="number">70px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 头像宽度调整 rem单位与全局字体大小挂钩，需配合自己情况调整大小以保证头像显示完整 */</span></span><br><span class="line"><span class="selector-class">.tk-avatar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">3rem</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3rem</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-avatar</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">3rem</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3rem</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 回复框左移，避免窄屏时出框 */</span></span><br><span class="line"><span class="selector-class">.tk-comments-container</span> <span class="selector-class">.tk-submit</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">70px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">110%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 评论块气泡化修改 */</span></span><br><span class="line"><span class="selector-class">.tk-content</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#00a6ff</span>; <span class="comment">/* 默认模式访客气泡配色 */</span></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">color</span>: white; <span class="comment">/* 默认模式访客气泡字体配色 */</span></span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">width</span>: fit-content;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: visible <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">max-height</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 修复图片出框 */</span></span><br><span class="line"><span class="selector-class">.tk-content</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 修复过长文本出框 */</span></span><br><span class="line"><span class="selector-class">.tk-content</span> pre &#123;</span><br><span class="line">    <span class="attribute">white-space</span>: pre-wrap;</span><br><span class="line">    <span class="attribute">word-wrap</span>: break-word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-content</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#eeecaa</span>; <span class="comment">/* 默认模式超链接配色 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-content</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">13px</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">2px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">20px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">15px</span> solid <span class="number">#00a6ff</span>; <span class="comment">/* 默认模式访客气泡小三角配色 */</span></span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">0</span> solid transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ff8080</span>; <span class="comment">/* 默认模式博主气泡配色 */</span></span><br><span class="line">    <span class="attribute">color</span>: white; <span class="comment">/* 默认模式博主气泡字体配色 */</span></span><br><span class="line">    <span class="attribute">width</span>: fit-content;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">9px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#eeecaa</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">left</span>: -<span class="number">13px</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">2px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">20px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">15px</span> solid <span class="number">#ff8080</span>; <span class="comment">/* 默认模式博主气泡小三角配色 */</span></span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">0</span> solid transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-row</span><span class="selector-attr">[data-v-d82ce9a0]</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: fit-content;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-avatar</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-master</span> <span class="selector-class">.tk-avatar</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 夜间模式配色，具体比照上方默认模式class */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.tk-content</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#1d1d1f</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.tk-content</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#dfa036</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.tk-content</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">15px</span> solid <span class="number">#1d1d1f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#1c1c1e</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#dfa036</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">2px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">20px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">15px</span> solid <span class="number">#1c1c1e</span>;</span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">0</span> solid transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自适应内容 */</span></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">    <span class="comment">/* 设置宽度上限，避免挤压博主头像 */</span></span><br><span class="line">    <span class="selector-class">.tk-content</span> &#123;</span><br><span class="line">        <span class="attribute">max-width</span>: <span class="number">75%</span>;</span><br><span class="line">        <span class="attribute">width</span>: fit-content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">75%</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">80px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">border-left</span>: <span class="number">15px</span> solid <span class="number">#ff8080</span>;</span><br><span class="line">        <span class="attribute">border-right</span>: <span class="number">0</span> solid transparent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-avatar</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">75%</span> + <span class="number">120px</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-row</span><span class="selector-attr">[data-v-d82ce9a0]</span> &#123;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="built_in">calc</span>(<span class="number">55%</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.tk-master</span> <span class="selector-class">.tk-content</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">        <span class="attribute">border-left</span>: <span class="number">15px</span> solid <span class="number">#1c1c1e</span>;</span><br><span class="line">        <span class="attribute">border-right</span>: <span class="number">0</span> solid transparent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设备名称常态隐藏，悬停评论时显示 */</span></span><br><span class="line"><span class="selector-class">.tk-extras</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    -ms-<span class="attribute">filter</span>: <span class="string">&quot;progid:DXImageTransform.Microsoft.Alpha(Opacity=0)&quot;</span>;</span><br><span class="line">    <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tk-content</span><span class="selector-pseudo">:hover</span> + <span class="selector-class">.tk-extras</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">animation</span>: tk-extras-fadeIn <span class="number">0.5s</span> linear;</span><br><span class="line">    -moz-<span class="attribute">animation</span>: tk-extras-fadeIn <span class="number">0.5s</span> linear;</span><br><span class="line">    -o-<span class="attribute">animation</span>: tk-extras-fadeIn <span class="number">0.5s</span> linear;</span><br><span class="line">    -ms-<span class="attribute">animation</span>: tk-extras-fadeIn <span class="number">0.5s</span> linear;</span><br><span class="line">    <span class="attribute">animation</span>: tk-extras-fadeIn <span class="number">0.5s</span> linear;</span><br><span class="line">    -webkit-<span class="attribute">animation-fill-mode</span>: forwards;</span><br><span class="line">    -moz-<span class="attribute">animation-fill-mode</span>: forwards;</span><br><span class="line">    -o-<span class="attribute">animation-fill-mode</span>: forwards;</span><br><span class="line">    -ms-<span class="attribute">animation-fill-mode</span>: forwards;</span><br><span class="line">    <span class="attribute">animation-fill-mode</span>: forwards;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@-moz-keyframes</span> tk-extras-fadeIn &#123;</span><br><span class="line">    <span class="selector-tag">from</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: <span class="string">&quot;progid:DXImageTransform.Microsoft.Alpha(Opacity=0)&quot;</span>;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">to</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: none;</span><br><span class="line">        <span class="attribute">filter</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> tk-extras-fadeIn &#123;</span><br><span class="line">    <span class="selector-tag">from</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: <span class="string">&quot;progid:DXImageTransform.Microsoft.Alpha(Opacity=0)&quot;</span>;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">to</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: none;</span><br><span class="line">        <span class="attribute">filter</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@-o-keyframes</span> tk-extras-fadeIn &#123;</span><br><span class="line">    <span class="selector-tag">from</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: <span class="string">&quot;progid:DXImageTransform.Microsoft.Alpha(Opacity=0)&quot;</span>;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">to</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: none;</span><br><span class="line">        <span class="attribute">filter</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> tk-extras-fadeIn &#123;</span><br><span class="line">    <span class="selector-tag">from</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: <span class="string">&quot;progid:DXImageTransform.Microsoft.Alpha(Opacity=0)&quot;</span>;</span><br><span class="line">        <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">to</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">        -ms-<span class="attribute">filter</span>: none;</span><br><span class="line">        <span class="attribute">filter</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改 <code>[Blogroot]\_config.butterfly.yml</code> 的 <code>inject</code> 配置项</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  inject:  </span><br><span class="line">    head:  </span><br><span class="line"><span class="addition">+     - &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/custom/twikoo_beautify.css&quot;  media=&quot;defer&quot; onload=&quot;this.media=&#x27;all&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-19-留言板"><a href="#3-19-留言板" class="headerlink" title="3.19 留言板"></a>3.19 留言板</h3><p>参考<a href="https://akilar.top/posts/e2d3c450/">《Akilarの糖果屋-信笺样式留言板》</a></p><p>安装插件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-envelope --save</span><br></pre></td></tr></table></figure><p>在站点配置文件或者主题配置文件添加配置项（对，两者任一均可。但不要都写）</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># envelope_comment  </span></span><br><span class="line"><span class="comment"># see https://akilar.top/posts/58900a8/  </span></span><br><span class="line"><span class="attr">envelope_comment:</span>  </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#开关  </span></span><br><span class="line">  <span class="attr">cover:</span> <span class="string">https://ae01.alicdn.com/kf/U5bb04af32be544c4b41206d9a42fcacfd.jpg</span> <span class="comment">#信笺封面图  </span></span><br><span class="line">  <span class="attr">message:</span> <span class="comment">#信笺内容，支持多行  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">有什么想问的？</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">有什么想说的？</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">有什么想吐槽的？</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="string">哪怕是有什么想吃的，都可以告诉我哦~</span>  </span><br><span class="line">  <span class="attr">bottom:</span> <span class="string">自动书记人偶竭诚为您服务！</span> <span class="comment">#信笺结束语，只能单行  </span></span><br><span class="line">  <span class="attr">height:</span> <span class="comment">#调整信笺划出高度，默认1050px  </span></span><br><span class="line">  <span class="attr">path:</span> <span class="comment">#【可选】comments 的路径名称。默认为 comments，生成的页面为 comments/index.html  </span></span><br><span class="line">  <span class="attr">front_matter:</span> <span class="comment">#【可选】comments页面的 front_matter 配置  </span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">留言板</span>  </span><br><span class="line">    <span class="attr">comments:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>修改留言页：打开<code>[Blogroot]\node_modules\hexo-butterfly-envelope\lib\html.pug</code>，在文件末尾添加自己想要的内容。</p><blockquote><p>HTML转PUG在线工具：<a href="http://www.html2jade.org/">http://www.html2jade.org/</a></p></blockquote><h3 id="3-20-GitCalendar提交日历"><a href="#3-20-GitCalendar提交日历" class="headerlink" title="3.20 GitCalendar提交日历"></a>3.20 GitCalendar提交日历</h3><p>项目地址：<a href="https://github.com/Zfour/hexo-github-calendar">https://github.com/Zfour/hexo-github-calendar</a></p><p><strong>（1）安装插件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-githubcalendar --save  </span><br></pre></td></tr></table></figure><p><strong>（2）新增网站根目录_config 配置项 (不是主题的)</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ice Kano Plus_in</span></span><br><span class="line"><span class="comment"># Hexo Github Canlendar</span></span><br><span class="line"><span class="comment"># Author: Ice Kano</span></span><br><span class="line"><span class="comment"># Modify: Lete乐特</span></span><br><span class="line"><span class="attr">githubcalendar:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">/comments/index.html</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">HuffieMa</span></span><br><span class="line">  <span class="attr">layout:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">id</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">recent-posts</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">githubcalendar_html:</span> <span class="string">&#x27;&lt;div class=&quot;recent-post-item&quot; style=&quot;width:100%;height:auto;padding:10px;&quot;&gt;&lt;div id=&quot;github_loading&quot; style=&quot;width:10%;height:100%;margin:0 auto;display: block&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;  viewBox=&quot;0 0 50 50&quot; style=&quot;enable-background:new 0 0 50 50&quot; xml:space=&quot;preserve&quot;&gt;&lt;path fill=&quot;#d0d0d0&quot; d=&quot;M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z&quot; transform=&quot;rotate(275.098 25 25)&quot;&gt;&lt;animateTransform attributeType=&quot;xml&quot; attributeName=&quot;transform&quot; type=&quot;rotate&quot; from=&quot;0 25 25&quot; to=&quot;360 25 25&quot; dur=&quot;0.6s&quot; repeatCount=&quot;indefinite&quot;&gt;&lt;/animateTransform&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/div&gt;&lt;div id=&quot;github_container&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line">  <span class="attr">pc_minheight:</span> <span class="string">280px</span></span><br><span class="line">  <span class="attr">mobile_minheight:</span> <span class="string">0px</span></span><br><span class="line"><span class="comment"># color: &quot;[&#x27;#e4dfd7&#x27;, &#x27;#f9f4dc&#x27;, &#x27;#f7e8aa&#x27;, &#x27;#f7e8aa&#x27;, &#x27;#f8df72&#x27;, &#x27;#fcd217&#x27;, &#x27;#fcc515&#x27;, &#x27;#f28e16&#x27;, &#x27;#fb8b05&#x27;, &#x27;#d85916&#x27;, &#x27;#f43e06&#x27;]&quot; #橘黄色调</span></span><br><span class="line"><span class="comment"># color: &quot;[&#x27;#ebedf0&#x27;, &#x27;#fdcdec&#x27;, &#x27;#fc9bd9&#x27;, &#x27;#fa6ac5&#x27;, &#x27;#f838b2&#x27;, &#x27;#f5089f&#x27;, &#x27;#c4067e&#x27;, &#x27;#92055e&#x27;, &#x27;#540336&#x27;, &#x27;#48022f&#x27;, &#x27;#30021f&#x27;]&quot; #浅紫色调</span></span><br><span class="line"><span class="comment"># color: &quot;[&#x27;#ebedf0&#x27;, &#x27;#f0fff4&#x27;, &#x27;#dcffe4&#x27;, &#x27;#bef5cb&#x27;, &#x27;#85e89d&#x27;, &#x27;#34d058&#x27;, &#x27;#28a745&#x27;, &#x27;#22863a&#x27;, &#x27;#176f2c&#x27;, &#x27;#165c26&#x27;, &#x27;#144620&#x27;]&quot; #翠绿色调</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&quot;[&#x27;#ebedf0&#x27;, &#x27;#f1f8ff&#x27;, &#x27;#dbedff&#x27;, &#x27;#c8e1ff&#x27;, &#x27;#79b8ff&#x27;, &#x27;#2188ff&#x27;, &#x27;#0366d6&#x27;, &#x27;#005cc5&#x27;, &#x27;#044289&#x27;, &#x27;#032f62&#x27;, &#x27;#05264c&#x27;]&quot;</span> <span class="comment">#天青色调</span></span><br><span class="line">  <span class="attr">api:</span> <span class="string">https://python-github-calendar-api.vercel.app/api</span></span><br><span class="line">  <span class="comment"># api: https://python-gitee-calendar-api.vercel.app/api</span></span><br><span class="line">  <span class="attr">calendar_js:</span> <span class="string">https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js</span></span><br><span class="line">  <span class="attr">plus_style:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>更多配置项含义请到<a href="https://zfe.space/post/hexo-githubcalendar.html">https://zfe.space/post/hexo-githubcalendar.html</a>查看。</p><p><strong>（3）将提交日历插入关于页面</strong></p><p>在关于页面md文件中，想要插入的位置插入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;recent-posts&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改站点配置文件中的属性</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enable_page:</span> <span class="string">/comments/index.html</span></span><br></pre></td></tr></table></figure><p>重新<code>hexo clean</code>,<code>hexo g</code>, <code>hexo s</code>即可看到效果</p><h3 id="3-21-版权声明页美化"><a href="#3-21-版权声明页美化" class="headerlink" title="3.21 版权声明页美化"></a>3.21 版权声明页美化</h3><p>编辑<code>butterfly/layout/includes/post/post-copyright.pug</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">if theme.post_copyright.enable &amp;&amp; page.copyright !== false</span><br><span class="line">  - let author = page.copyright_author ? page.copyright_author : config.author</span><br><span class="line">  - let url = page.copyright_url ? page.copyright_url : page.permalink</span><br><span class="line">  - let license = page.license ? page.license : theme.post_copyright.license</span><br><span class="line">  - let license_url = page.license_url ? page.license_url : theme.post_copyright.license_url</span><br><span class="line">  .post-copyright</span><br><span class="line">    .post-copyright__title</span><br><span class="line">      span.post-copyright-info</span><br><span class="line">        h #[=page.title]</span><br><span class="line">    .post-copyright__type</span><br><span class="line">      span.post-copyright-info</span><br><span class="line">        a(href=url_for(url))= theme.post_copyright.decode ? decodeURI(url) : url</span><br><span class="line">    .post-copyright-m</span><br><span class="line">      .post-copyright-m-info</span><br><span class="line">        .post-copyright-a</span><br><span class="line">            h 作者</span><br><span class="line">            .post-copyright-cc-info</span><br><span class="line">                h=author</span><br><span class="line">        .post-copyright-c</span><br><span class="line">            h 发布于</span><br><span class="line">            .post-copyright-cc-info</span><br><span class="line">                h=date(page.date, config.date_format)</span><br><span class="line">        .post-copyright-u</span><br><span class="line">            h 更新于</span><br><span class="line">            .post-copyright-cc-info</span><br><span class="line">                h=date(page.updated, config.date_format)</span><br><span class="line">        .post-copyright-c</span><br><span class="line">            h 许可协议</span><br><span class="line">            .post-copyright-cc-info</span><br><span class="line">                a.icon(rel=&#x27;noopener&#x27; target=&#x27;_blank&#x27; title=&#x27;Creative Commons&#x27; href=&#x27;https://creativecommons.org/&#x27;)</span><br><span class="line">                  i.fab.fa-creative-commons</span><br><span class="line">                a(rel=&#x27;noopener&#x27; target=&#x27;_blank&#x27; title=license href=url_for(license_url))=license</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编辑<code>butterfly/source/css/_layout/post.styl</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line">beautify()</span><br><span class="line">  headStyle(fontsize)</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="built_in">unit</span>(fontsize + .<span class="number">4</span>, <span class="string">&#x27;rem&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    code</span><br><span class="line">      font-size: <span class="built_in">unit</span>(fontsize, <span class="string">&#x27;rem&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    &amp;:before</span><br><span class="line">      margin-left: <span class="built_in">unit</span>((<span class="built_in">-</span>(fontsize + .<span class="number">2</span>)), <span class="string">&#x27;rem&#x27;</span>)</span><br><span class="line">      font-size: <span class="built_in">unit</span>(fontsize, <span class="string">&#x27;rem&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    &amp;:hover</span><br><span class="line">      padding-left: <span class="built_in">unit</span>(fontsize + .<span class="number">6</span>, <span class="string">&#x27;rem&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  h1,</span><br><span class="line">  h2,</span><br><span class="line">  h3,</span><br><span class="line">  h4,</span><br><span class="line">  h5,</span><br><span class="line">  h6</span><br><span class="line">    transition: all .<span class="number">2s</span> ease-out</span><br><span class="line"></span><br><span class="line">    &amp;:before</span><br><span class="line">      position: absolute</span><br><span class="line">      top: <span class="built_in">calc</span>(<span class="number">50%</span> - .<span class="number">35rem</span>)</span><br><span class="line">      color: $title-prefix-icon-color</span><br><span class="line">      content: $title-prefix-icon</span><br><span class="line">      line-height: <span class="number">1</span></span><br><span class="line">      transition: all .<span class="number">2s</span> ease-out</span><br><span class="line">      @extend .fontawesomeIcon</span><br><span class="line"></span><br><span class="line">    &amp;:hover</span><br><span class="line">      &amp;:before</span><br><span class="line">        color: $light-blue</span><br><span class="line"></span><br><span class="line">  h1</span><br><span class="line">    <span class="built_in">headStyle</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  h2</span><br><span class="line">    <span class="built_in">headStyle</span>(.<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">  h3</span><br><span class="line">    <span class="built_in">headStyle</span>(.<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">  h4</span><br><span class="line">    <span class="built_in">headStyle</span>(.<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">  h5</span><br><span class="line">    <span class="built_in">headStyle</span>(.<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">  h6</span><br><span class="line">    <span class="built_in">headStyle</span>(.<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">  ol,</span><br><span class="line">  ul</span><br><span class="line">    margin-top: .<span class="number">4rem</span></span><br><span class="line">    padding: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> .<span class="number">8rem</span></span><br><span class="line">    list-style: none</span><br><span class="line">    counter-reset: li</span><br><span class="line"></span><br><span class="line">    +<span class="built_in">maxWidth768</span>()</span><br><span class="line">      padding: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> .<span class="number">4rem</span></span><br><span class="line"></span><br><span class="line">    p</span><br><span class="line">      margin: <span class="number">0</span> <span class="number">0</span> .<span class="number">5rem</span></span><br><span class="line"></span><br><span class="line">    ol,</span><br><span class="line">    ul</span><br><span class="line">      padding-left: .<span class="number">6rem</span></span><br><span class="line"></span><br><span class="line">      +<span class="built_in">maxWidth768</span>()</span><br><span class="line">        padding-left: .<span class="number">2rem</span></span><br><span class="line"></span><br><span class="line">    li</span><br><span class="line">      &amp;:<span class="built_in">not</span>(.tab)</span><br><span class="line">        position: relative</span><br><span class="line">        margin: .<span class="number">2rem</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      &amp;:hover</span><br><span class="line">        &amp;:before</span><br><span class="line">          transform: <span class="built_in">rotate</span>(<span class="number">360deg</span>)</span><br><span class="line"></span><br><span class="line">      &amp;:before</span><br><span class="line">        position: absolute</span><br><span class="line">        top: <span class="number">0</span></span><br><span class="line">        left: <span class="number">0</span></span><br><span class="line">        background: $light-blue</span><br><span class="line">        color: $white</span><br><span class="line">        cursor: pointer</span><br><span class="line">        transition: all .<span class="number">3s</span> ease-out</span><br><span class="line"></span><br><span class="line">  ol</span><br><span class="line">    &gt; li</span><br><span class="line">      &amp;:<span class="built_in">not</span>(.tab)</span><br><span class="line">        padding: .<span class="number">2em</span> .<span class="number">2em</span> .<span class="number">2em</span> <span class="number">1.8em</span></span><br><span class="line"></span><br><span class="line">      &amp;:before</span><br><span class="line">        margin-top: .<span class="number">65em</span></span><br><span class="line">        width: w = <span class="number">1.45em</span></span><br><span class="line">        height: h = w</span><br><span class="line">        border-radius: .<span class="number">5</span> * w</span><br><span class="line">        content: <span class="built_in">counter</span>(li)</span><br><span class="line">        counter-increment: li</span><br><span class="line">        text-align: center</span><br><span class="line">        font-size: .<span class="number">85em</span></span><br><span class="line">        line-height: h</span><br><span class="line"></span><br><span class="line">  ul</span><br><span class="line">    &gt; li:<span class="built_in">not</span>(.tab)</span><br><span class="line">      padding: .<span class="number">2em</span> .<span class="number">2em</span> .<span class="number">2em</span> <span class="number">1.4em</span></span><br><span class="line"></span><br><span class="line">      &amp;:hover</span><br><span class="line">        &amp;:before</span><br><span class="line">          border-color: $pseudo-hover</span><br><span class="line"></span><br><span class="line">      &amp;:before</span><br><span class="line">        $w = .<span class="number">42em</span></span><br><span class="line">        top: .<span class="number">78em</span></span><br><span class="line">        width: w = $w</span><br><span class="line">        height: h = w</span><br><span class="line">        border: .<span class="number">5</span> * w solid $light-blue</span><br><span class="line">        border-radius: w</span><br><span class="line">        background: transparent</span><br><span class="line">        content: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        line-height: h</span><br><span class="line"></span><br><span class="line"><span class="built_in">no-beautify</span>()</span><br><span class="line">  ol,</span><br><span class="line">  ul</span><br><span class="line">    margin-top: .<span class="number">4rem</span></span><br><span class="line"></span><br><span class="line">    p</span><br><span class="line">      margin: <span class="number">0</span> <span class="number">0</span> .<span class="number">5rem</span></span><br><span class="line"></span><br><span class="line">    ol,</span><br><span class="line">    ul</span><br><span class="line">      padding-left: .<span class="number">5rem</span></span><br><span class="line"></span><br><span class="line">    li</span><br><span class="line">      position: relative</span><br><span class="line">      margin: .<span class="number">3rem</span> <span class="number">0</span></span><br><span class="line">      padding-left: .<span class="number">3rem</span></span><br><span class="line"></span><br><span class="line">#article-container</span><br><span class="line">  word-wrap: break-word</span><br><span class="line">  overflow-wrap: break-word</span><br><span class="line"></span><br><span class="line">  a</span><br><span class="line">    color: $theme-link-color</span><br><span class="line"></span><br><span class="line">    &amp;:hover</span><br><span class="line">      text-decoration: underline</span><br><span class="line"></span><br><span class="line">  img</span><br><span class="line">    display: block</span><br><span class="line">    margin: <span class="number">0</span> auto .<span class="number">8rem</span></span><br><span class="line"></span><br><span class="line">  p</span><br><span class="line">    margin: <span class="number">0</span> <span class="number">0</span> .<span class="number">8rem</span></span><br><span class="line"></span><br><span class="line">  iframe</span><br><span class="line">    margin: <span class="number">0</span> <span class="number">0</span> <span class="number">1rem</span></span><br><span class="line"></span><br><span class="line">  if <span class="built_in">hexo-config</span>(<span class="string">&#x27;beautify.enable&#x27;</span>) &amp;&amp; <span class="built_in">hexo-config</span>(<span class="string">&#x27;beautify.field&#x27;</span>) == <span class="string">&#x27;site&#x27;</span></span><br><span class="line">    <span class="built_in">beautify</span>()</span><br><span class="line">  else if <span class="built_in">hexo-config</span>(<span class="string">&#x27;beautify.enable&#x27;</span>) &amp;&amp; <span class="built_in">hexo-config</span>(<span class="string">&#x27;beautify.field&#x27;</span>) == <span class="string">&#x27;post&#x27;</span></span><br><span class="line">    <span class="built_in">no-beautify</span>()</span><br><span class="line"></span><br><span class="line">    &amp;.post-content</span><br><span class="line">      <span class="built_in">beautify</span>()</span><br><span class="line">  else</span><br><span class="line">    <span class="built_in">no-beautify</span>()</span><br><span class="line"></span><br><span class="line">#post</span><br><span class="line">  .tag_share</span><br><span class="line">    .post-meta</span><br><span class="line">      &amp;__tag-list</span><br><span class="line">        display: inline-block</span><br><span class="line"></span><br><span class="line">      &amp;__tags</span><br><span class="line">        display: inline-block</span><br><span class="line">        margin: .<span class="number">4rem</span> .<span class="number">4rem</span> .<span class="number">4rem</span> <span class="number">0</span></span><br><span class="line">        padding: <span class="number">0</span> .<span class="number">6rem</span></span><br><span class="line">        width: fit-content</span><br><span class="line">        border: <span class="number">1px</span> solid $light-blue</span><br><span class="line">        border-radius: .<span class="number">6rem</span></span><br><span class="line">        color: $light-blue</span><br><span class="line">        font-size: .<span class="number">85em</span></span><br><span class="line">        transition: all .<span class="number">2s</span> ease-in-out</span><br><span class="line"></span><br><span class="line">        &amp;:hover</span><br><span class="line">          background: $light-blue</span><br><span class="line">          color: <span class="built_in">var</span>(--white)</span><br><span class="line"></span><br><span class="line">    .post_share</span><br><span class="line">      display: inline-block</span><br><span class="line">      float: right</span><br><span class="line">      margin: .<span class="number">4rem</span> <span class="number">0</span></span><br><span class="line">      width: fit-content</span><br><span class="line"></span><br><span class="line">      .social-share</span><br><span class="line">        font-size: .<span class="number">85em</span></span><br><span class="line"></span><br><span class="line">        .social-share-icon</span><br><span class="line">          margin: <span class="number">0</span> <span class="number">4px</span></span><br><span class="line">          width: w = <span class="number">1.85em</span></span><br><span class="line">          height: w</span><br><span class="line">          font-size: <span class="number">1.2em</span></span><br><span class="line">          line-height: w</span><br><span class="line"></span><br><span class="line">  .post-copyright</span><br><span class="line">    position: relative</span><br><span class="line">    margin: <span class="number">2rem</span> <span class="number">0</span> .<span class="number">5rem</span></span><br><span class="line">    padding: .<span class="number">5rem</span> .<span class="number">8rem</span></span><br><span class="line">    border: <span class="number">1px</span> solid <span class="built_in">var</span>(--light-grey)</span><br><span class="line">    transition: box-shadow .<span class="number">3s</span> ease-in-out</span><br><span class="line">    overflow: hidden</span><br><span class="line">    border-radius: <span class="number">12px</span><span class="meta">!important</span></span><br><span class="line">    background-color: <span class="built_in">rgb</span>(<span class="number">239</span> <span class="number">241</span> <span class="number">243</span>)</span><br><span class="line"></span><br><span class="line">    &amp;:before</span><br><span class="line">      background <span class="built_in">var</span>(--heo-post-blockquote-bg)</span><br><span class="line">      position absolute</span><br><span class="line">      right -<span class="number">26px</span></span><br><span class="line">      top -<span class="number">120px</span></span><br><span class="line">      content <span class="string">&#x27;\f25e&#x27;</span></span><br><span class="line">      font-size <span class="number">200px</span></span><br><span class="line">      font-family <span class="string">&#x27;Font Awesome 5 Brands&#x27;</span></span><br><span class="line">      opacity .<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    &amp;:hover</span><br><span class="line">      box-shadow: <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">232</span>, <span class="number">237</span>, <span class="number">250</span>, .<span class="number">6</span>), <span class="number">0</span> <span class="number">2px</span> <span class="number">4px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">232</span>, <span class="number">237</span>, <span class="number">250</span>, .<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    .post-copyright</span><br><span class="line">      &amp;-meta</span><br><span class="line">        color: $light-blue</span><br><span class="line">        font-weight: bold</span><br><span class="line"></span><br><span class="line">      &amp;-info</span><br><span class="line">        padding-left: .<span class="number">3rem</span></span><br><span class="line"></span><br><span class="line">        a</span><br><span class="line">          text-decoration: none</span><br><span class="line">          word-break: break-word</span><br><span class="line"></span><br><span class="line">          &amp;:hover</span><br><span class="line">            text-decoration: none</span><br><span class="line"></span><br><span class="line">  .post-copyright-cc-info</span><br><span class="line">    color: $theme-color;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.post-outdate-notice</span></span><br><span class="line">    <span class="attribute">position</span>: relative</span><br><span class="line">    margin: <span class="number">0</span> <span class="number">0</span> <span class="number">1rem</span></span><br><span class="line">    padding: .<span class="number">5em</span> <span class="number">1.2em</span></span><br><span class="line">    border-radius: <span class="number">15px</span></span><br><span class="line">    background-color: $noticeOutdate-bg</span><br><span class="line">    color: $noticeOutdate-color</span><br><span class="line"></span><br><span class="line">    if <span class="built_in">hexo-config</span>(<span class="string">&#x27;noticeOutdate.style&#x27;</span>) == <span class="string">&#x27;flat&#x27;</span></span><br><span class="line">      padding: .<span class="number">5em</span> <span class="number">1em</span> .<span class="number">5em</span> <span class="number">2.6em</span></span><br><span class="line">      border-left: <span class="number">5px</span> solid $noticeOutdate-border</span><br><span class="line"></span><br><span class="line">      &amp;:before</span><br><span class="line">        @extend .fontawesomeIcon</span><br><span class="line">        position: absolute</span><br><span class="line">        top: <span class="number">50%</span></span><br><span class="line">        left: .<span class="number">9em</span></span><br><span class="line">        color: $noticeOutdate-border</span><br><span class="line">        content: <span class="string">&#x27;\f071&#x27;</span></span><br><span class="line">        transform: <span class="built_in">translateY</span>(-<span class="number">50%</span>)</span><br><span class="line"></span><br><span class="line">  .ads-wrap</span><br><span class="line">    margin: <span class="number">2rem</span> <span class="number">0</span></span><br><span class="line">.post-copyright-m-info</span><br><span class="line">  .post-copyright-a,</span><br><span class="line">  .post-copyright-c,</span><br><span class="line">  .post-copyright-u</span><br><span class="line">    display inline-block</span><br><span class="line">    width fit-content</span><br><span class="line">    padding <span class="number">2px</span> <span class="number">5px</span></span><br><span class="line">[data-theme=<span class="string">&quot;dark&quot;</span>]</span><br><span class="line">  #post</span><br><span class="line">    .post-copyright</span><br><span class="line">      background-color <span class="number">#07080a</span></span><br><span class="line">      text-shadow <span class="number">#bfbeb8</span> <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span></span><br><span class="line">      border <span class="number">1px</span> solid <span class="built_in">rgb</span>(<span class="number">19</span> <span class="number">18</span> <span class="number">18</span> / <span class="number">35%</span>)</span><br><span class="line">      box-shadow <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgb</span>(<span class="number">20</span>, <span class="number">120</span>, <span class="number">210</span>)</span><br><span class="line">      animation flashlight <span class="number">1s</span> linear infinite alternate</span><br><span class="line">  .post-copyright-info</span><br><span class="line">    color <span class="number">#e0e0e4</span></span><br><span class="line"></span><br><span class="line">#post</span><br><span class="line">  .post-copyright__title</span><br><span class="line">    font-size <span class="number">22px</span></span><br><span class="line">  .post-copyright__notice</span><br><span class="line">    font-size <span class="number">15px</span></span><br><span class="line">  .post-copyright</span><br><span class="line">    box-shadow <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span></span><br><span class="line"></span><br><span class="line">@keyframes flashlight</span><br><span class="line">  from</span><br><span class="line">    box-shadow <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgb</span>(<span class="number">20</span>, <span class="number">120</span>, <span class="number">210</span>)</span><br><span class="line">  to</span><br><span class="line">    box-shadow <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="built_in">rgb</span>(<span class="number">20</span>, <span class="number">120</span>, <span class="number">210</span>)</span><br></pre></td></tr></table></figure><h3 id="3-22-滚动条美化"><a href="#3-22-滚动条美化" class="headerlink" title="3.22 滚动条美化"></a>3.22 滚动条美化</h3><p>效果见右侧滚动条</p><p>新建 <code>Hexo\themes\butterfly\source\css\custom.css</code>(css 文件名自定义)</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 滚动条 */</span></span><br><span class="line"></span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::-webkit-scrollbar-thumb &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#49B1F5</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">-webkit-linear-gradient</span>( <span class="number">45deg</span>, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>) <span class="number">25%</span>, transparent <span class="number">25%</span>, transparent <span class="number">50%</span>, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>) <span class="number">50%</span>, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>) <span class="number">75%</span>, transparent <span class="number">75%</span>, transparent);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::-webkit-scrollbar-corner &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::-moz-selection &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#49B1F5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在主题配置文件中引入：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># 自定义样式（滚动条）</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/custom/custom.css&quot;&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-23-个性化浏览器标题"><a href="#3-23-个性化浏览器标题" class="headerlink" title="3.23 个性化浏览器标题"></a>3.23 个性化浏览器标题</h3><p>实现浏览器切到别的网页时显示特定文字，切回自己博客时显示特定文字2s。</p><p>新建 <code>Hexo\themes\butterfly\source\js\custom.js</code>(js 文件名自定义)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 个性化Title</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">OriginTitle</span> = <span class="variable language_">document</span>.<span class="property">title</span>;</span><br><span class="line"><span class="keyword">var</span> titleTime;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;visibilitychange&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">hidden</span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;[rel=&quot;icon&quot;]&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;href&#x27;</span>, <span class="string">&quot;/img/favicon.ico&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&#x27;HalfA博客&#x27;</span>;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(titleTime);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="string">&#x27;[rel=&quot;icon&quot;]&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;href&#x27;</span>, <span class="string">&quot;/img/favicon.ico&quot;</span>);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&#x27;欢迎回来~~&#x27;</span> + <span class="title class_">OriginTitle</span>;</span><br><span class="line">        titleTime = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">title</span> = <span class="title class_">OriginTitle</span>;</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在主题配置文件中引入：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="comment"># 自定义JS（个性化标题）</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/js/custom/custom.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四、网站优化"><a href="#四、网站优化" class="headerlink" title="四、网站优化"></a>四、网站优化</h2><h3 id="4-1-链接预加载"><a href="#4-1-链接预加载" class="headerlink" title="4.1 链接预加载"></a>4.1 链接预加载</h3><p>当鼠标悬停到链接上超过65毫秒时，instantpage会对该链接进行预加载，提升访问速度。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://instant.page/</span></span><br><span class="line"><span class="comment"># prefetch (預加載)</span></span><br><span class="line"><span class="attr">instantpage:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="4-2-SEO优化"><a href="#4-2-SEO优化" class="headerlink" title="4.2 SEO优化"></a>4.2 SEO优化</h3><p><strong>优化链接</strong></p><p>采用<code>hexo-abbrlink</code>插件实现链接，后期不管怎么修改永久链接都不会变，不用考虑分类中文化的问题，并且更利于SEO。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure><p>配置站点文件<code>config.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">post/:abbrlink.html</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line">  <span class="attr">alg:</span> <span class="string">crc32</span>  <span class="comment"># 算法：crc16(default) and crc32</span></span><br><span class="line">  <span class="attr">rep:</span> <span class="string">hex</span>    <span class="comment"># 进制：dec(default) and hex</span></span><br></pre></td></tr></table></figure><p><strong>生成新的站点地图</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br><span class="line">npm install hexo-generator-baidu-sitemap --save</span><br></pre></td></tr></table></figure><p><strong>百度资源平台管理站点</strong></p><p>打开<a href="https://ziyuan.baidu.com/">百度搜索资源平台</a>，进入【用户中心-站点管理-添加网站】，按照流程添加网站。</p><p>在验证阶段选择<strong>HTML标签验证</strong>，将<code>content</code>内容填入主题配置文件<code>site_verification</code>处部署后点击完成验证。</p><p>验证成功后，点击普通提交，首先提交<code>sitemap</code></p><p><img src="https://img.mahaofei.com/img/20220410152709.png" alt=""></p><p>然后如果想百度收录的更加及时，可以再配置API提交，首先需要安装额外的插件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-baidu-url-submit --save</span><br></pre></td></tr></table></figure><p>修改站点配置</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">https://github.com//xxx.github.io.git</span></span><br><span class="line">    <span class="attr">branch:</span> <span class="string">main</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">baidu_url_submitter</span></span><br></pre></td></tr></table></figure><p>添加站点配置</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baidu_url_submit:</span></span><br><span class="line">  <span class="attr">count:</span> <span class="number">100</span> <span class="comment"># 提交最新的100个链接</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">https://www.mahaofei.com</span> <span class="comment"># 站点管理中添加的网站域名</span></span><br><span class="line">  <span class="attr">token:</span> <span class="string">xR6nigjGWFHyybFO</span> <span class="comment"># token可以在API提交页面找到</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">baidu_urls.txt</span> <span class="comment"># 文本文档的地址，新链接会保存在此文本文档里</span></span><br></pre></td></tr></table></figure><p>此后每次 <code>hexo d</code>都会进行API提交</p><p><strong>谷歌收录</strong></p><p>进入<a href="https://search.google.com/search-console/welcome">Google Search Console</a>，进行网站验证</p><p><img src="https://img.mahaofei.com/img/20220410154319.png" alt=""></p><p>验证成功后，进入配置页面，点击<strong>Sitemaps</strong>，提交自己的Sitemap文件就可以了。</p><p><img src="https://img.mahaofei.com/img/20220410154520.png" alt=""></p><h2 id="五、博客撰写"><a href="#五、博客撰写" class="headerlink" title="五、博客撰写"></a>五、博客撰写</h2><h3 id="3-1-页面配置Page-Front-matter"><a href="#3-1-页面配置Page-Front-matter" class="headerlink" title="3.1 页面配置Page Front-matter"></a>3.1 页面配置Page Front-matter</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span></span><br><span class="line"><span class="attr">date:</span></span><br><span class="line"><span class="attr">updated:</span></span><br><span class="line"><span class="attr">type:</span></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line"><span class="attr">description:</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">top_img:</span></span><br><span class="line"><span class="attr">mathjax:</span></span><br><span class="line"><span class="attr">katex:</span></span><br><span class="line"><span class="attr">aside:</span></span><br><span class="line"><span class="attr">aplayer:</span></span><br><span class="line"><span class="attr">highlight_shrink:</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>写法</th><th>解释</th></tr></thead><tbody><tr><td>title</td><td>【必需】页面标题</td></tr><tr><td>date</td><td>【必需】页面创建日期</td></tr><tr><td>type</td><td>【必需】标签、分类和友情链接三个页面需要配置</td></tr><tr><td>updated</td><td>【可选】页面更新日期</td></tr><tr><td>description</td><td>【可选】页面描述</td></tr><tr><td>keywords</td><td>【可选】页面关键字</td></tr><tr><td>comments</td><td>【可选】显示页面评论模块(默认true)</td></tr><tr><td>top_img</td><td>【可选】页面顶部图片</td></tr><tr><td>mathjax</td><td>【可选】显示mathjax(当设置mathjax的per_page: false时，才需要配置，默认false)</td></tr><tr><td>katex</td><td>【可选】显示katex(当设置katex的per_page: false时，才需要配置，默认false)</td></tr><tr><td>aside</td><td>【可选】显示侧边栏(默认true)</td></tr><tr><td>aplayer</td><td>【可选】在需要的页面加载aplayer的js和css,请参考文章下面的音樂 配置</td></tr><tr><td>highlight_shrink</td><td>【可选】配置代码框是否展开(true/false)(默认为设置中highlight_shrink的配置)</td></tr></tbody></table></div><h3 id="3-2-文章页配置"><a href="#3-2-文章页配置" class="headerlink" title="3.2 文章页配置"></a>3.2 文章页配置</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">--- </span></span><br><span class="line"><span class="attr">title:</span> </span><br><span class="line"><span class="attr">date:</span> </span><br><span class="line"><span class="attr">updated:</span> </span><br><span class="line"><span class="attr">tags:</span> </span><br><span class="line"><span class="attr">categories:</span> </span><br><span class="line"><span class="attr">keywords:</span> </span><br><span class="line"><span class="attr">description:</span> </span><br><span class="line"><span class="attr">top _img:</span> </span><br><span class="line"><span class="attr">comments:</span> </span><br><span class="line"><span class="attr">cover:</span> </span><br><span class="line"><span class="attr">toc:</span> </span><br><span class="line"><span class="attr">toc_ number:</span> </span><br><span class="line"><span class="attr">toc _style_ simple:</span> </span><br><span class="line"><span class="attr">copyright:</span> </span><br><span class="line"><span class="attr">copyright _author:</span> </span><br><span class="line"><span class="attr">copyright_ author _href:</span> </span><br><span class="line"><span class="attr">copyright_ url:</span> </span><br><span class="line"><span class="attr">copyright _info:</span> </span><br><span class="line"><span class="attr">mathjax:</span> </span><br><span class="line"><span class="attr">katex:</span> </span><br><span class="line"><span class="attr">aplayer:</span> </span><br><span class="line"><span class="attr">highlight_ shrink:</span> </span><br><span class="line"><span class="attr">aside:</span> </span><br><span class="line"><span class="attr">stick:</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>写法</th><th>解释</th></tr></thead><tbody><tr><td>title</td><td>【必需】文章标题</td></tr><tr><td>date</td><td>【必需】文章创建日期</td></tr><tr><td>updated</td><td>【可选】文章更新日期</td></tr><tr><td>tags</td><td>【可选】文章标签</td></tr><tr><td>categories</td><td>【可选】文章分类</td></tr><tr><td>keywords</td><td>【可选】文章关键字</td></tr><tr><td>description</td><td>【可选】文章描述</td></tr><tr><td>top_img</td><td>【可选】文章顶部图片</td></tr><tr><td>cover</td><td>【可选】文章缩略图(如果没有设置top_img,文章页顶部将显示缩略图，可设为false/图片地址/留空)</td></tr><tr><td>comments</td><td>【可选】显示文章评论模块(默认true)</td></tr><tr><td>toc</td><td>【可选】显示文章TOC(默认为设置中toc的enable配置)</td></tr><tr><td>toc_number</td><td>【可选】显示toc_number(默认为设置中toc的number配置)</td></tr><tr><td>toc_style_simple</td><td>【可选】显示toc 简洁模式</td></tr><tr><td>copyright</td><td>【可选】显示文章版权模块(默认为设置中post_copyright的enable配置)</td></tr><tr><td>copyright_author</td><td>【可选】文章版权模块的文章作者</td></tr><tr><td>copyright_author_href</td><td>【可选】文章版权模块的文章作者链接</td></tr><tr><td>copyright_url</td><td>【可选】文章版权模块的文章連結链接</td></tr><tr><td>copyright_info</td><td>【可选】文章版权模块的版權聲明文字</td></tr><tr><td>mathjax</td><td>【可选】显示mathjax(当设置mathjax的per_page: false时，才需要配置，默认false)</td></tr><tr><td>katex</td><td>【可选】显示katex(当设置katex的per_page: false时，才需要配置，默认false)</td></tr><tr><td>aplayer</td><td>【可选】在需要的页面加载aplayer的js和css,请参考文章下面的音樂 配置</td></tr><tr><td>highlight_shrink</td><td>【可选】配置代码框是否展开(true/false)(默认为设置中highlight_shrink的配置)</td></tr><tr><td>aside</td><td>【可选】显示侧边栏(默认true)</td></tr><tr><td>stick</td><td>【可选】文章置顶(默认0不置顶，设置1时置顶)</td></tr></tbody></table></div><h3 id="3-3-Butterfly主题可用功能"><a href="#3-3-Butterfly主题可用功能" class="headerlink" title="3.3 Butterfly主题可用功能"></a>3.3 Butterfly主题可用功能</h3><p><strong>Tag Inline</strong></p><p>类似于查题网站，点击查看答案按钮，显示答案</p><p><a href="https://butterfly.js.org/posts/4aa8abbe/#tag-hide">https://butterfly.js.org/posts/4aa8abbe/#tag-hide</a></p><p><strong>mermail</strong></p><p>使用mermaid标签可以绘制Flowchart（流程图）、Sequence diagram（时序图）、Class Diagram（类别图）、State Diagram（状态图）、Gantt（甘特图）和Pie Chart（圆形图）</p><p><a href="https://butterfly.js.org/posts/4aa8abbe/#mermaid">https://butterfly.js.org/posts/4aa8abbe/#mermaid</a></p><p><strong>Tabs</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test4 %&#125; </span><br><span class="line">&lt;!-- tab 第一个Tab --&gt; </span><br><span class="line"><span class="strong">**tab名字为第一个Tab**</span></span><br><span class="line"> &lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab @fab fa-apple-pay --&gt; </span><br><span class="line"><span class="strong">**只有图标没有Tab名字**</span></span><br><span class="line"> &lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab 炸弹@fas fa-bomb --&gt; </span><br><span class="line"><span class="strong">**名字+icon**</span></span><br><span class="line"> &lt;!-- endtab --&gt; </span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p><strong>Button</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btn [url],[text],[icon],[color] [style] [layout] [position] [size] %&#125;</span><br><span class="line"></span><br><span class="line">[url] : 链接</span><br><span class="line">[text] : 按钮文字</span><br><span class="line">[icon] : [可选] 图标</span><br><span class="line">[color] : [可选] 按钮背景颜色(默认style时）</span><br><span class="line"><span class="code">                      按钮字体和边框颜色(outline时) </span></span><br><span class="line"><span class="code">                      default/blue/pink/red/purple/orange/green </span></span><br><span class="line"><span class="code">[style] : [可选] 按钮样式默认实心</span></span><br><span class="line"><span class="code">                      outline/留空</span></span><br><span class="line"><span class="code">[layout] : [可选] 按钮布局默认为line </span></span><br><span class="line"><span class="code">                      block/留空</span></span><br><span class="line"><span class="code">[position] : [可选] 按钮位置前提是设置了layout为block 默认为左边</span></span><br><span class="line"><span class="code">                      center/right/留空</span></span><br><span class="line"><span class="code">[size] : [可选] 按钮大小</span></span><br><span class="line"><span class="code">                      larger/留空</span></span><br></pre></td></tr></table></figure><p><strong>inlineImg</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% inlineImg [src] [height] %&#125;</span><br><span class="line"></span><br><span class="line">[src] : 图片链接</span><br><span class="line">[height] ： 图片高度限制【可选】</span><br></pre></td></tr></table></figure><p><strong>label</strong></p><p>高亮所需的文字</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% label text color %&#125;</span><br><span class="line">[text] : 文字</span><br><span class="line">[color] : 【可选】背景颜色，默认为default</span><br><span class="line">default/blue/pink/red/purple/orange/green</span><br></pre></td></tr></table></figure><p><strong>timeline</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline title,color %&#125; </span><br><span class="line">&lt;!-- timeline title --&gt; </span><br><span class="line">xxxxx </span><br><span class="line">&lt;!-- endtimeline --&gt; </span><br><span class="line">&lt;!-- timeline title --&gt; </span><br><span class="line">xxxxx </span><br><span class="line">&lt;!-- endtimeline --&gt; </span><br><span class="line">&#123;% endtimeline %&#125;</span><br><span class="line"></span><br><span class="line">[title] : 标题/时间线</span><br><span class="line">[color]: timeline 颜色</span><br><span class="line">default(留空) / blue / pink / red / purple / orange / green</span><br></pre></td></tr></table></figure><p><strong>flink</strong></p><p>可在任何界面插入类似友情链接列表效果</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;% flink %&#125; </span><br><span class="line"><span class="bullet">-</span> class <span class="emphasis">_name: 友情链接</span></span><br><span class="line"><span class="emphasis">  class_</span> desc: 那些人，那些事</span><br><span class="line">  link <span class="emphasis">_list: </span></span><br><span class="line"><span class="emphasis">    - name: JerryC </span></span><br><span class="line"><span class="emphasis">      link: https://jerryc.me/ </span></span><br><span class="line"><span class="emphasis">      avatar: https://jerryc.me/img/avatar.png </span></span><br><span class="line"><span class="emphasis">      descr: 今日事,今日毕</span></span><br><span class="line"><span class="emphasis">    - name: Hexo </span></span><br><span class="line"><span class="emphasis">      link: https://hexo.io/zh-tw/ </span></span><br><span class="line"><span class="emphasis">      avatar: https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg </span></span><br><span class="line"><span class="emphasis">      descr: 快速、简单且强大的网志框架</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">- class_</span> name: 网站</span><br><span class="line">  class <span class="emphasis">_desc: 值得推荐的网站</span></span><br><span class="line"><span class="emphasis">  link_</span> list: </span><br><span class="line"><span class="bullet">    -</span> name: Youtube </span><br><span class="line"><span class="code">      link: https://www.youtube.com/ </span></span><br><span class="line"><span class="code">      avatar: https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png </span></span><br><span class="line"><span class="code">      descr: 视频网站</span></span><br><span class="line"><span class="code">    - name: Weibo </span></span><br><span class="line"><span class="code">      link: https://www.weibo.com/ </span></span><br><span class="line"><span class="code">      avatar: https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png </span></span><br><span class="line"><span class="code">      descr: 中国最大社交分享平台</span></span><br><span class="line"><span class="code">    - name: Twitter </span></span><br><span class="line"><span class="code">      link: https://twitter.com/ </span></span><br><span class="line"><span class="code">      avatar: https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png </span></span><br><span class="line"><span class="code">      descr: 社交分享平台</span></span><br><span class="line"><span class="code">&#123;% endflink %&#125;</span></span><br></pre></td></tr></table></figure><h1 id="博客备份"><a href="#博客备份" class="headerlink" title="博客备份"></a>博客备份</h1><h2 id="创建新分支"><a href="#创建新分支" class="headerlink" title="创建新分支"></a>创建新分支</h2><p>不过在建立新分支前请确保仓库内<strong>已有master分支</strong>（Hexo本地建站后第一次上传时会自动生成）。<br>然后创建一个用来备份的分支hexo，并且将其设置为默认分支。</p><h2 id="获取-git文件夹"><a href="#获取-git文件夹" class="headerlink" title="获取 .git文件夹"></a>获取 .git文件夹</h2><p>原始的博客文件夹只有<code>.deploy_git</code>文件夹，是没有.git文件夹的，于是我们先去桌面或者哪里随便一个地方，把刚刚的hexo分支给clone下来。然后复制出里面的.git文件夹，复制到现在的博客文件夹中。</p><p>在博客文件夹中检查是否有<code>.gitignore</code>文件，如果没有最好手动添加一个，用于上传时忽略一些不必要的文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">db.json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line">public/</span><br><span class="line">.deploy*/</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：如果你之前克隆过theme中的主题文件，那么应该把主题文件中的.git文件夹删掉，因为git不能嵌套上传，最好是显示隐藏文件，检查一下有没有，否则上传的时候会出错，导致你的主题文件无法上传，这样你的配置在别的电脑上就用不了了。</p></blockquote><h2 id="备份博客"><a href="#备份博客" class="headerlink" title="备份博客"></a>备份博客</h2><p>通过如下命令将本地文件备份到Github上。  </p><p>在hexo博客的根目录下执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;Backup&quot;</span><br><span class="line">git push origin hexo</span><br></pre></td></tr></table></figure><h2 id="恢复博客"><a href="#恢复博客" class="headerlink" title="恢复博客"></a>恢复博客</h2><p>目前假设本地Hexo博客基础环境已经搭好：比如安装git<br>、nodejs、hexo安装等等。</p><p>输入下列命令克隆博客必须文件(hexo分支)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/yourgithubname/yourgithubname.github.io</span><br></pre></td></tr></table></figure><p>在clone下来的那个文件夹里面执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli</span><br><span class="line">npm install hexo-deployer-git</span><br></pre></td></tr></table></figure><p>不需要执行<code>hexo init</code>，直接继续安装原来安装的一些插件，然后就完成了</p>]]></content>
    
    
    <summary type="html">本站博客ButterFly主题配置的全部方法，呕心沥血整理版，供各位同样使用ButterFly主题的朋友参考。同样记录了Hexo博客的备份方法，防止更换电脑或电脑崩溃后数据丢失。</summary>
    
    
    
    <category term="随笔" scheme="https://www.mahaofei.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="经验" scheme="https://www.mahaofei.com/categories/%E9%9A%8F%E7%AC%94/%E7%BB%8F%E9%AA%8C/"/>
    
    
  </entry>
  
  <entry>
    <title>STM32控制步进电机</title>
    <link href="https://www.mahaofei.com/post/1a1a1626.html"/>
    <id>https://www.mahaofei.com/post/1a1a1626.html</id>
    <published>2022-03-26T12:21:49.000Z</published>
    <updated>2022-03-26T12:21:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>使用硬件型号为：STM32F103C8T6最小系统板、A4988模块、42步进电机(42BYGH39)</p><h2 id="1-1-A4988介绍"><a href="#1-1-A4988介绍" class="headerlink" title="1.1 A4988介绍"></a>1.1 A4988介绍</h2><p><img src="https://img.mahaofei.com/img/202203301130791.png" alt=""><br><img src="https://img.mahaofei.com/img/202203311723230.png" alt=""></p><div class="table-container"><table><thead><tr><th>引脚</th><th>功能说明</th><th>接线</th></tr></thead><tbody><tr><td>EN</td><td>使能端，低电平有效</td><td>接GND或单片机IOx1</td></tr><tr><td>MS1/2/3</td><td>步进模式选择</td><td>不接或单片机IOx3</td></tr><tr><td>SLP</td><td>休眠，高电平有效</td><td>短接RST</td></tr><tr><td>STEP</td><td>输入脉冲，一个脉冲转一下</td><td>单片机IOx1</td></tr><tr><td>DIR</td><td>方向位，0/1各代表一方向</td><td>单片机IOx1</td></tr><tr><td>VMOT/GND</td><td>电源接口，直流供电8~35V，最大2A</td><td>12/24V电源</td></tr><tr><td>1A/1B/2A/2B</td><td>步进电机接线</td><td>步进电机</td></tr><tr><td>VDD/GND</td><td>接单片机3.3V和GND</td><td>单片机电源</td></tr></tbody></table></div><h2 id="1-2-接线方式"><a href="#1-2-接线方式" class="headerlink" title="1.2 接线方式"></a>1.2 接线方式</h2><p><strong>STM32与USB转TTL</strong><br>| STM32   | USB转TTL |<br>| ———- | ———— |<br>| 3.3V/5V | 3.3/5V   |<br>| GND     | GND      |<br>| PA9     | RXD      |<br>| PA10    | TXD      |</p><p><strong>STM32与A4988</strong><br>| STM32   | A4988             |<br>| ———- | ————————- |<br>| 3.3V/5V | VDD               |<br>| GND     | GND               |<br>| PB6     | STEP(motor.h定义) |<br>| PB7     | DIR (motor.h定义) |<br>|         | EN接GND           |<br>|         | SLP接RST          |</p><p><strong>A4988与步进电机</strong><br>| A4988 | 步进电机 |<br>| ——- | ———— |<br>| VMOT  | 12V电源+ |<br>| GND   | 12V电源- |<br>| B2    | B-       |<br>| A2    | B+       |<br>| A1    | A+       |<br>| B1    | A-       |</p><p> <strong>需要注意步进电机接线相序</strong></p><p>A4988标注的1A、1B、2A、2B，数字代表相、ab代表正负。</p><p>步进电机标注的A+、A-、B+、B-，其中AB代表相，+-代表正负。</p><p>因此接线对应方式应该是：<strong>A+和A-对应1A和1B、B+和B-对应2A和2B</strong>。比如我的步进电机为黑色A+、绿色A-、红色B+、蓝色B-，那么对应A4988的B2 A2 A1 B1，电机接线顺序就是B- B+ A+ A-（蓝-红-黑-绿）。</p><p>如果接错可能会出现电机反转，或只振动不旋转的现象。</p><h2 id="1-2-程序设计"><a href="#1-2-程序设计" class="headerlink" title="1.2 程序设计"></a>1.2 程序设计</h2><p>本程序为串口控制步进电机，改编自开发板的串口例程，另外编写了步进电机的驱动函数。</p><p>GPIO中间的延时表示速度，delay_ms(2)约0.8s每圈，delay_ms(1)约0.4s每圈。</p><p>默认情况下（全步进）一个STEP脉冲步进电机转90°。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//motor.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MOTOR_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MOTOR_H </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//PF0-7,12-15</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Motor_GPIO GPIOF<span class="comment">//PF</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Motor_RCC RCC_APB2Periph_GPIOF</span></span><br><span class="line"><span class="comment">//第一个步进电机A4988的接线</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Motor1_STEPGPIO_Pin_1<span class="comment">//STEP - PF1</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Motor1_DIRGPIO_Pin_2<span class="comment">//DIR  - PF2</span></span></span><br><span class="line"><span class="comment">//第二个步进电机A4988的接线//PB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Motor2_STEPGPIO_Pin_3<span class="comment">//STEP - PF3</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Motor2_DIRGPIO_Pin_4<span class="comment">//DIR  - PF4</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">MOTOR_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">motor</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> motor1_dir, <span class="type">unsigned</span> <span class="type">int</span> motor1_step, <span class="type">unsigned</span> <span class="type">int</span> motor2_dir, <span class="type">unsigned</span> <span class="type">int</span> motor2_step)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//motor.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;motor.h&quot;</span></span></span><br><span class="line"><span class="comment">/*GPIO_motornum和GPIOx用于选择电机，GPIO_direction用于选择电机方向，dir：0为逆1为正，k为90°的倍数*/</span></span><br><span class="line"><span class="comment">// GPIO</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">MOTOR_Init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">  RCC_APB2PeriphClockCmd(Motor_RCC,ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Motor初始化</span></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = Motor1_STEP|Motor1_DIR|Motor2_STEP|Motor2_DIR;</span><br><span class="line">GPIO_InitStructure.GPIO_Mode=GPIO_Mode_Out_PP;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">GPIO_Init(Motor_GPIO,&amp;GPIO_InitStructure);<span class="comment">// 初始化GPIOB</span></span><br><span class="line">GPIO_ResetBits(Motor_GPIO,Motor1_STEP);<span class="comment">//初始化GPIOB_6输出低电平</span></span><br><span class="line">GPIO_ResetBits(Motor_GPIO,Motor1_DIR);<span class="comment">//初始化GPIOB_7输出低电平</span></span><br><span class="line">GPIO_ResetBits(Motor_GPIO,Motor2_STEP);<span class="comment">//初始化GPIOB_8输出低电平</span></span><br><span class="line">GPIO_ResetBits(Motor_GPIO,Motor2_DIR);<span class="comment">//初始化GPIOB_9输出低电平</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">motor</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> motor1_dir, <span class="type">unsigned</span> <span class="type">int</span> motor1_step, <span class="type">unsigned</span> <span class="type">int</span> motor2_dir, <span class="type">unsigned</span> <span class="type">int</span> motor2_step)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(motor1_dir)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span> : GPIO_SetBits(Motor_GPIO,Motor1_DIR); <span class="keyword">break</span>; </span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span> : GPIO_ResetBits(Motor_GPIO,Motor1_DIR); <span class="keyword">break</span>; </span><br><span class="line"><span class="keyword">default</span> : <span class="keyword">break</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>(motor2_dir)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span> : GPIO_SetBits(Motor_GPIO,Motor2_DIR); <span class="keyword">break</span>; </span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span> : GPIO_ResetBits(Motor_GPIO,Motor2_DIR); <span class="keyword">break</span>; </span><br><span class="line"><span class="keyword">default</span> : <span class="keyword">break</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">GPIO_SetBits(Motor_GPIO,Motor1_STEP);</span></span><br><span class="line"><span class="comment">GPIO_SetBits(Motor_GPIO,Motor2_STEP);</span></span><br><span class="line"><span class="comment">delay_ms(2);//周期1.3ms</span></span><br><span class="line"><span class="comment">GPIO_ResetBits(Motor_GPIO,Motor1_STEP);</span></span><br><span class="line"><span class="comment">GPIO_ResetBits(Motor_GPIO,Motor2_STEP);</span></span><br><span class="line"><span class="comment">delay_ms(2);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; motor1_step || i &lt; motor2_step; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(i&lt;motor1_step)</span><br><span class="line">&#123;</span><br><span class="line">GPIO_SetBits(Motor_GPIO,Motor1_STEP);</span><br><span class="line">delay_ms(<span class="number">2</span>);<span class="comment">//周期1.3ms</span></span><br><span class="line">GPIO_ResetBits(Motor_GPIO,Motor1_STEP);</span><br><span class="line">delay_ms(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(i&lt;motor2_step)</span><br><span class="line">&#123;</span><br><span class="line">GPIO_SetBits(Motor_GPIO,Motor2_STEP);</span><br><span class="line">delay_ms(<span class="number">2</span>);<span class="comment">//周期1.3ms</span></span><br><span class="line">GPIO_ResetBits(Motor_GPIO,Motor2_STEP);</span><br><span class="line">delay_ms(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//delay_ms(2);//延时一会</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;usart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mbotLinuxUsart.h&quot;</span><span class="comment">//引用该头文件是使用，通信协议的前提</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;motor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_WIDTH640/2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMAGE_HEIGHT480/2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试发送变量</span></span><br><span class="line"><span class="type">short</span> testSend1   =<span class="number">1111</span>;</span><br><span class="line"><span class="type">short</span> testSend2   =<span class="number">2222</span>;</span><br><span class="line"><span class="type">short</span> testSend3   =<span class="number">3333</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> testSend4 = <span class="number">0x05</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试接收变量</span></span><br><span class="line"><span class="type">int</span> testRece1     =<span class="number">400</span>;</span><br><span class="line"><span class="type">int</span> testRece2     =<span class="number">300</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> testRece3 = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//=======================================变量定义=====================================================</span></span><br><span class="line">u8 dir1;</span><br><span class="line">u8 dir2;</span><br><span class="line">u16 step1;</span><br><span class="line">u16 step2;</span><br><span class="line"><span class="comment">//======================================硬件初始化====================================================</span></span><br><span class="line">delay_init();                            <span class="comment">//延时函数初始化</span></span><br><span class="line">NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2); <span class="comment">//设置中断优先级分组2</span></span><br><span class="line">uart_init(<span class="number">115200</span>);                            <span class="comment">//串口初始化为115200</span></span><br><span class="line">MOTOR_Init(); <span class="comment">//初始化A4988驱动</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//=======================================循环程序=====================================================</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//将需要发送到ROS的数据，从该函数发出，前三个数据范围（-32768 - +32767），第四个数据的范围(0 - 255)</span></span><br><span class="line">usartSendData(testSend1,testSend2,testSend3,testSend4);</span><br><span class="line"><span class="keyword">if</span>(testRece1&gt;IMAGE_WIDTH)</span><br><span class="line">&#123;</span><br><span class="line">dir1=<span class="number">1</span>;</span><br><span class="line">step1=testRece1-IMAGE_WIDTH;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">dir1=<span class="number">0</span>;</span><br><span class="line">step1=IMAGE_WIDTH-testRece1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(testRece2&gt;IMAGE_HEIGHT)</span><br><span class="line">&#123;</span><br><span class="line">dir2=<span class="number">0</span>;</span><br><span class="line">step2=testRece2-IMAGE_HEIGHT;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">dir2=<span class="number">1</span>;</span><br><span class="line">step2=IMAGE_HEIGHT-testRece2;</span><br><span class="line">&#125;</span><br><span class="line">motor(dir1,step1,dir2,step2);</span><br><span class="line"><span class="comment">//必须的延时</span></span><br><span class="line">delay_ms(<span class="number">13</span>);</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//====================================串口中断服务程序=================================================</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">USART1_IRQHandler</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(USART_GetITStatus(USART1, USART_IT_RXNE) != RESET)</span><br><span class="line">  &#123;</span><br><span class="line"> USART_ClearITPendingBit(USART1,USART_IT_RXNE);<span class="comment">//首先清除中断标志位</span></span><br><span class="line"> <span class="comment">//从ROS接收到的数据，存放到下面三个变量中</span></span><br><span class="line"> usartReceiveOneData(&amp;testRece1,&amp;testRece2,&amp;testRece3);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//===========================================END=======================================================</span></span><br></pre></td></tr></table></figure><h2 id="1-3-实验"><a href="#1-3-实验" class="headerlink" title="1.3 实验"></a>1.3 实验</h2><p>STM32从ROS系统获取图像中的目标中心坐标。<br>receiveData1存放目标x值，receiveData2存放目标y值。</p><p>由于ROS系统持续发送坐标值，因此STM32实时接受数据进行控制。A4988采用16细分，每次驱动(50循环)步进5.625°，即每个循环0.1°，可考虑根据目标偏移程度设置每次指令步进大小。例如每差1坐标，每次指令加一个循环0.1°。</p><p><img src="https://img.mahaofei.com/img/STM32_Control_StepMotor.jpg" alt=""></p>]]></content>
    
    
    <summary type="html">基于A4988芯片驱动42步进电机，在STM32F1平台上进行测试，最高可以实现16细分。</summary>
    
    
    
    <category term="嵌入式" scheme="https://www.mahaofei.com/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="单片机" scheme="https://www.mahaofei.com/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="实验" scheme="https://www.mahaofei.com/tags/%E5%AE%9E%E9%AA%8C/"/>
    
    <category term="单片机" scheme="https://www.mahaofei.com/tags/%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>阿里云图床搭建方法</title>
    <link href="https://www.mahaofei.com/post/d05a7f72.html"/>
    <id>https://www.mahaofei.com/post/d05a7f72.html</id>
    <published>2022-03-26T06:37:22.000Z</published>
    <updated>2022-03-26T06:37:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>由于现在一直在CSDN和自己的网站同步写博客记录，可是以前我都是在CSDN编辑器内直接码字上传，但这样的编辑方式很难受，我还是更喜欢像Typora的本地markdown编辑器，这样就需要有一个自己的图床，本地截图粘贴到markdown编辑器内，就会自动上传到自己的图床中。</p><h1 id="开通阿里云OSS服务"><a href="#开通阿里云OSS服务" class="headerlink" title="开通阿里云OSS服务"></a>开通阿里云OSS服务</h1><p>首先需要开通<a href="https://www.aliyun.com/product/oss">阿里云OSS服务</a>，登录账号后直接点击立即开通就可以。</p><p>阿里云提供了两种计费方式：</p><ul><li>按量收费：这是默认的计费方式，开通OSS后就是这种方式，不需要提前付款，使用后会直接从账户内扣钱。</li><li>包月包年套餐：点击折扣套餐可以看到各种不同容量和时间的套餐</li></ul><p>由于我在这里只存储写博客用到的图片，每张图片只有几十K，就算是最小的40G套餐我也是远远用不到的，因此我选择按量收费，也就是这里不操作，直接下一步。</p><h1 id="新建Bucket"><a href="#新建Bucket" class="headerlink" title="新建Bucket"></a>新建Bucket</h1><p>Bucket相当于存储图片的容器，这里新建Bucket。</p><ul><li>输入Bucket的名称：生成链接后，链接名称的组成部分（*****.oss-cn-beijing.aliyuncs.com）</li><li>区域：选择一个离你最近的就可以</li><li>存储类型：一般选择标准存储</li><li>读写权限：必须选择公共读，否则其他人无法访问图片</li><li>剩余的服务都不需要开启</li></ul><p>打开Bucket列表，在刚创建的bucket下新建一个目录img，用于存放博客图片。</p><p><img src="https://img.mahaofei.com/img/202203260958360.png" alt=""></p><h1 id="设置自定义域名"><a href="#设置自定义域名" class="headerlink" title="设置自定义域名"></a>设置自定义域名</h1><p>为Bucket绑定域名</p><p>打开自己的Bucket，进入【传输管理】，点击【域名管理-绑定域名】</p><p>其中的<strong>image</strong>就是以后图片访问时的前缀（例如<a href="https://image.mahaofei.com/123456.img）">https://image.mahaofei.com/123456.img）</a></p><p><img src="https://img.mahaofei.com/img/20220511105137.png" alt=""></p><p>最好可以再申请一个免费SSL证书部署上。</p><h1 id="获取阿里云AccessKey"><a href="#获取阿里云AccessKey" class="headerlink" title="获取阿里云AccessKey"></a>获取阿里云AccessKey</h1><p>鼠标移动到阿里云首页右上角个人头像，点击AccessKey管理。</p><p>进入页面后可能会出现安全提示，点击继续使用AccessKey。</p><p>点击创建AccessKey，通过验证后就可以看到AccessKey了。</p><p>这里的AccessKey ID和AccessKey Secret一定要记录好，而且一定不能公开。</p><h1 id="下载安装Picgo"><a href="#下载安装Picgo" class="headerlink" title="下载安装Picgo"></a>下载安装Picgo</h1><p>下面是Picgo项目的Github链接，直接在这里下载就可以。<br><a href="https://github.com/Molunerfinn/PicGo">https://github.com/Molunerfinn/PicGo</a></p><h1 id="配置Picgo"><a href="#配置Picgo" class="headerlink" title="配置Picgo"></a>配置Picgo</h1><p>在Picgo设置里勾选显示阿里云OSS图床（默认已经打开了很多常用图床）</p><p>在图床设置-阿里云OSS设置内，填写自己的信息</p><p><img src="https://img.mahaofei.com/img/202203260959238.png" alt=""></p>]]></content>
    
    
    <summary type="html">由于现在一直在CSDN和自己的网站同步写博客记录，可是以前我都是在CSDN编辑器内直接码字上传，但这样的编辑方式很难受，我还是更喜欢像Typora的本地markdown编辑器，这样就需要有一个自己的图床，本地截图粘贴到markdown编辑器内，就会自动上传到自己的图床中。</summary>
    
    
    
    <category term="程序设计" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="网站" scheme="https://www.mahaofei.com/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E7%BD%91%E7%AB%99/"/>
    
    
    <category term="网站搭建" scheme="https://www.mahaofei.com/tags/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"/>
    
    <category term="阿里云" scheme="https://www.mahaofei.com/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>博途TIA Portal V15 下载与安装教程</title>
    <link href="https://www.mahaofei.com/post/bb559113.html"/>
    <id>https://www.mahaofei.com/post/bb559113.html</id>
    <published>2022-02-04T07:58:00.000Z</published>
    <updated>2022-02-04T07:58:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>下载链接：</p><p>阿里云盘：<a href="https://www.aliyundrive.com/s/G5V98sQFqVq">https://www.aliyundrive.com/s/G5V98sQFqVq</a></p><p>百度网盘： <a href="https://pan.baidu.com/s/1X3hMP5n2DlMXB_wiGztarg?pwd=dpzk">https://pan.baidu.com/s/1X3hMP5n2DlMXB_wiGztarg?pwd=dpzk</a></p><p>提取码: dpzk</p></blockquote><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在安装西门子软件的时候，经常提示要重启，而且重启之后依然提示重启，让人莫名烦恼， 按照以下步骤删除注册表则不会再提示重启。</p><font color="red">注意：删除注册表后不要重启，直接继续安装，（删除此文件对电脑没有任何影响）</font><ol><li>在windows系统下，按下组合键：WIN+R，输入“regedit”，打开注册表编辑器<br> <img src="https://img.mahaofei.com/img/202203261044325.png" alt="">找到 HEEY_LOCAL_MACHINE\SYSTEM\CURRENTCONTROLSET\CONTROL\SESSION MANAGE\ 下的 PendingFileRemameOpeaations 键，直接删除该键值。不需要重新启动，继续你的软件安装即可。<br> <img src="https://img.mahaofei.com/img/202203261044343.png" alt=""></li></ol><blockquote><p>安装前注意：</p><ul><li>V15 支持WIN11 WIN10  WIN8  WIN7, 但必须都是64位系统</li><li>文件下载完成，安装出现安装过程中出错，则重新安装或修复，如果再次安装仍出现此问题则只能重新安装系统后再装软件，之所以出现这种问题，因为博途软件较庞大，所用到的数据库文件非常复查，系统内含有其他第三方软件可能导致博途安装无法正常成功，所以尽量保持系统的纯净再安装，切记，万不能开始各种杀毒软件，尤其360，否在无法保证是否能成功，或者安装完成能否正常使用。</li></ul></blockquote><h2 id="安装前一定要关闭杀毒软件"><a href="#安装前一定要关闭杀毒软件" class="headerlink" title="安装前一定要关闭杀毒软件"></a><font color="red">安装前一定要关闭杀毒软件</font></h2><h2 id="开始安装软件"><a href="#开始安装软件" class="headerlink" title="开始安装软件"></a>开始安装软件</h2><h3 id="①-安装STEP7-Professional"><a href="#①-安装STEP7-Professional" class="headerlink" title="① 安装STEP7 Professional"></a>① 安装STEP7 Professional</h3><ol><li>将安装包解压，进入<strong>01-STEP7+Wincc Profesional V15</strong>文件夹，运行<strong>TIA_Portal_STEP_7_Pro_WINCC_Pro_V15.exe</strong>，首先安装SETP7 Professional（PLC编程软件+WINCC触摸屏和上位机组态软件）<br><img src="https://img.mahaofei.com/img/202203261045172.png" alt=""></li><li>选择要安装的位置（尽量避免解压在C盘），然后点击下一步等待解压，解压过程5分钟左右<br><img src="https://img.mahaofei.com/img/202203261045963.png" alt=""></li><li>开始正式安装，<strong>直接点击下一步</strong><br><img src="https://img.mahaofei.com/img/202203261045632.png" alt=""></li><li>语言选择默认勾选中文，<strong>直接下一步</strong><br><img src="https://img.mahaofei.com/img/202203261045370.png" alt=""></li><li>默认典型安装即可，<strong>浏览选择安装路径</strong>，然后<strong>点击下一步</strong><br><img src="https://img.mahaofei.com/img/202203261045522.png" alt=""></li><li><strong>勾选接受两个条款协议</strong>，然后<strong>点击下一步</strong><br><img src="https://img.mahaofei.com/img/202203261045996.png" alt=""></li><li><strong>勾选接受</strong>安全和权限设置，然后<strong>点击下一步</strong><br><img src="https://img.mahaofei.com/img/202203261045675.png" alt=""></li><li>确认安装路径没问题后，<strong>点击安装按钮</strong>，开始进行安装，安装过程约40分钟<br><img src="https://img.mahaofei.com/img/202203261045605.png" alt=""></li><li><strong>选择立即重启</strong>，完成安装（这里需要重启电脑，否则无法进行后续安装）</li></ol><h3 id="②-安装STEP7-Simulation"><a href="#②-安装STEP7-Simulation" class="headerlink" title="② 安装STEP7_Simulation"></a>② 安装STEP7_Simulation</h3><ol><li>进入<strong>02-PLCSIM_V15</strong>文件夹，双击运行<strong>SIMATIC_S7PLCSIM_V15.exe</strong>，开始安装STEP7_simulation（PLC的仿真软件）<br><img src="https://img.mahaofei.com/img/202203261046807.png" alt=""><ol><li>开始安装，直接<strong>点击下一步</strong><br><img src="https://img.mahaofei.com/img/202203261046519.png" alt=""></li></ol></li><li>安装语言默认选择中文，<strong>直接下一步</strong><br><img src="https://img.mahaofei.com/img/202203261046465.png" alt=""><ol><li><strong>选择安装文件解压路径（不要和上一个程序选择同一路径，否则会出现文件覆盖问题）</strong>，然后<strong>点击下一步</strong>，等待解压，此过程约3分钟<br><img src="https://img.mahaofei.com/img/202203261046214.png" alt=""></li><li>进入安装程序，点击下一步开始安装<br><img src="https://img.mahaofei.com/img/202203261046805.png" alt=""></li><li>默认选择中文，<strong>点击下一步</strong>继续<br><img src="https://img.mahaofei.com/img/202203261046058.png" alt=""></li><li>浏览<strong>选择安装路径</strong>，然后<strong>点击下一步</strong><br><img src="https://img.mahaofei.com/img/202203261046718.png" alt=""></li><li><strong>接受条款协议</strong>，然后<strong>点击下一步</strong><br><img src="https://img.mahaofei.com/img/202203261047339.png" alt=""></li><li>接受计算机安全和权限设置，点击下一步<br><img src="https://img.mahaofei.com/img/202203261047195.png" alt=""></li><li><strong>检查安装路径</strong>没问题，<strong>点击安装按钮</strong>开始安装软件12<br><img src="https://img.mahaofei.com/img/202203261047722.png" alt=""></li><li>选择稍后重启，完成安装<br><img src="C:\Users\82785\AppData\Roaming\Typora\typora-user-images\image-20220326104732524.png" alt="image-20220326104732524"><h3 id="③-安装驱动（如果只仿真，不需要连接PLC可跳过安装）"><a href="#③-安装驱动（如果只仿真，不需要连接PLC可跳过安装）" class="headerlink" title="③ 安装驱动（如果只仿真，不需要连接PLC可跳过安装）"></a>③ 安装驱动（如果只仿真，不需要连接PLC可跳过安装）</h3></li><li>进入<strong>Startdrive</strong>文件夹中，双击运行<strong>Startdrive_V15.exe</strong>，按步骤进行安装<br><img src="https://img.mahaofei.com/img/202203261047076.png" alt=""><h3 id="④-授权"><a href="#④-授权" class="headerlink" title="④ 授权"></a>④ 授权</h3></li><li>在授权文件夹下找到<strong>Sim_EKB_Install_2018_11_14.exe</strong>文件，右键<strong>以管理员身份运行</strong><br><img src="https://img.mahaofei.com/img/202203261047455.png" alt=""></li><li>授权Step7 Professional<br><img src="https://img.mahaofei.com/img/202203261047872.png" alt=""></li><li>授权WinCC，找到TIA Portal  —TIA Portal V15 –WINCC Prof v15，按图找到几个选项后点击安装长密钥<br><img src="https://img.mahaofei.com/img/202203261047560.png" alt=""></li><li>然后关闭程序，重启计算机</li></ol></li></ol><blockquote><p>如果重启后打开软件授权不成功，则在C盘找到AX NF  ZZ文件夹删除（如果找不到，请打开显示隐藏文件夹）<br><img src="https://img.mahaofei.com/img/202203261048361.png" alt=""><br>如果以上步骤操作完毕仍然无法授权，则需要重装Windows纯净系统，不要再安装任何其他软件和杀毒管家等，直接安装博途</p></blockquote><p> 在桌面找到TIA Portal V15软件，双击运行，可正常启动<br> <img src="https://img.mahaofei.com/img/202203261048756.png" alt=""><br><img src="https://img.mahaofei.com/img/202203261048505.png" alt=""></p>]]></content>
    
    
    <summary type="html">西门子PLC自动化设计软件博途V15的安装教程。</summary>
    
    
    
    <category term="嵌入式" scheme="https://www.mahaofei.com/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="单片机" scheme="https://www.mahaofei.com/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="软件安装" scheme="https://www.mahaofei.com/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    
    <category term="PLC" scheme="https://www.mahaofei.com/tags/PLC/"/>
    
  </entry>
  
  <entry>
    <title>河北工业大学机械电子工程专业课程资料（个人整理，请勿外传）</title>
    <link href="https://www.mahaofei.com/post/21df2adf.html"/>
    <id>https://www.mahaofei.com/post/21df2adf.html</id>
    <published>2022-01-05T16:00:00.000Z</published>
    <updated>2022-01-05T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="公共课"><a href="#公共课" class="headerlink" title="公共课"></a>公共课</h2><h3 id="大二上"><a href="#大二上" class="headerlink" title="大二上"></a><em>大二上</em></h3><div class="table-container"><table><thead><tr><th><a href="https://www.aliyundrive.com/s/vNZ6TSj6WJd">线性代数</a></th><th><a href="https://www.aliyundrive.com/s/6QjzPDqcgF1">大学物理</a></th><th><a href="https://www.aliyundrive.com/s/LWNGU81AUWZ">马克思主义基本原理概论</a></th></tr></thead><tbody><tr><td></td></tr></tbody></table></div><h3 id="大二下"><a href="#大二下" class="headerlink" title="大二下"></a><em>大二下</em></h3><div class="table-container"><table><thead><tr><th><a href="https://www.aliyundrive.com/s/3aFWBAdyhgR">概率论与数理统计</a></th><th><a href="https://www.aliyundrive.com/s/248XLLcHYHp">毛泽东思想和中国特色社会主义理论体系概论</a></th><th>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</th></tr></thead><tbody><tr><td></td></tr></tbody></table></div><h2 id="专业课"><a href="#专业课" class="headerlink" title="专业课"></a>专业课</h2><h3 id="大二下-1"><a href="#大二下-1" class="headerlink" title="大二下"></a><em>大二下</em></h3><div class="table-container"><table><thead><tr><th><a href="https://www.aliyundrive.com/s/ikNAzyqmWAf">电工电子技术</a></th><th><a href="https://www.aliyundrive.com/s/BBwwM9t2dNc">机械原理</a></th><th><a href="https://www.aliyundrive.com/s/cWbKWUMy2yc">材料力学</a></th></tr></thead><tbody><tr><td><strong><a href="https://www.aliyundrive.com/s/Fs51pUPd4dm">互换性与测量技术</a></strong></td><td></td></tr></tbody></table></div><h3 id="大三上"><a href="#大三上" class="headerlink" title="大三上"></a><em>大三上</em></h3><div class="table-container"><table><thead><tr><th><a href="https://www.aliyundrive.com/s/pFNWexCiLqY">机械设计</a></th><th><a href="https://www.aliyundrive.com/s/2CJKUJzjouK">机电传动与控制</a></th><th><a href="https://www.aliyundrive.com/s/YLHZLGZeWSC">液压传动与控制</a></th></tr></thead><tbody><tr><td><strong><a href="https://www.aliyundrive.com/s/BvQ7FgyCAMy">自动控制原理</a></strong></td><td></td></tr></tbody></table></div><h3 id="大三下"><a href="#大三下" class="headerlink" title="大三下"></a><em>大三下</em></h3><div class="table-container"><table><thead><tr><th><a href="https://www.aliyundrive.com/s/Z7ZEtnbsPov">传感与检测技术</a></th><th><a href="https://www.aliyundrive.com/s/dL2cZ1g2n5Q">微机原理及应用</a></th><th><a href="https://www.aliyundrive.com/s/3Fj4pxuYNRz">机械制造技术基础</a></th></tr></thead><tbody><tr><td><strong><a href="https://www.aliyundrive.com/s/FEPhcgfyKTq">机械动力学</a></strong></td><td></td></tr></tbody></table></div><h3 id="大四上"><a href="#大四上" class="headerlink" title="大四上"></a><em>大四上</em></h3><div class="table-container"><table><thead><tr><th><a href="https://www.aliyundrive.com/s/h2Ayhm17cC6">数控技术</a></th><th><a href="https://www.aliyundrive.com/s/5SzkVMMrZK6">机器人技术及应用</a></th><th><a href="https://www.aliyundrive.com/s/k4BYhySnW6a">机电系统建模仿真</a></th></tr></thead><tbody><tr><td><a href="https://www.aliyundrive.com/s/iExSacLgtt4"><strong>机电系统设计</strong></a></td><td><a href="https://www.aliyundrive.com/s/PWFoXhRDv5Z"><strong>电气控制与PLC</strong></a></td></tr></tbody></table></div>]]></content>
    
    
    <summary type="html">博主本科期间各课程所用到的资料汇总，包括公共课（如线代、大物），专业课等等。由于多数为本校老师个人制作使用的PPT、知识点资料，因此请仅用于个人学习使用，谢谢。</summary>
    
    
    
    <category term="随笔" scheme="https://www.mahaofei.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="经验" scheme="https://www.mahaofei.com/categories/%E9%9A%8F%E7%AC%94/%E7%BB%8F%E9%AA%8C/"/>
    
    
  </entry>
  
</feed>
